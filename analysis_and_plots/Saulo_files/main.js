webpackJsonp([9],{104:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,n,r){if(void 0===n&&(n=""),this.type=t,this.pos=e,this.text=n,this.len=r,e<0)throw new Error("Negative position is prohibited: "+e);if(r<0)throw new Error("Negative array size if prohibited: "+r)}return t}();e.Change=r;var i=function(){function t(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=""),void 0===r&&(r=0),this._type=t,this._pos=e,this._text=n,this._tlen=r,this._len=n.length}return t.prototype.extend=function(e,n,r){return new t(this._type,null==n?this._pos:n,null==r?this._text:r,e)},Object.defineProperty(t.prototype,"begin",{get:function(){return this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._len},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textLength",{get:function(){return this._tlen},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){return this._pos+this._len},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this._type+this._pos+":"+this._text},t.prototype.pack=function(t){if("="===this._type)return"";var e=this._text.replace(/%/g,"%25").replace(/:/g,"%3A"),n=this._pos.toString(36),r=this._tlen.toString(36),i=(t||0).toString(36);return this._type+n+":"+r+":"+e+":"+i},t.prototype.apply=function(t){if("+"===this.type){if(t.length!==this._tlen)throw new Error("Text length doesn't match expected length during insert. It's most likely you have missed a transformation: expected:"+this._tlen+", actual:"+t.length);return t.slice(0,this._pos)+this._text+t.slice(this._pos)}if("-"===this._type){if(t.length!==this._tlen)throw new Error("Text length doesn't match expected length during delete. It's most likely you have missed a transformation: expected:"+this._tlen+", actual:"+t.length);return t.slice(0,this._pos)+t.slice(this._pos+this._len)}if("="===this._type)return t;throw new Error("Operation type isn't known or undefined: '"+this.type+"'")},t.prototype.transformAgainst=function(e,n,r){var i=0;if(this._tlen!==e._tlen)return[this];if("+"===this._type&&"+"===e._type){if(i=this._tlen+e._len,this._pos<e._pos)return[this.extend(i)];if(this._pos===e._pos&&n<r)return[this.extend(i)];if(e._pos<=this._pos)return[this.extend(i,this._pos+e._len)]}else if("+"===this._type&&"-"===e._type){if(i=this._tlen-e._len,this._pos<e._pos)return[this.extend(i)];if(this._pos===e._pos)return[this.extend(i)];if(e._pos<this._pos)return[this.extend(i,Math.max(this._pos-e._len,e._pos))]}else if("-"===this._type&&"-"===e._type){if(i=this._tlen-e._len,this._pos<e._pos){var o=Math.min(e._pos-this._pos,this._len);return[this.extend(i,this._pos,this._text.substr(0,o)+this._text.substr(o+e._len))]}if(this._pos===e._pos)return this._len<=e._len?[new t("=")]:[this.extend(i,this._pos,this._text.substr(e._len))];if(e._pos<this._pos){var s=e._pos+e._len-this._pos;return s>=this._len?[new t("=")]:s>0?[this.extend(i,e._pos,this._text.substr(s))]:[this.extend(i,this._pos-e._len)]}}else if("-"===this._type&&"+"===e._type){if(i=this._tlen+e._len,this._pos<e._pos){if(this._pos+this._len>e._pos){var a=e._pos-this._pos;return[this.extend(i,this._pos,this._text.substr(0,a)),this.extend(i,e._pos+e._len,this._text.substr(a))]}return[this.extend(i)]}if(this._pos===e._pos)return[this.extend(i,this._pos+e._len)];if(e._pos<this._pos)return[this.extend(i,this._pos+e._len)]}return[this]},t}();e.Operation=i},105:function(t,e,n){"use strict";function r(t){return t.view(function(t){return{enabled:!t.enabled}})}Object.defineProperty(e,"__esModule",{value:!0});var i,o=n(383),s=n(10),a=n(4),c=n(392),u=n(122),l=n(6),h=n(43),d=n(128),p=n(169);!function(t){t[t.free=0]="free",t[t.premium=1]="premium"}(i=e.UserType||(e.UserType={}));var f=h.getBrowserInfo().browser;e.UserGroups={EXTENSION_INSTALLED:"extension-"+f,DESKTOP_EDITOR_INSTALLED:"desktop_editor_used",FREEBIE_USER:"freebie",PREMIUM_CONVERSION:"premium-conversion"};var _=function(){function t(t,e,n,a,d,p,f,_){var g=this;this._experiments=t,this._subscription=e,this._userProfile=n,this._settings=a,this._institution=d,this._browser=p,this._router=f,this._appConfig=_,this._isPhoenixEduUser=this._institution.view(function(t){return{enabled:g._router.query.get("edu").fold(function(){return null!==t&&/Phoenix University/i.test(t.name)},function(t){return"phoenix"===t})}}),this._eduUserFeature=this._institution.view(function(t){return{enabled:g._router.query.has("edu")||null!==t}}),this._nonEduUserFeature=r(this._eduUserFeature),this.isUserTesting=this._experiments.view(function(t){return t.has("usertesting_001_usertesting")}).view(function(t){return g._router.query.has("hasUserTesting")||t&&!g._router.query.has("skipUserTesting")}),this.isFree=this._userProfile.view(function(t){return t.type===i.free&&!t.isFreebie}).get()||this._router.query.has("isFree"),this.isPremium=this._userProfile.view(function(t){return t.type===i.premium}).get()&&!this._router.query.has("isFree"),this.isDesktopEditor=h.isDesktopEditor(this._browser),this.forceEditorTs=this._router.query.get("denali").exists(function(t){return"false"===t})||this.isDesktopEditor,this.isDenaliProto=this._router.isActive(u.Router.routes.denali_proto_editor.href({docId:"*"})).get()||this._router.query.get("denali").exists(function(t){return"1"===t}),this.eduUserFeature=this._eduUserFeature,this.showEdgeBanner={enabled:"prod"!==this._appConfig.env},this.proofit=s.Atom.combine(this._subscription.view(function(t){return l.Async.isOk(t)&&!!t.value.paymentMethod}),this._institution,function(t,e){return{enabled:null!==e?e.proofit:t}}),this.proofitToolbarItem=s.Atom.combine(this.proofit,this._institution,this._userProfile,function(t,e,n){return{enabled:t.enabled||!n.isFreebie&&null===e}}),this.plagiarism=this._institution.view(function(t){return{enabled:!t||!t.plagiarismDisabled}}),this.banners=this.isDesktopEditor?s.Atom.create({enabled:!1}):this._nonEduUserFeature,this.navTutotial=this._eduUserFeature,this.tour=this._nonEduUserFeature,this.deleteAccount=r(this._isPhoenixEduUser),this.usernameUnderLogout=this._nonEduUserFeature,this.showChangeEmail=this._nonEduUserFeature,this.eduAdminPanelLink=this._institution.view(function(t){return{enabled:t&&t.admin}}),this.subscription=s.Atom.combine(this._userProfile,this._institution,function(t,e){return{enabled:null===e&&g.isPremium&&!t.isFreebie}}),this.goPremium={enabled:this.isFree},this.premiumBadge={enabled:this.isPremium},this.premiumCounter={enabled:!this.isFree},this.upgradeButton={enabled:this.isFree},this.appsSection=s.Atom.create({enabled:!this.isDesktopEditor}),this.desktopApps=r(this._isPhoenixEduUser),this.score=this._institution.view(function(t){return{enabled:!t||!t.scoreDisabled}}),this.downloadPdfReportButton={enabled:!this.isDesktopEditor},this.copyPasteMenuItems={enabled:!this.isDesktopEditor},this.quickReplacementsInCard=this._institution.view(function(t){return{enabled:!t||t.quickReplacement}}),this.hideTitleInEDUCard=this._institution.view(function(t){return{enabled:!t||!t.quickReplacement}}),this.showFullCards=this._institution.view(function(t){return{enabled:t&&t.fullCards}}),this.profileLink=r(this._isPhoenixEduUser),this.defaultAcademicGenre=s.Atom.create({enabled:!1}),this.enableTrackingOnDownload=this._isPhoenixEduUser.view(function(t){return!t}),this.phoenixReportBtn=this._isPhoenixEduUser,this.phoenixSupportLink=this._isPhoenixEduUser,this.phoenixTutorial=this._isPhoenixEduUser,this.phoenixTerms=s.Atom.combine(this._isPhoenixEduUser,this._settings.acceptedTermsVersion,function(t,e){var n=c.TermsOfService.version,r=o.valid(e)&&o.valid(n)&&o.gt(n,e)||!o.valid(e)||g._router.query.has("terms");return t.enabled&&r}),this.phoenixTour=this._isPhoenixEduUser,this.showSwitchToDenaliBtn={enabled:"prod"!==this._appConfig.env||this._userProfile.get().email.includes("@grammarly.com")}}return Object.defineProperty(t.prototype,"isDenaliV2",{get:function(){return!this.forceEditorTs&&(this._userProfile.get().email.indexOf("@grammarly.com")>-1&&this._userProfile.get().type===i.premium||(this._router.isActive(u.Router.routes.denali_editor.href({docId:"*"})).get()||this._router.query.get("denali").exists(function(t){return"prod"===t})))},enumerable:!0,configurable:!0}),t}();e.FeaturesModel=_;var g=function(){function t(t,e,n,r,i,o,s,c,u,l,h,f){this._state=t,this._authApi=e,this._irbisApi=n,this._dapi=r,this._subscribeUrl=i,this._upgradeBaseUrl=o,this._subscriptionUrl=s,this._browserType=c,this._browser=u,this._telemetry=l,this._router=h,this._appConfig=f,this._log=a.Monitoring.Logging.getLogger("model.account"),this.profile=this._state.view(function(t){return t.userProfile}),this.subscription=new p.SubscriptionModelImpl(this._state.lens(function(t){return t.subscription}),this._irbisApi,this._subscribeUrl,this._upgradeBaseUrl,this._subscriptionUrl,this._browserType,this._telemetry),this.settings=new d.SettingsModelImpl(this._state.lens(function(t){return t.settings}),this._dapi,this._state.lens(function(t){return t.userProfile.id})),this.features=new _(this._state.view(function(t){return t.experiments}),this.subscription.state,this.profile,this.settings,this._state.view(function(t){return t.institution}),this._browser,this._router,this._appConfig)}return t.prototype.areValidCredentials=function(t,e){var n=this;return this._authApi.login(t,e).then(function(t){return t&&!t.err}).catch(function(t){if(401===t.code)return n._log.warn("authError: areValidCredentials",t),!1;throw n._log.error("authError: areValidCredentials",t),t})},t.prototype.changeName=function(t){var e=this;return this._authApi.changeName(t).then(function(){return e._state.lens(function(t){return t.userProfile.fullName}).set(t)}).catch(this._log.handler("authError: changeName").error)},t.prototype.changeEmail=function(t,e){var n=this;return this._authApi.changeEmail(t,e).then(function(){return n._state.lens(function(t){return t.userProfile.newEmail}).set(t)}).catch(this._log.handler("authError: changeEmail").warn)},t.prototype.changePassword=function(t,e,n){return this._authApi.changePassword(t,e,n).catch(this._log.handler("authError: changePassword").warn)},t.prototype.deleteAccount=function(){return this._irbisApi.deleteAccount().catch(this._log.handler("irbisError: deleteAccount failed").warn)},t}();e.UserAccountModelImpl=g},107:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(15),o=n(23),s=n(35),a=n(10),c=n(4),u=n(319),l=n(41),h=n(828),d=n(316),p=n(6),f=d.default();!function(t){function e(t){return{route:t,href:function(e){return{pathname:u.compile(t.path)(e),exact:t.exact,path:t.path}}}}function n(t,e){return r.__assign({},t.route,{component:e})}var d=function(){function e(){var t=this;this._fullReload=!1,this._logger=c.Monitoring.Logging.getLogger("router"),this.location=a.Atom.create(this._parseLocation(f.location)),this.query=new g(f.location.search),this.scheduleForceReload=function(){t._fullReload=!0,t._logger.info("forceReload.scheduled")},this.forceReload=function(){t._logger.info("forceReload.started"),window.location.reload()};var e=c.Monitoring.Logging.getLogger("router");e.info("Router init",f.location),f.listen(function(n){e.info("Location change",n),t.location.set(t._parseLocation(n))})}return e.prototype._parseLocation=function(t){return{pathname:t.pathname}},e.prototype.navigate=function(t){this._fullReload?(this._logger.info("forceReload.startedOnNavigation"),window.location.href=t.pathname):f.push(t)},e.prototype.isActive=function(e){return this.location.view(t.isActive(e))},e}();t.Impl=d;var _=function(){function t(){this.location=a.Atom.create({pathname:"/",query:new URLSearchParams}),this._query=a.Atom.create(new g("")),this.navigate=p.noop,this.scheduleForceReload=p.noop,this.forceReload=p.noop}return Object.defineProperty(t.prototype,"query",{get:function(){return this._query.get()},enumerable:!0,configurable:!0}),t.prototype.isActive=function(t){return a.Atom.create(!1)},t.prototype.setQuery=function(t,e){var n=new URLSearchParams;n.set(t,e),this._query.set(new g(n.toString()))},t}();t.DummyImpl=_;var g=function(){function t(t){this._searchParam=new URLSearchParams(t)}return t.prototype.has=function(t){return this._searchParam.has(t)},t.prototype.get=function(t){return s.Option.of(this._searchParam.get(t))},t}();t.ContextTypes={appRouter:o.object},t.page=e,t.bindComponent=n,t.isActive=function(t){return function(e){var n=e.pathname;return Boolean(l.matchPath(n,t))}},t.Wrapper=function(t){var e=t.routesMap,n=t.renderer;return i.createElement(l.Router,{history:f},i.createElement(l.Switch,null,p.ObjectUtils.toArray(e).map(function(t){return i.createElement(h.Route,{path:t.path,exact:t.exact,key:t.path,render:function(e){return n(e,t)}})})))},t.Block=function(t){var e=t.when,n=t.message;return i.createElement(a.F.div,null,e.map(function(t){return i.createElement(l.Prompt,{key:"prompt",when:t,message:n})}))},t.Redirect=function(t){var e=t.destination;return i.createElement(l.Redirect,{to:e})},t.routes={documents:e({path:"/",exact:!0,private:!0}),profile:e({path:"/profile",private:!0}),subscription:e({path:"/subscription",private:!0}),apps:e({path:"/apps",private:!0}),new_document:e({path:"/docs/new",exact:!0,private:!0}),editor:e({path:"/docs/:docId",private:!0}),denali_proto_editor:e({path:"/denali_docs/:docId",private:!0}),denali_editor:e({path:"/ddocs/:docId",private:!0}),free:e({path:"/free",private:!0}),component_browser:e({path:"/component_browser/:component?"}),card_iframe:e({path:"/card_iframe"}),diagnostic_test:e({path:"/diagnostic-test"}),notFound:e({path:"*"})}}(e.Router||(e.Router={}))},1129:function(t,e){t.exports={Effectiveness:[{cards:["Style/Wordiness/LinkingObsolete","Style/OldWords/Dated","Style/Colloquial/Yet","Style/Colloquial/ThoughAcademic","Style/Colloquial/ThatNonRestrictive","Style/Colloquial/SubjunctiveMood","Style/Colloquial/Slang","Style/Colloquial/SeemsToMeAcademic","Style/Colloquial/PrepositionAtTheEndOfSentence","Style/Colloquial/LeftDislocation","Style/Colloquial/InformalSo","Style/Colloquial/InformalPronounsAcademic","Style/Colloquial/InformalJustSo","Style/Colloquial/InSpiteOfAcademic","Style/Colloquial/EtcAndSoOnFormal","Style/Colloquial/ContractionsInAcademic","Style/Colloquial/ContractionING","Style/Colloquial/ConjunctionAtTheBeginningOfSentence","Style/Colloquial/ColloqGoCome","Style/Colloquial/AnywayAcademic","Style/Colloquial/AndOr","Style/Colloquial/ALotOf","Style/Colloquial/ACoupleFormal","Style/TooFormal/*"],title:"Formality",rank:60,description:"Checks use of formal or informal tone"},{cards:["Style/ToneCheck/NonPoliticallyCorrect","Style/ToneCheck/LGBTOffensive","Style/ToneCheck/LGBTPos","Style/ToneCheck/BiasedLanguageGender","Style/ToneCheck/BiasedLanguageDisease"],title:"Sensitivity",rank:190,description:"Checks for respectful, unbiased, inclusive language"},{cards:["Enhancement/WordChoice/Repeated","Enhancement/WordChoice/PronounChecks"],title:"Variety",rank:210,description:"Checks for repetitive vocabulary"},{cards:["Enhancement/WordChoice/WeakVerbs","Enhancement/WordChoice/VeryAdjectives","Enhancement/WordChoice/Vague"],title:"Vocabulary Richness",rank:200,description:"Checks for vague or weak words"}],Accuracy:[{cards:["Grammar/Conjunctions/*"],title:"Conjunctions",rank:130,description:"Checks use of conjunctions: and, but, so, because, etc."},{cards:["Grammar/Determiners/*"],title:"Determiners",rank:100,description:"Checks use of a/the, this/these, other/another, etc."},{cards:["Grammar/Lexical/*","Enhancement/WordChoice/Collocation"],title:"Fluency",rank:140,description:"Checks for fluent phrasing and good word choice"},{cards:["Grammar/Modifiers/*","Grammar/Quantifiers/*"],title:"Modifiers",rank:110,description:"Checks use of adjectives and adverbs"},{cards:["Grammar/Nouns/*"],title:"Nouns",rank:120,description:"Checks use of singular, plural, uncountable, possessive nouns"},{cards:["Grammar/Numerals/*"],title:"Numerals",rank:150,description:"Checks use of symbols and words that denote numbers"},{cards:["Grammar/Prepositions/*"],title:"Prepositions",rank:70,description:"Checks for confused, redundant or missing prepositions"},{cards:["Grammar/Pronouns/*"],title:"Pronouns",rank:30,description:"Checks pronoun use"},{cards:["Punctuation/*"],title:"Punctuation",rank:80,description:"Checks punctuation use"},{cards:["SentenceStructure/Fragment/*","SentenceStructure/Parallelism/*"],title:"Sentence Structure",rank:40,description:"Checks arrangement of words and phrases in a sentence"},{cards:["Spelling/*"],title:"Spelling",rank:10,description:"Checks spelling, confused words, capitalization"},{cards:["Grammar/Conditional/*","Grammar/Modals/*","Grammar/SVA/*","Grammar/Tenses/*","Grammar/Verbs/*"],title:"Verbs",rank:20,description:"Checks subject-verb agreement, use of verb forms and tenses"},{cards:["SentenceStructure/WordOrder/*"],title:"Word Order",rank:90,description:"Checks order of elements in a phrase"},{cards:["Style/Formatting/MissingSpace","Style/Formatting/MissingSpaceDateTime","Style/Formatting/Numerals","Style/Formatting/RedundantSpace","Style/Formatting/RedundantSpaceBeforePunct","Style/Formatting/SpaceSlash","Style/Formatting/UpperCaseSentenceStart"],title:"Typographic Conventions",rank:180,description:"Checks capital letters, spaces, number formats, etc."}],Clarity:[{cards:["Enhancement/WordChoice/Brevity","Style/Wordiness/UnnecessaryPreposition","Style/Wordiness/RedundantPhraseSubst","Style/Wordiness/RedundantPhraseRem","Style/Wordiness/NounString","Style/Wordiness/LongSentence","Style/Wordiness/LinkingRedundant","Style/Wordiness/DuplicateReflexivePronoun","Style/Wordiness/Circumlocutions","Style/Wordiness/BeOrBecomeBetweenMakeAndAdj","Style/Wordiness/AwkwardAdverbs"],title:"Conciseness",rank:160,description:"Checks for wordiness and redundancy"},{cards:["Enhancement/WordChoice/PronounDisagreement","Style/Clarity/UnclearAntecedent","Style/Clarity/AmbiguousPronoun"],title:"References",rank:50,description:"Checks for clear references"},{cards:["Style/PassiveVoice/Misuse"],title:"Voice",rank:170,description:"Checks use of passive and active voice"}]}},1130:function(t,e){t.exports={}},1131:function(t,e){t.exports={clearfix:"_3e896f-clearfix",header:"_3e896f-header",headOne:"_3e896f-headOne",headSub:"_3e896f-headSub",sub:"_3e896f-sub",link:"_3e896f-link",logoWrapper:"_3e896f-logoWrapper",logo:"_3e896f-logo"}},1132:function(t,e){t.exports={clearfix:"_e36e5b-clearfix",header:"_e36e5b-header",headOne:"_e36e5b-headOne",headSub:"_e36e5b-headSub",sub:"_e36e5b-sub",link:"_e36e5b-link",logoWrapper:"_e36e5b-logoWrapper",logo:"_e36e5b-logo",linkWrapper:"_e36e5b-linkWrapper",back:"_e36e5b-back",home:"_e36e5b-home",support:"_e36e5b-support"}},1133:function(t,e){t.exports={clearfix:"_fda1ec-clearfix",header:"_fda1ec-header",headOne:"_fda1ec-headOne",headSub:"_fda1ec-headSub",sub:"_fda1ec-sub",link:"_fda1ec-link",logoWrapper:"_fda1ec-logoWrapper",logo:"_fda1ec-logo",robot:"_fda1ec-robot",contact:"_fda1ec-contact",smallText:"_fda1ec-smallText"}},1134:function(t,e,n){n(386),t.exports=n(385)},122:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(265);e.BaseComponent=r.BaseComponent,e.withContext=r.withContext;var i=n(451);e.BasePage=i.BasePage;var o=n(454);e.Link=o.Link;var s=n(107);e.Router=s.Router},123:function(t,e,n){"use strict";function r(t){return t?t[0].toUpperCase()+t.slice(1):""}function i(t){return t?t.replace(/(?:^|[-_])(\w)/g,function(t,e){return e?e.toUpperCase():""}):""}function o(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}function s(t,e){if(void 0===t&&(t=""),!t||"undefined"==typeof window)return"";if(!e)return m.sanitize(t);var n=Object.assign({},e.allowedTags?{ALLOWED_TAGS:e.allowedTags}:{},e.sanitizeDom?{SANITIZE_DOM:e.sanitizeDom}:{});return m.sanitize(t,n)}function a(t,e){var n=t.match(e);return n&&n[1]}function c(t){return t.split(/\s+/)[0]}function u(t){if(!t)return 0;var e=t.replace(/[\W\d]/gi," ").replace(/\s+/gi," ").trim().split(" ");return 1===e.length&&""===e[0]?0:e.length}function l(t){return y.decode(t).length}function h(t){return t.replace(/\t/g,"    ")}function d(t,e,n){return 1===t?e:n}function p(t,e){return void 0===e&&(e="en-US"),t.toLocaleString(e,{minimumFractionDigits:2,maximumFractionDigits:2})}function f(t){return t.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")}function _(t,e,n){return e>>=0,n=String(n||" "),t.length>e?String(t):(e-=t.length,e>n.length&&(n+=n.repeat(e/n.length)),n.slice(0,e)+String(t))}function g(t){var e=document.createElement("div");return e.innerHTML=s(t),e.textContent||e.innerText||""}Object.defineProperty(e,"__esModule",{value:!0});var m=n(688),y=n(164);e.nbsp=String.fromCharCode(160),e.capitalize=r,e.camelize=i,e.toTitleCase=o,e.sanitize=s,e.getFirstMatch=a,e.getFirstWord=c,e.wordCount=u,e.charCount=l,e.replaceTabsWithSpaces=h,e.pluralize=d,e.formatPrice=p,e.escapeRegExp=f,e.padStart=_,e.decodeHTMLCodes=g},126:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(4),o=n(24),s=n(6),a=n(317),c=function(t){function e(e){var n=t.call(this,"Client fetch error: "+(e&&e.message||e))||this;return n.name="FetchError",n.cause=e,n}return r.__extends(e,t),e}(s.CustomError);e.FetchError=c;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="TimeoutWarnError",e}return r.__extends(e,t),e}(s.CustomError);e.TimeoutWarnError=u;var l,h=function(){function t(){}return Object.defineProperty(t,"request",{get:function(){return l||(l=i.Monitoring.TimeSeries.root.getMetric("fetch")),t._request},enumerable:!0,configurable:!0}),t.withTimeout=function(e,n){return function(r,i){return s.Async.promiseWithTimeout(e(r,i),n).catch(function(e){if(e instanceof o.TimeoutError){var n=t._getMeta(r,i),s=n.method,a=n.target;throw t.requestResults.next({type:"timeoutError",url:r,target:a,method:s}),t._extendError(e,r,s,a)}throw e})}},t.withTargetTag=function(e,n){return function(r,i){return"string"==typeof r?(i=i||{},i[t.FETCH_TARGET_TAG_OPTION]=n):r[t.FETCH_TARGET_TAG_OPTION]=n,e(r,i)}},t._withTimeoutWarn=function(e,n){return function(r,i){return o.Observable.merge(e(r,i),o.Observable.interval(n).mapTo(new u)).do(function(e){if(e instanceof u){var n=t._getMeta(r,i),o=n.method,s=n.target;t.requestResults.next({type:"timeoutWarn",url:r,method:o,target:s})}}).filter(function(t){return!(t instanceof u)}).first().toPromise()}},t._extendError=function(t,e,n,r){var i="object"==typeof t?s.isClientFetchError(t)?new c(t):t:new Error(t);return Object.assign(i,{isRxFetch:!0,method:n,target:r,url:"string"==typeof e?e:e.url})},t._getMeta=function(e,n){return{method:t._getMethod(e,n),target:t._getTarget(e,n)}},t._getMethod=function(t,e){return(("string"==typeof t?e&&e.method:t.method)||"get").toLowerCase()},t._getTarget=function(e,n){var r=("string"==typeof e?n&&n[t.FETCH_TARGET_TAG_OPTION]:e[t.FETCH_TARGET_TAG_OPTION])||"unknown";return"logs"===r?void 0:r},t.FETCH_TIMEOUT=15e3,t.FETCH_TARGET_TAG_OPTION="grammarly_target",t.requestResults=new o.Subject,t.nativeFetch=a.bind(window),t._request=function(e,n){var r=t._getMeta(e,n),i=r.method,o=r.target,s=l.getTimer(i+"."+o+".time").start();return t._withTimeoutWarn(t.nativeFetch,t.FETCH_TIMEOUT)(e,n).then(function(n){return o&&s.stop(),t.requestResults.next(n.ok?{type:"success",method:i,target:o}:{type:"serverError",method:i,response:n,url:e,target:o}),n}).catch(function(n){var r="object"==typeof n?n:new Error(n||"Unknown fetch error");throw t.requestResults.next({type:"clientError",url:e,reason:r,method:i,target:o}),t._extendError(r,e,i,o)})},t}();e.RxFetch=h,h.requestResults.subscribe(function(t){if(t.target)try{l.getCounter(t.method+"."+t.target+"."+t.type).increment()}catch(t){console.error("Error while reporting timeseries metrics",t)}})},127:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(4),o=function(){function t(t,e,n,r){this.from=t,this.to=e,this.event=n,this.args=r}return t.prototype.toString=function(){return"Transition: From: "+this.from+" to: "+this.to+" (Args: "+this.args+")"},t}();e.EventInfo=o;var s=function(){function t(e,n){this._log=i.Monitoring.Logging.getLogger("coreclients.fsm"),this._parents={},this._transitions={},this._scheduled=[],this._listeners={},this._inTransition=!1,this._verbose=!1,this._id=++t._ids,this._initial=e,this._current=e,this._final=n||null}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFinal",{get:function(){return this._final===this._current},enumerable:!0,configurable:!0}),t.prototype.transition=function(t,e,n){this._transitions[t<<11|n]=e},t.prototype.parent=function(t,e){this._parents[t]=e},t.prototype.is=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.findIndex(function(e){return e===t._current})>=0},t.prototype.from=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(c.bind.apply(c,[void 0,this].concat(t)))},t.prototype.with=function(t){return new a(this,t)},t.prototype.verbose=function(t,e){return this._verbose=!0,this._states=t,this._events=e,this},t.prototype.on=function(t,e){return this._addCallback(this._listeners,t,e),this},t.prototype.event=function(t,e){return r.__awaiter(this,void 0,void 0,function(){var n=this;return r.__generator(this,function(i){return[2,new Promise(function(i,s){return r.__awaiter(n,void 0,void 0,function(){var n,a,c,u,h;return r.__generator(this,function(d){switch(d.label){case 0:if(this._verbose&&this._trace("Handling event: "+this._eventName(t)),this._current===this._final)return this._trace("Cannot handle event "+t+": FSM is in it's final state"),[2,i(!1)];if(this._inTransition)return this._scheduled.push(new l(t,e,i,s)),[2];n=this._current,a=null,c=function(){var s,c,l,h,d,p,f;return r.__generator(this,function(_){switch(_.label){case 0:if(void 0===(s=u._transitions[n<<11|t]))return[3,10];u._inTransition=!0,c=u._listeners[s]||[],l=new o(u._current,s,t,e),_.label=1;case 1:_.trys.push([1,7,8,9]),u._verbose&&u._trace("Transition from "+u._stateName(l.from)+" to "+u._stateName(l.to)+" on "+u._eventName(t)+" Arguments: "+e),h=c.map(function(t){return Promise.resolve(t(l))}),u._current=s,u._inTransition=!1,d=function(t){return r.__generator(this,function(e){switch(e.label){case 0:return[4,u.event(t.event,t.args).then(function(e){return t.done(e)}).catch(function(e){return t.fail(e)})];case 1:return e.sent(),[2]}})},p=u._scheduled.shift(),_.label=2;case 2:return void 0===p?[3,5]:[5,d(p)];case 3:_.sent(),_.label=4;case 4:return p=u._scheduled.shift(),[3,2];case 5:return[4,Promise.all(h).then(function(t){return i(!0)})];case 6:return _.sent(),[3,9];case 7:return f=_.sent(),a=f,[3,9];case 8:return u._inTransition=!1,[7];case 9:return[2,"break"];case 10:return n=u._parents[n],[2]}})},u=this,d.label=1;case 1:return void 0===n?[3,3]:[5,c()];case 2:return h=d.sent(),"break"===h?[3,3]:[3,1];case 3:return a?s(a):i(!1),[2]}})})})]})})},t.prototype._addCallback=function(t,e,n){var r=t[e];return r||(r=[],t[e]=r),r.push(n),this},t.prototype._eventName=function(t){return void 0===this._events?t:this._events[t]},t.prototype._stateName=function(t){return void 0===this._states?t:this._states[t]},t.prototype._trace=function(t){this._log.trace("FSM#"+this._id+" [VERBOSE]: "+t)},t._ids=0,t}();e.StateMachine=s;var a=function(){function t(t,e){this.hsm=t,this.state=e}return t.prototype.childrenOf=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.forEach(function(e){return t.hsm.parent(t.state,e)}),this.hsm},t.prototype.parentOf=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.forEach(function(e){return t.hsm.parent(e,t.state)}),this.hsm},t}();e.WithBuilder=a;var c=function(){function t(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.hsm=t,this._states=e}return t.prototype.to=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new u(this.hsm,this._states,t)},t}();e.TransitionBuilder=c;var u=function(){function t(t,e,n){this.hsm=t,this.from=e,this.to=n}return t.prototype.on=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.forEach(function(e){return t.from.forEach(function(n){return t.to.forEach(function(r){return t.hsm.transition(n,r,e)})})}),this.hsm},t}();e.EventBuilder=u;var l=function(){function t(t,e,n,r){this.event=t,this.args=e,this.done=n,this.fail=r}return t}()},128:function(t,e,n){"use strict";function r(t){return"american"===t||"british"===t}function i(t){return t&&"null"!==t}Object.defineProperty(e,"__esModule",{value:!0});var o=n(24),s=n(42),a=n(4),c=n(6),u=n(89);e.isDialectString=r;var l="american",h=function(){function t(t,e,n){this._userSettings=t,this._dapi=e,this._userId=n,this._log=a.Monitoring.Logging.getLogger("model.settings"),this.firstCall=this._userSettings.lens(function(t){return t.firstCall}),this.dialect=this._userSettings.view(function(t){return i(t.dialectStrong)?t.dialectStrong:i(t.dialectWeak)?t.dialectWeak:null}),this.dialectOrDefault=this.dialect.view(function(t){return t||l}),this.seenWelcome=this._userSettings.lens(function(t){return t.seenWelcome}),this.acceptedTermsVersion=this._userSettings.lens(function(t){return t.acceptedTermsVersion}),this.banners=this._userSettings.lens(function(t){return t.banners}),this.denaliLens=this._userSettings.lens(function(t){return t.denaliLens})}return t.prototype._sync=function(t){var e=this;return this._dapi.save(t).then(function(){return p.write(e._userId.get(),s.Properties.of(e._userSettings.get()))}).catch(this._log.handler("dapiError: save failed",{data:t}).warn)},t.prototype._setProperty=function(t,e){var n=this;return void 0===e&&(e=!0),c.Async.modifyRemoteStateOptimistic(this._userSettings,function(e){return Object.assign({},e,t)},function(){return n._sync(s.Properties.of(t))},e)},t.prototype.firstCallDone=function(){var t=this;return this._setProperty({firstCall:!0},!1).catch(function(e){e instanceof o.TimeoutError?t._log.warn("Cannot set first call as done",e):t._log.error("Cannot set first call as done",e)})},t.prototype.setDialect=function(t){return this._setProperty({dialectStrong:t}).then(function(e){return t})},t.prototype.setDialectWeak=function(t){var e=this;return this._setProperty({dialectWeak:t}).catch(function(t){t instanceof o.TimeoutError?e._log.warn("Cannot set weak dialect",t):e._log.error("Cannot set weak dialect",t)})},t.prototype.welcomeTourLooked=function(){var t=this;return this._setProperty({seenWelcome:!0},!1).catch(function(e){t._log.warn("Cannot mark welcome tour as looked",e)})},t.prototype.acceptTerms=function(t){return this._setProperty({acceptedTermsVersion:t},!1).catch(this._log.handler("Cannot mark terms as accepted").error)},t.prototype._saveBanners=function(t){var e=t.shown,n=t.later,r=t.dismiss;return{shown:e,later:n.map(function(t){return t.type+":"+t.expire}),dismiss:r}},t.prototype.updateBanners=function(t){var e=this;return c.Async.modifyRemoteStateOptimistic(this.banners,function(e){return t},function(){return e._sync(s.Properties.of({banners:e._saveBanners(t)}))},!1).catch(function(t){t instanceof o.TimeoutError?e._log.warn("Cannot update banners state",t):e._log.error("Cannot update banners state",t)})},t.prototype.toggleMarkAsImportant=function(t,e){var n=Object.assign({},this.denaliLens.get());return n[t]=Object.assign({},n[t],{important:e}),this._setProperty({denaliLens:Object.assign({},n)},!1)},t.prototype.dismissAll=function(t){var e=Object.assign({},this.denaliLens.get());return e[t]=Object.assign({},e[t],{dissmissAllCounter:Math.sqrt(function(t){return t?t*t:1}(e[t]&&e[t].dismissAllCounter||0)+1)}),this._setProperty({denaliLens:Object.assign({},e)},!1)},t}();e.SettingsModelImpl=h;var d=""+u.appConfig.userSettingsPrefix+u.appConfig.userSettingsVersion+"-",p=function(){function t(){}return t.read=function(t){try{var e=""+d+t;return s.Properties.of(JSON.parse(c.LocalStorage.readProperties(e)[e]))}catch(t){return s.Properties.of({})}},t.write=function(t,e){c.LocalStorage.writeProperties(s.Properties.of((n={},n[""+d+t]=JSON.stringify(e),n)));var n},t}();e.LocalStorageUserSettings=p},129:function(t,e,n){"use strict";function r(){return void 0!==window.GR_EXTENSION_ID}function i(t){return"edge"===t?a.getBrowserInfo().version>=15:["chrome","firefox","safari"].indexOf(t)>-1}function o(t){return Array.from(t).some(function(t){return t.indexOf("office-addin")>-1})}Object.defineProperty(e,"__esModule",{value:!0});var s=n(4),a=n(43);!function(t){function e(t){var e=window;try{e.GR_EXTENSION_SEND&&e.GR_EXTENSION_SEND(t)}catch(e){s.Monitoring.Logging.getLogger("utils.extension").error("GR_EXTENSION_SEND("+t+") failed",e)}}function n(){e("editor-fix")}function r(){e("changed-dialect")}function i(){e("cleanup")}t.sendEditorFix=n,t.sendDialectChanged=r,t.sendLogout=i}(e.notifications||(e.notifications={}));!function(t){function e(t){window.top.postMessage({grammarly:!0,action:"open-url",url:t},"*")}t.openUrl=e}(e.actions||(e.actions={})),e.isExtensionInstalled=r,e.isBrowserHasExtension=i,e.isAddinInstalled=o},160:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(126);e.RxFetch=i.RxFetch;var o=n(261);e.getTextResources=o.getTextResources;var s=n(399);e.Lifecycle=s.Lifecycle,r.__exportStar(n(440),e)},161:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(122),i=n(243);e.Notifications=i;var o=n(402),s=n(169);e.Subscription=s;var a=n(128);e.Settings=a;var c=n(105);e.Account=c;var u=n(457),l=n(480);e.NavigationBar=l;var h=n(466);e.Dictionary=h;var d=n(270);e.Tooltip=d;var p=n(479);e.Modal=p;var f=n(476);e.NewEditor=f;var _=n(232);e.Card=_;var g=n(76);e.Alert=g;var m=n(235);e.AlertExamples=m;var y=n(468);e.Documents=y;var v=n(397);e.Apps=v;var b=n(393);e.Banners=b;var w=n(481);e.ProofitBanners=w;var E=n(478);e.Extension=E;var S=n(459);e.Connectivity=S;var C=n(461);e.WsConnectivity=C;var x=n(482),T=n(460),A=n(467);e.DocumentUpload=A;var k=n(458),O=n(462),R=n(163),I=n(43);e.BrowserInfo=I;var P=n(6);e.defaultState={authentication:u.defaultState,userAccount:null,notifications:i.defaultState,denaliNotifications:o.defaultState,dictionary:h.defaultState,tooltip:d.defaultState,modal:p.defaultState,overlay:p.defaultState,newEditorPage:f.editorPageDefaultState,banner:b.defaultState,documentsPage:y.defaultState,online:!0};var D=function(){function t(t,e,n,s,a,l,_,g,m,y,v,b){var w=this;this._state=t,this._authApi=e,this._institutionApi=n,this._dapi=s,this.platformInfo=a,this._dictionaryApi=l,this._irbisApi=_,this._doxApi=g,this.telemetry=m,this._appConfig=y,this._getContainerId=v,this._router=b,this._nullableUserAccount=this._state.lens(function(t){return t.userAccount}),this._userAccount=this._nullableUserAccount.filter(function(t){return null!==t}).map(function(t){return t}),this._notifications=new i.NotificationsModelImpl(this._state.lens(function(t){return t.notifications})),this._denaliNotifications=new o.DenaliNotificationsModelImpl(this._state.lens(function(t){return t.denaliNotifications}),this._router.location),this._navigateToDocument=function(t){w._router.navigate(r.Router.routes.editor.href({docId:t}))},this.unsafeUserAccount=null,this.modal=new p.ModalDialogModelImpl(this._state.lens(function(t){return t.modal}),this.platformInfo.os,this.notifications),this.overlay=new p.ModalOverlayModelImpl(this._state.lens(function(t){return t.overlay})),this.authentication=new u.AuthenticationModelImpl(this._state.lens(function(t){return t.authentication}),this._authApi,this._institutionApi,this._dapi,function(t){w._nullableUserAccount.set(t),w.unsafeUserAccount=new c.UserAccountModelImpl(w._nullableUserAccount,w._authApi,w._irbisApi,w._dapi,w._appConfig.funnel.subscribe,w._appConfig.funnel.upgrade,w._appConfig.api.subscriptionUrl,w.platformInfo.type,w.platformInfo.browser,w.telemetry,w._router,w._appConfig)},this._appConfig.funnel.signin,this._appConfig.funnel.mainPage,this._getContainerId,function(){return w._router.navigate(r.Router.routes.free.href({}))},this.modal,this.overlay,this.platformInfo.browser),this.dictionary=new h.DictionaryModelImpl(this._state.lens(function(t){return t.dictionary}),this._dictionaryApi),this.tooltip=new d.TooltipModelImpl(this._state.lens(function(t){return t.tooltip})),this._navigationBar=null,this._alertCache=new f.AlertCacheImpl(function(t){return t},function(t){return t},this._appConfig.alertCachePrefix,this._appConfig.alertCacheVersion),this._newEditorPage=null,this.connectivity=new S.ConnectivityModelImpl({network:new k.NetworkErrorHandler(this.notifications,this.overlay),wsProtocol:new k.WsProtocolErrorHandler(this.notifications,this.overlay),dox:new k.DoxErrorHandler(this.notifications,this.overlay,this.authentication),wsDox:new k.DoxErrorHandler(this.notifications,this.overlay,this.authentication),wsCapi:new k.CapiErrorHandler(this.notifications,this.overlay)}),this.networkState=new T.NetworkConnectivityModelImpl(this.connectivity,this._appConfig.api.onlineTestUrl),this.wsConnectivity=new C.WsConnectivityModelImpl(this.connectivity,{wsDox:new O.WsDoxErrorHandler(this.networkState,this.connectivity),wsCapi:new O.WsCapiErrorHandler(this.networkState,this.connectivity)}),this.selfUpdate=new x.SelfUpdate(this._router,this._appConfig.selfUpdate),this.extension=new E.ExtensionInstallModelImpl(this.platformInfo.browser,this._appConfig.extension.chrome.installURL,this._appConfig.extension.firefox.installURL,this._appConfig.extension.firefox.iconURL,this.notifications),this.apis={dox:this._doxApi},this._userAccount.distinctUntilChanged(function(t,e){return t.userProfile.id===e.userProfile.id}).subscribe(function(t){var e=t.userProfile,n=e.id,r=e.isTest;return m.setUser(n,r)}),this._userAccount.filter(function(t){return P.Async.isOk(t.subscription)&&t.userProfile.groups.has(c.UserGroups.PREMIUM_CONVERSION)}).distinctUntilChanged(function(t,e){return t.userProfile.id===e.userProfile.id}).subscribe(function(t){return R.PixelTracking.doTracking(t.userProfile,t.subscription.value,w._irbisApi)})}return Object.defineProperty(t.prototype,"notifications",{get:function(){return this._router.isActive(r.Router.routes.denali_proto_editor.href({docId:"*"})).get()||this._router.isActive(r.Router.routes.denali_editor.href({docId:"*"})).get()?this._denaliNotifications:this._notifications},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userAccount",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return this.unsafeUserAccount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"navigationBar",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return this._navigationBar=this._navigationBar||new l.NavigationBarModelImpl(this.unsafeUserAccount.features,this.platformInfo.browser,this.platformInfo.os)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"newEditorPage",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");var t=this.unsafeUserAccount,e=t.settings,n=(t.profile,t.features);return this._newEditorPage=this._newEditorPage||new f.EditorPageModelImpl(this._state.lens(function(t){return t.newEditorPage}),e,this._doxApi,this._appConfig.api.capiWsUrl,n,this.telemetry,this.modal,this._alertCache,this.wsConnectivity,this.connectivity,this._notifications,this._getContainerId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"documentsPage",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return this._documentsPage=this._documentsPage||new y.DocumentsPageModelImpl(this._state.lens(function(t){return t.documentsPage}),this._doxApi,this.unsafeUserAccount.settings,this._alertCache,this.platformInfo.browser,this.connectivity,this.notifications,this._navigateToDocument,this.unsafeUserAccount.features.enableTrackingOnDownload.get())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"documentUpload",{get:function(){var t=this;if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return this._documentUpload=this._documentUpload||new A.UploadModel(function(e){return t.documentsPage.actions.uploadDocument(e)},this._navigateToDocument,this.notifications,this.telemetry)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"apps",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return new v.AppsModelImpl(this.platformInfo.browser,this.platformInfo.os,this.extension,this.unsafeUserAccount.features.desktopApps,this.telemetry,this.unsafeUserAccount.features.showEdgeBanner)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"banners",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return new b.BannersModelImpl(this._state.lens(function(t){return t.banner}),this.platformInfo.browser,this.platformInfo.os,this.extension,this.telemetry,this.unsafeUserAccount.features.showEdgeBanner)},enumerable:!0,configurable:!0}),t}();e.AppModelImpl=D},163:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(23),i=n(488);e.DummyGnarClient=i.DummyGnarClient,e.telemetryContextType={telemetry:r.object};var o=n(487);e.EditorTelemetry=o.EditorTelemetry,e.errorSource=o.errorSource,e.accountType=o.accountType;var s=n(490);e.PixelTracking=s.PixelTracking},164:function(t,e,n){"use strict";function r(t){return!/[!$%^&*()_+|~={}\[\]:";<>?,.\/]/g.test(t)&&t.trim().length>0}function i(t){return new RegExp(["[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*","@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?"].join("")).test(t)}function o(t){setTimeout(t,0)}function s(t){var e,n=!1;return{get value(){return n?e:(e=t(),n=!0,e)}}}function a(t){}function c(t,e){return t||e}function u(t,e){return t+e}function l(t){return t.length>0}function h(t){return function(e){return e[t]}}function d(t){var e;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e||(e=t.apply(void 0,n).then(function(t){return e=null,t}).catch(function(t){throw e=null,t}))}}function p(t){return t instanceof b.Observable?t:b.Observable.of(t)}function f(t,e){return t instanceof b.Observable?t.map(e):e(t)}function _(t){return b.Observable.fromPromise(t().then(function(t){return w.Some(w.Right(t))}).catch(function(t){return w.Some(w.Left(t))})).startWith(w.None)}function g(t){for(var e,n,r=[],i=0,o=t.length;i<o;)e=t.charCodeAt(i++),55296==(63488&e)&&i<o?(n=t.charCodeAt(i++),56320==(64512&n)?r.push(((1023&e)<<10)+(1023&n)+65536):r.push(e,n)):r.push(e);return r}function m(t){return new(window.WebSocket||window.MozWebSocket)(t)}function y(t,e){var n=window;n.ddebug=n.ddebug||{},n.ddebug[t]=e}function v(t,e,n){return w.Option.map2(t,e,n).getOrElse(t.equals(e))}Object.defineProperty(e,"__esModule",{value:!0});var b=n(24),w=n(35);e.nameValidation=r,e.emailValidation=i,e.tick=o,e.lazy=s,e.noop=a,e.or=c,e.sum=u,e.notEmpty=l,e.pick=h,e.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},e.throttleByPromise=d,e.toObservable=p,e.mapMaybeObservable=f,e.promiseToStream=_,e.decode=g,e.getWebSocket=m,e.registerDebugHelper=y,e.isOptionsEq=v},165:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){t[t.updateBilling=0]="updateBilling",t[t.paymentError=1]="paymentError",t[t.subscriptionUpdated=2]="subscriptionUpdated",t[t.subscriptionCancelled=3]="subscriptionCancelled",t[t.cantUpgradeSubscription=4]="cantUpgradeSubscription",t[t.resumedSubscription=5]="resumedSubscription",t[t.cantResumeSubscription=6]="cantResumeSubscription",t[t.unknownError=7]="unknownError",t[t.mobileCancel=8]="mobileCancel",t[t.paypalSuccess=9]="paypalSuccess",t[t.paypalError=10]="paypalError"}(e.SubscriptionNotificationType||(e.SubscriptionNotificationType={}))},166:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=n(3),o=n(127),s=n(423),a=n(53),c=n(4);!function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.DISCONNECTED=2]="DISCONNECTED",t[t.CLOSED=3]="CLOSED",t[t.ANY=4]="ANY"}(r=e.States||(e.States={}));var u;!function(t){t[t.CONNECT=0]="CONNECT",t[t.CONNECTED=1]="CONNECTED",t[t.DISCONNECT=2]="DISCONNECT",t[t.SEND=3]="SEND",t[t.CLOSE=4]="CLOSE"}(u=e.Events||(e.Events={})),e.errPrintln=function(t){c.Monitoring.Logging.getLogger("coreclients.errPrintln").error("WebSocket Error",t)},e.logPrintln=function(t){c.Monitoring.Logging.root.isEnabled(c.Logging.LogLevel.TRACE)&&c.Monitoring.Logging.getLogger("coreclients.errPrintln").trace("WebSocket:",{message:t})},e.ignore=function(t){};var l=function(){function t(){var t=this;this._log=c.Monitoring.Logging.getLogger("coreclients.ws"),this._maxDelay=6e4,this._delay=1e3,this._idleTimeout=-1,this._ondisconnect=e.logPrintln,this._onerror=e.errPrintln,this._onmessage=function(e,n){t._log.warn("Default message handler used <<< ",{message:n})},this._read=function(t){try{var e=JSON.parse(t);if(e&&"object"==typeof e&&null!==e)return e}catch(t){}return t},this._write=function(t){return"string"==typeof t?t:JSON.stringify(t)}}return t.create=function(){return new t},t.prototype.setMaxReconnectDelay=function(t){return this._maxDelay=t,this},t.prototype.setInitialReconnectDelay=function(t){return this._delay=t,this},t.prototype.idle=function(t){return void 0===t&&(t=3e5),this._idleTimeout=t,this},t.prototype.writer=function(t){return this._write=t,this},t.prototype.reader=function(t){return this._read=t,this},t.prototype.onDisconnect=function(t){return this._ondisconnect=t,this},t.prototype.onMessage=function(t){return this._onmessage=t,this},t.prototype.onError=function(t){return this._onerror=t,this},t.prototype.connect=function(t){return i.__awaiter(this,void 0,void 0,function(){var e,n,s=this;return i.__generator(this,function(i){return e=new o.StateMachine(r.DISCONNECTED,r.CLOSED).with(r.ANY).parentOf(r.CLOSED,r.CONNECTED,r.CONNECTING,r.DISCONNECTED).from(r.CONNECTING).to(r.CONNECTED).on(u.CONNECTED).from(r.CONNECTED,r.CONNECTING).to(r.DISCONNECTED).on(u.DISCONNECT).from(r.DISCONNECTED).to(r.CONNECTING).on(u.CONNECT).from(r.ANY).to(r.CLOSED).on(u.CLOSE).from(r.CONNECTED).to(r.CONNECTED).on(u.SEND).on(r.DISCONNECTED,function(t){return s._ondisconnect(t.args)}),n=new d(this._maxDelay,this._delay),n.initReconnect(t,function(t){return s._createWebSocket(t,e,n)}),[2,this._createWebSocket(t,e,n)]})})},t.prototype._createWebSocket=function(t,e,n){return i.__awaiter(this,void 0,void 0,function(){var o=this;return i.__generator(this,function(a){return[2,new Promise(function(a,c){return i.__awaiter(o,void 0,void 0,function(){var o,l,d=this;return i.__generator(this,function(_){switch(_.label){case 0:return[4,e.event(u.CONNECT)];case 1:return(o=_.sent())?(this._log.debug("Connecting to "+t),l=new s.w3cwebsocket(t),l.onopen=function(t){return i.__awaiter(d,void 0,void 0,function(){var t,o,s=this;return i.__generator(this,function(i){switch(i.label){case 0:return[4,e.event(u.CONNECTED)];case 1:return(t=i.sent())?(o=new h(l,e,this._write),l.onmessage=function(t){n.reset(),s._onmessage(o,s._read(t.data))},a(o),[2]):(c(new Error("WebSocket [ERROR] FSM cannot be switched to CONNECTED state from "+r[e.current])),l.close(4e3,"WebSocket lib initialized"),[2])}})})},l.onclose=function(r){d._log.info("Connection to "+t+" closed",r);var i=new f({status:r.reason,message:"Connection to "+r.reason+" closed",code:r.code,url:t,event:r});e.event(u.DISCONNECT,new p(i,n))},l.onerror=function(r){try{var i=new f({status:"ws_error",message:"WebSocket error",url:t});try{d._onerror(i)}catch(t){d._log.error("OnError handler thrown an error",t)}e.event(u.DISCONNECT,new p(i,n))}finally{c(r)}},[2]):(c(new Error("\n          WebSocket [ERROR] FSM provided cannot be switched to CONNECTING state from "+r[e.current]+"\n        ")),[2])}})})})]})})},t}();e.WS=l;var h=function(){function t(t,e,n){this._ws=t,this._fsm=e,this.write=n}return t.prototype.send=function(t){var e=this;this._fsm.event(u.SEND).then(function(n){if(!n)throw new Error("WebSocket [ERROR]: Trying to send on invalid connection state: "+e._fsm.current);e._ws.send(e.write(t))})},t.prototype.close=function(){var t=this;return this._fsm.event(u.CLOSE).then(function(e){if(!e)throw new Error("WebSocket [ERROR]: Trying to close connection which already closed or had invalid state: "+t._fsm.current);t._ws.close()})},Object.defineProperty(t.prototype,"url",{get:function(){return this._ws.url},enumerable:!0,configurable:!0}),t}();e.WSConnection=h;var d=function(){function t(t,e){this._maxDelay=t,this._initialDelay=e,this._log=c.Monitoring.Logging.getLogger("coreclients.wsreconnect"),this._prevDelay=0,this._reconnectCounter=0}return Object.defineProperty(t.prototype,"url",{set:function(t){this._log.info("WebSocket [INFO]: Url was overwritten "+this._url+" to "+t+" after disconnect"),this._url=t},enumerable:!0,configurable:!0}),t.prototype.initReconnect=function(t,e){this._reconnect=e,this._url=t},Object.defineProperty(t.prototype,"delay",{get:function(){return this._prevDelay},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reconnectCounter",{get:function(){return this._reconnectCounter},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._reconnectCounter=0,this._prevDelay=0},Object.defineProperty(t.prototype,"nextDelay",{get:function(){return Math.min(this._maxDelay,Math.max(this._initialDelay,2*this._prevDelay))},enumerable:!0,configurable:!0}),t.prototype.scheduleReconnect=function(t){return void 0===t&&(t=this.nextDelay),i.__awaiter(this,void 0,void 0,function(){var e=this;return i.__generator(this,function(n){if(t<0)throw new Error("WebSocket [ERROR]: Negative delay is not allowed: "+t);return 0===t?[2,this.reconnectNow()]:[2,new Promise(function(n,r){var i=function(){return e.reconnectNow(e._url).then(function(t){n(t)}).catch(function(t){return r(t)})};e._log.debug("Reconnecting to "+e._url+" after timeout "+t),e.cancelReconnect(),e._timer=setTimeout(i,t),e._prevDelay=t})]})})},t.prototype.reconnectNow=function(t){return void 0===t&&(t=this._url),i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(e){if(!this._reconnect)throw new Error("WebSocket [ERROR]: Reconnect is not set, consider setting it before reconnect will be triggered");return this.cancelReconnect(),this._reconnectCounter++,[2,this._reconnect(t)]})})},t.prototype.cancelReconnect=function(){this._timer&&clearTimeout(this._timer)},t}();e.WSReconnect=d;var p=function(){function t(t,e){this._error=t,this.reconnect=e}return t.prototype.toString=function(){return this._error.message},Object.defineProperty(t.prototype,"code",{get:function(){return this._error.code},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reason",{get:function(){return"WebSocket [CLOSE]: statusCode="+this._error.code+" reason: "+this._error.status},enumerable:!0,configurable:!0}),t}();e.WSCloseReason=p;var f=function(t){function e(e){var n=e.code,r=void 0===n?-1:n,i=e.status,o=e.url,s=e.message,a=e.body,c=(e.event,t.call(this,s)||this);return c.name="WSError",c.url=o,c.code=r,c.body=a,c.status=i,c}return i.__extends(e,t),e}(a.CustomError);e.WSError=f},167:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(53),o=n(104),s=function(){function t(t,e){void 0===e&&(e=0),this._operations=t,this.rev=e}return t.prototype.toString=function(){return this._operations.map(function(t){return t.toString()}).join(" ")},t.prototype.withRevision=function(e){return new t(this._operations,e)},Object.defineProperty(t.prototype,"revision",{get:function(){return this.rev},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"operations",{get:function(){return this._operations},enumerable:!0,configurable:!0}),t.prototype.apply=function(t){for(var e=this.sequencify(),n=0,r=e._operations;n<r.length;n++){t=r[n].apply(t)}return t},t.prototype.sequencify=function(){var e=this,n=[];return this._operations.forEach(function(t){if("="!==t.type){var r=[t];n.forEach(function(t){r=r.map(function(n){return n.transformAgainst(t,e.rev,e.rev)}).reduce(function(t,e){return t.concat(e)},[])}),n=n.concat(r)}}),new t(n,this.rev)},t.prototype.transformAgainst=function(e){var n=this;if(e instanceof t){var r=[],i=e;return i=i.sequencify(),this._operations.forEach(function(t){var e=[t];i._operations.forEach(function(t){e=e.map(function(e){return e.transformAgainst(t,n.rev,i.rev)}).reduce(function(t,e){return t.concat(e)},[])}),r=r.concat(e)}),new t(r,this.rev)}throw new Error("Should be transformed only against Changesets")},t.prototype.pack=function(t){var e=this;return this._operations.map(function(n){return n.pack(t||e.rev)}).join("")},t.unpack=function(e){if(Array.isArray(e))throw new Error("Illegal argument "+e);if(""===e)return new t([]);var n=e.match(/(\+|-|=)\w+?:\w+?:[^:]*?:\w+/g);if(!n)throw new Error("Cannot unpack invalid serialized changeset string");var r=0;return new t(n.filter(function(t){return!t.startsWith("=")}).map(function(t){var e=t.substr(1).split(":");r=parseInt(e[3],36);var n=t.substr(0,1);return new o.Operation(n,parseInt(e[0],36),e[2].replace(/%3A/gi,":").replace(/%25/g,"%"),parseInt(e[1],36))}),r)},t}();e.Changesets=s;var a=function(t){function e(e){void 0===e&&(e="Unknown reason");var n=t.call(this,e)||this;return n.name="OTError",n.reason=e,n}return r.__extends(e,t),e}(i.CustomError);e.OTError=a;var c=function(t){function e(e){void 0===e&&(e="removed");var n=t.call(this,e)||this;return n.name="OTRemoveError",n}return r.__extends(e,t),e}(a);e.OTRemoveError=c;var u=function(){function t(t,e,n,r){void 0===n&&(n=function(){}),void 0===r&&(r=function(){}),this.changes=t,this.revision=e,this.successCallback=n,this.failureCallback=r,this._cs=new s(this.changes,this.revision)}return t.prototype.apply=function(t){return this._cs.apply(t)},t.prototype.pack=function(){return this._cs.pack()},t}();e.Revision=u;var l=function(t){function e(e,n){return void 0===n&&(n=0),t.call(this,e,n)||this}return r.__extends(e,t),e.prototype.sequencify=function(){return this},e}(s);e.OperationsSet=l;var h=function(){function t(t){void 0===t&&(t=0),this._operations=[],this._staging=!1,this._revision=t}return Object.defineProperty(t.prototype,"revision",{get:function(){return this._revision},enumerable:!0,configurable:!0}),t.prototype.push=function(t,e,n){this.pushAll([t],e,n)},t.prototype.pushAll=function(t,e,n){var r=new u(t,++this._revision,e,n);this._operations.push(r)},t.prototype.clear=function(t,e){void 0===e&&(e=0);var n="string"==typeof t?t:t.message;this._operations.forEach(function(t){return t.failureCallback(new a(n))}),this._operations=[],this._revision=e,this._staging=!1},t.prototype.acknowledge=function(t){if(this._staging){this._staging=!1;var e=this._operations.shift();e&&e.successCallback(t)}},t.prototype.forEach=function(t){this._operations.forEach(function(e){return t(new s(e.changes,e.revision))})},t.prototype.remove=function(){var t=this._operations.shift();return t&&(this._staging=!1,t.failureCallback(new c)),void 0!==t},t.prototype.poll=function(){var t=this._operations.slice(0,1);return 0===t.length?null:(this._staging=!0,t[0])},t.prototype.pop=function(){var t=this._operations.shift();return void 0===t?null:t},t.prototype.popAll=function(){if(this.isStaging)throw new Error("Invalid state");var t=this._operations;return this._operations=[],t},t.prototype.reload=function(t,e){if(this._staging){var n=this._operations.slice(0,1);if(0!==n.length){try{var r=n[0];e=new s(r.changes,t._revision).apply(e),t.pushAll(r.changes,r.successCallback,r.failureCallback),t._staging=!0}catch(t){}this.remove()}}try{for(var i=e,o=0,c=this._operations;o<c.length;o++){var u=c[o];i=new s(u.changes,t._revision).apply(i)}e=i;for(var l=0,h=this._operations;l<h.length;l++){var u=h[l];t.pushAll(u.changes,u.successCallback,u.failureCallback)}}catch(t){for(var d=0,p=this._operations;d<p.length;d++){var u=p[d];u.failureCallback(new a("cannot be applied"))}}return e},Object.defineProperty(t.prototype,"length",{get:function(){return this._operations.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isStaging",{get:function(){return this._staging},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this._operations.length},enumerable:!0,configurable:!0}),t.prototype.transformAgainst=function(t,e){void 0===e&&(e=t.revision);var n=e+1;return this._operations=this._operations.map(function(e){var r=new s(e.changes,n),i=t.transformAgainst(r),o=r.transformAgainst(t);return t=i,new u(o.operations,o.revision,e.successCallback,e.failureCallback)}),this._revision=this.isEmpty?e:this._operations[this.length-1].revision,t.withRevision(t.revision)},t.prototype.getChangesSince=function(t){return this._operations.filter(function(e){return e.revision>t}).map(function(t){return new s(t.changes,t.revision)})},t}();e.ChangesetsQueue=h},168:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r;!function(t){t[t.words=0]="words",t[t.characters=1]="characters",t[t.speakingTime=2]="speakingTime",t[t.readingTime=3]="readingTime"}(r=e.TextStatsView||(e.TextStatsView={})),e.defaultState={textStatsView:r.words};var i=[r.words,r.characters,r.readingTime,r.speakingTime],o=function(){function t(t){this._state=t,this.textStatsView=this._state.lens(function(t){return t.textStatsView})}return t.prototype.toggleTextStatsView=function(){this.textStatsView.set(i[(i.indexOf(this.textStatsView.get())+1)%i.length])},t}();e.TextStatsModelImpl=o},169:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(53),i=n(10),o=n(4),s=n(6),a=n(165),c=n(483),u=n(484),l=n(501);e.defaultState=s.Async.defaultValue();var h=function(){function t(n,o,l,h,d,p,f){var _=this;this.state=n,this._irbisApi=o,this._subscribeUrl=l,this._upgradeBaseUrl=h,this._subscriptionUrl=d,this._browserType=p,this._telemetry=f,this._notification=i.Atom.create(null),this._operation=null,this._getSubsciption=function(){return _._irbisApi.getStatus().then(function(t){return t.plans||(t.plans=[]),t})},this._updateSubscriptionState=function(){return _._getSubsciption().then(function(t){return _.state.set(s.Async.ok(t)),t})},this.notification=this._notification,this.braintreeApi=new c.BraintreeModelImpl(this,this._irbisApi,this._updateSubscriptionState),this.paypalApi=new u.PayPalModelImpl(this,this._irbisApi,this._updateSubscriptionState),this.browserType=this._browserType,this.ensureHasSubscription=function(){r.invariant(null!==_._operation,"operation must be created"),_._operation=_._operation;var t=_.state.get();s.Async.isOk(t)||s.Async.isInProgress(t)||(s.Async.isError(t)&&_._operation.unsubscribe(),_._operation=null,_.state.set(e.defaultState),_._createOperation())},this.setNotification=function(t,e){requestAnimationFrame(function(){return _._notification.set({type:t,planName:e})})},this._createOperation(),this.state.subscribe(function(e){s.Async.isError(e)&&1===e.attempt?t._log.warn("cant get user subscription",e.error):s.Async.isFatal(e)&&(t._log.error("cant get user subscription",e.error),_.setNotification(a.SubscriptionNotificationType.unknownError))})}return t.prototype.clearNotification=function(){this._notification.set(null)},t.prototype.changePlan=function(e){var n=this;return this.clearNotification(),this._irbisApi.changePlan(e).then(this._updateSubscriptionState).then(function(t){n.setNotification(a.SubscriptionNotificationType.subscriptionUpdated,t.queuedPlan&&t.queuedPlan.title||t.currentPlan.title)}).catch(function(e){n.setNotification(a.SubscriptionNotificationType.cantUpgradeSubscription),t._log.error("changePlan: cantUpgradeSubscription",e)})},t.prototype.cancelSubscription=function(){var e=this;return this._telemetry.confirmSubscriptionCancelClicked(),this.clearNotification(),this._irbisApi.cancelSubscription().then(this._updateSubscriptionState).then(function(){return e.setNotification(a.SubscriptionNotificationType.subscriptionCancelled)}).catch(function(n){e.setNotification(a.SubscriptionNotificationType.unknownError),t._log.error("cancelSubscription: unknownError",n)})},t.prototype.renewSubscription=function(){var e=this;return this._telemetry.reactivateSubscriptionClicked(),this.clearNotification(),this._irbisApi.renewSubscription().then(this._updateSubscriptionState).then(function(){return e.setNotification(a.SubscriptionNotificationType.resumedSubscription)}).catch(function(n){e.setNotification(a.SubscriptionNotificationType.cantResumeSubscription),t._log.error("renewSubscription: cantResumeSubscription",n)})},t.prototype.navigateToSubscribeUrl=function(){document.location.href=this._subscribeUrl},t.prototype.navigateToUpgradeUrl=function(t,e){var n=l.getUpgradeUrl(this._upgradeBaseUrl,t,e);window.parent===window?document.location.href=n:s.Extension.actions.openUrl(n)},t.prototype.downloadBillingReceipts=function(){var t=this;return this._irbisApi.checkDownloadBillingReceipts().then(function(){return window.location.href=t._subscriptionUrl+"/receipt",t._telemetry.downloadReceiptButtonClicked(),s.delay(500)}).then(s.noop).catch(function(e){t.setNotification(a.SubscriptionNotificationType.unknownError),t._telemetry.downloadReceiptError(e)})},t.prototype._createOperation=function(){r.invariant(null===this._operation,"cant create another operation"),this._operation=s.Async.OperationRetrier.create(this._getSubsciption,this.state,s.Async.OperationRetrier.RetryStrategy.conditional(function(t){return 401!==t.code},s.Async.OperationRetrier.RetryStrategy.linear(3,3e3)))},t._log=o.Monitoring.Logging.getLogger("model.subscription"),t}();e.SubscriptionModelImpl=h},229:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(15),o=n(10),s=n(689);e.Spinner=function(t){var e=t.className,n=void 0!==e&&e,a=t.size,c=void 0===a?18:a,u=t.color,l=void 0===u?"#666":u,h={width:c+"px",height:c+"px",backgroundColor:l};return i.createElement("div",r.__assign({},o.classes(s.spinner,n)),i.createElement("div",{style:h,className:s.item}),i.createElement("div",{style:h,className:s.item}),i.createElement("div",{style:h,className:s.item}))}},230:function(t,e,n){"use strict";function r(t,e){if(!t||!t.parentElement)return!1;var n=t.className;return"string"==typeof n&&n.indexOf(e)>-1||r(t.parentElement,e)}function i(t,e){if(!e)return!1;for(;e.parentNode;){if(t===e.parentNode)return!0;e=e.parentNode}return!1}function o(t,e){return{top:t.top-e.top,bottom:t.bottom-e.bottom,left:t.left-e.left,right:t.right-e.right,width:t.width,height:t.height}}function s(t,e){return{top:t.top-e.top,bottom:t.bottom-e.top,left:t.left-e.left,right:t.right-e.left,width:t.width,height:t.height}}function a(t){if(!t)throw new Error("elem should not be null or undefined");var e=t.getBoundingClientRect();if(e.width||e.height){var n=t.ownerDocument,r=window,i=n.documentElement;return{top:e.top+r.pageYOffset-i.clientTop,left:e.left+r.pageXOffset-i.clientLeft,width:e.width,height:e.height}}return e}function c(t){return"true"===t.dataset.disabled}function u(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.filter(Boolean).join(" ")}Object.defineProperty(e,"__esModule",{value:!0}),e.hasParentWithClassName=r,e.isParent=i,e.absToRelativeBuggy=o,e.absToRelative=s,e.getOffset=a;!function(t){function e(t,e){var n=e.x,r=e.y;return Math.trunc(t.top)<=Math.trunc(r)&&Math.trunc(t.bottom)>=Math.trunc(r)&&Math.trunc(t.left)<=Math.trunc(n)&&Math.trunc(t.right)>=Math.trunc(n)}t.empty={top:0,bottom:0,left:0,right:0,height:0,width:0},t.hasPoint=e}(e.Rect||(e.Rect={})),e.isDisabled=c,e.classes=u},231:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CardBaseClassName="cardBaseClassName";!function(t){function e(t,e){return{kind:"single",alertId:t,action:e}}function n(t){return{kind:"batchIgnore",alertIds:t}}function r(t){return"single"===t.kind}function i(t){return"batchIgnore"===t.kind}t.createSingle=e,t.createBatchIgnore=n,t.isSingle=r,t.isBatchIgnore=i}(e.AppliedAlertAction||(e.AppliedAlertAction={}));!function(t){t[t.idle=0]="idle",t[t.inProgress=1]="inProgress",t[t.finished=2]="finished"}(e.CheckingStatus||(e.CheckingStatus={}))},232:function(t,e,n){"use strict";function r(t){var e=t.category,n=t.extraProperties,r=t.todo;return"Unknown"===e?"Unknown word":"Misspelled"===e?"":n.isDidYouMean||n.isShowTitle?"Check word usage":r}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(10),s=n(4),a=n(76),c=n(394),u=n(233),l=n(6);e.DEFAULT_CARD_HEIGHT=36;var h;!function(t){t[t.expanded=0]="expanded",t[t.expandedMore=1]="expandedMore",t[t.collapsed=2]="collapsed",t[t.applied=3]="applied",t[t.hidden=4]="hidden"}(h=e.VisualState||(e.VisualState={})),e.defaultState={hovered:!1,expandButtonHovered:!1,undoButtonHovered:!1,transientVisualState:h.collapsed},e.defaultSynonymState={hovered:!1,expandButtonHovered:!1,undoButtonHovered:!1,transientVisualState:h.expanded};var d=function(){function t(t,e){this._state=t,this._focused=e,this._transientVisualState=this._state.lens(function(t){return t.transientVisualState}),this.visualState=o.Atom.combine(this._transientVisualState,this._focused,function(t,e){return e?t===h.collapsed?h.expanded:t:t===h.expanded||t===h.expandedMore?h.collapsed:t}),this.isExpanded=this._transientVisualState.view(function(t){return t===h.expanded}),this.isExpandedMore=this._transientVisualState.view(function(t){return t===h.expandedMore}),this.isApplied=this._transientVisualState.view(function(t){return t===h.applied}),this.isHidden=this._transientVisualState.view(function(t){return t===h.hidden}),this.isActive=this._transientVisualState.view(function(t){return t===h.expanded||t===h.expandedMore}),this.isExpandButtonHovered=this._state.lens(function(t){return t.expandButtonHovered}),this.isUndoButtonHovered=this._state.lens(function(t){return t.undoButtonHovered}),this.isCardHovered=this._state.lens(function(t){return t.hovered})}return t.prototype._transitionState=function(t,e){var n,r,i=this;if(this._transientVisualState.modify(function(e){var o=i.visualState.get(),s=t.find(function(t){return void 0!==t.from.find(function(t){return o===t})});if(s)return n=o,r=s.to,s.to;throw new TypeError("Can't transition Card from "+h[o])}),void 0===n||void 0===r)throw new l.InvariantError("Expected modify to complete by this point");e&&e(n,r)},t}();e.CardModelStateImpl=d;var p=function(t){function e(e,n,r){var i=t.call(this,e,r.isFocused(n.id))||this;return i._editorEngine=r,i.replace=function(t){i._applyThisAlert({action:"replace",replacementText:t,isSynonym:!1})},i.id=n.id,i.title=n.title,i}return i.__extends(e,t),e.prototype.toggleExpand=function(){var t=this.visualState.get()===h.collapsed;t?this._editorEngine.setFocusedAlert(this.id,"click"):(this._editorEngine.setHighlightedAlert(null),this._editorEngine.setFocusedAlert(null,null)),this._transitionState([{from:[h.expanded,h.expandedMore],to:h.collapsed},{from:[h.collapsed],to:h.expanded}]),t&&e._cardExpandCounter.increment()},e.prototype.hoverExpandButton=function(){this.isExpandButtonHovered.set(!0)},e.prototype.unhoverExpandButton=function(){this.isExpandButtonHovered.set(!1)},e.prototype.hoverUndoButton=function(){this.isUndoButtonHovered.set(!0)},e.prototype.unhoverUndoButton=function(){this.isUndoButtonHovered.set(!1)},e.prototype.hoverCard=function(){this._editorEngine.setHighlightedAlert(this.id),this.isCardHovered.set(!0)},e.prototype.unhoverCard=function(){this._editorEngine.setHighlightedAlert(null),this.isCardHovered.set(!1)},e.prototype.toggleMore=function(){this._transitionState([{from:[h.expanded],to:h.expandedMore},{from:[h.expandedMore],to:h.expanded}])},e.prototype.expand=function(){this._transitionState([{from:[h.collapsed],to:h.expanded}])},e.prototype.collapse=function(){this._transitionState([{from:[h.expanded,h.expandedMore],to:h.collapsed}])},e.prototype.showMore=function(){this._transitionState([{from:[h.expanded],to:h.expandedMore}])},e.prototype.showLess=function(){this._transitionState([{from:[h.expandedMore],to:h.expanded}])},e.prototype.hide=function(){this._transitionState([{from:[h.applied],to:h.hidden}])},e.prototype._applyThisAlert=function(t){this._editorEngine.applyAlert(this.id,t),this._transitionState([{from:[h.expanded,h.expandedMore,h.collapsed],to:h.applied}]),e._cardApplyCounter.getCounter(t.action).increment()},e.prototype.ignore=function(){this._applyThisAlert({action:"ignore"})},e.prototype.acknowledge=function(){this._applyThisAlert({action:"acknowledge"})},e.prototype.addToDictionary=function(){this._applyThisAlert({action:"addToDictionary"})},e.prototype.undoInteraction=function(){this._editorEngine.undoLastAlertAction(),this.unhoverUndoButton(),this._transitionState([{from:[h.applied],to:h.collapsed}])},e._cardExpandCounter=s.Monitoring.TimeSeries.root.getCounter("cards.expand"),e._cardApplyCounter=s.Monitoring.TimeSeries.root.getCounter("cards.apply"),e}(d);e.CardModelBaseImpl=p;var f=function(t){function e(e,n,r,i){var o=t.call(this,e,n,r)||this;return o._alert=n,o._features=i,o.kind="common",o.highlightText=o._alert.highlightText,o.isTextCard=u.isNoReplacement(o._alert.replacements),o.isUnknowWord="Unknown"===o._alert.category,o.details=o._alert.details,o.examples=o._alert.examples,o.explanation=o._alert.explanation,o.extraProperties=o._alert.extraProperties,o.hasReplacementsInContent=!u.isNoReplacement(o._alert.replacements)&&!!o.extraProperties.isShowTitle,o.hasAcknowledgeButton=0===o._alert.replacements.length&&o._alert.group!==a.AlertGroup.contextualSpelling,o.hasAddToDictionary=!!o._alert.extraProperties.hasAddToDictionary,o.showFullCard=o._features.showFullCards.get().enabled,o.isShowMore=Boolean(!o.showFullCard&&(o.details||o.examples&&o.examples.length)),o.hideTitleInEDUCard=o._features.hideTitleInEDUCard.get().enabled,o}return i.__extends(e,t),e.prototype.getHeader=function(t,e){return new c.CommonHeaderModelImpl(this.title,this._alert.todo,this._alert.replacements,t,e,this._alert.extraProperties,this._features.quickReplacementsInCard.get().enabled,this.replace)},e.prototype.getFooterProps=function(){return{hasAcknowledgeButton:this.hasAcknowledgeButton,hasAddToDictionary:this.hasAddToDictionary,isShowMore:this.isShowMore}},e.prototype.getReplacements=function(){var t=this._alert,e=t.category,n=t.extraProperties,i=t.todo;return u.getReplacementListModel({title:r({category:e,extraProperties:n,todo:i}),replacements:this._alert.replacements,onReplace:this.replace})},e}(p);e.CommonCardModelImpl=f;var _=function(t){function e(e,n,r){var i=t.call(this,e,n,r)||this;return i._alert=n,i.kind="plagiarism",i.url=i._alert.url,i.description=i._alert.description,i.reference=i._alert.reference,i}return i.__extends(e,t),e.prototype.getHeader=function(t,e){return new c.PlagiarismHeaderModelImpl(this.title,t,e,this._alert.url)},e}(p);e.PlagiarismCardModelImpl=_;var g=function(t){function e(e,n,r,i){var o=t.call(this,e,n,r)||this;return o._alert=n,o._features=i,o.kind="enhancement",o.details=o._alert.details,o.examples=o._alert.examples,o.explanation=o._alert.explanation,o.hasReplacements=!u.isNoReplacement(o._alert.replacements),o.hasAcknowledgeButton=!o.hasReplacements,o.hasAddToDictionary=!1,o.showFullCard=o._features.showFullCards.get().enabled,o.isShowMore=Boolean(!o.showFullCard&&(o.details||o.examples&&o.examples.length)),o.isVisibleQuickReplacement=o._features.quickReplacementsInCard.get().enabled,o}return i.__extends(e,t),e.prototype.getReplacements=function(){var t=this._alert,e=t.category,n=t.extraProperties,i=t.todo;return u.getReplacementListModel({title:r({category:e,extraProperties:n,todo:i}),replacements:this._alert.replacements,onReplace:this.replace})},e.prototype.getHeader=function(t,e){return new c.EnhancementHeaderModelImpl(this.title,t,e,this.isVisibleQuickReplacement)},e.prototype.getFooterProps=function(){return{hasAcknowledgeButton:this.hasAcknowledgeButton,hasAddToDictionary:this.hasAddToDictionary,isShowMore:this.isShowMore}},e}(p);e.EnhancementCardModelImpl=g;var m=function(t){function e(e,n,r){var i=t.call(this,e,r.isFocused(n.id))||this;return i._alert=n,i._editorEngine=r,i.kind="synonyms",i.visualState=i._transientVisualState,i.replace=function(t){i._applyThisAlert({action:"replace",replacementText:t,isSynonym:!0})},i.id=i._alert.id,i.title=i._alert.title,i.explanation="",i.details="",i.examples=[],i.meanings=i._alert.meanings.map(function(t){return{title:t.title,list:u.getReplacementFlatListModel({title:t.title,replacements:t.replacements,onReplace:function(t){return i.replace(t)}})}}),i.isAnyMeanings=Boolean(i.meanings.length),i}return i.__extends(e,t),e.prototype._applyThisAlert=function(t){this._editorEngine.applyAlert(this.id,t),this._transitionState([{from:[h.expanded,h.expandedMore,h.collapsed],to:h.applied}])},e.prototype.hide=function(){this._transitionState([{from:[h.applied],to:h.hidden}])},e.prototype.collapse=function(){this._transientVisualState.get()!==h.hidden&&this._transitionState([{from:[h.expanded],to:h.hidden}])},e.prototype.undoInteraction=function(){this._editorEngine.undoLastAlertAction(),this._transitionState([{from:[h.applied],to:h.expanded}])},e.prototype.select=function(){this._editorEngine.setHighlightedAlert(this.id)},e.prototype.deselect=function(){this._editorEngine.setHighlightedAlert(null)},e}(d);e.SynonymsCardModelImpl=m},233:function(t,e,n){"use strict";function r(t){return t.map(function(t){return t.transform}).every(function(t){return t.every(function(t){return"delete"!==t.type})})&&2===t.length}function i(t){return 1===t.length}function o(t){return t.reduce(function(t,e){return t+("arrow"!==e.type?e.text.length:0)},0)>35}function s(t){var e=t.filter(function(t){return"delete"===t.type});if(0===e.length)return!1;var n=e[0],r=n.text.replace(/,/g,"").split(" ").filter(Boolean)||[];return n.text.match(/^,(.*?),$/)&&n.text.length>2&&r.length>1}function a(t){return!t||0===t.length}function c(t){var e=t.isDidYouMean,n=t.isActive,c=t.replacements,u=t.todo,l=t.onReplace;if(a(c))return new p;var y="Click to "+u;return e?new g(y,c[0],l):r(c)?new h(y,c[0],c[1],l):o(c[0].transform)?new m(y,c,l):s(c[0].transform)?new _(y,c[0],l):i(c)?new f(y,c[0],l):new d(y,n,c,l)}Object.defineProperty(e,"__esModule",{value:!0});var u,l=n(3);!function(t){t[t.or=0]="or",t[t.single=1]="single",t[t.list=2]="list",t[t.flatList=3]="flatList",t[t.multi=4]="multi",t[t.multiExpanded=5]="multiExpanded",t[t.long=6]="long",t[t.didYouMean=7]="didYouMean",t[t.sideCommas=8]="sideCommas",t[t.empty=9]="empty"}(u=e.CardReplacementTemplate||(e.CardReplacementTemplate={})),e.isOrReplacement=r,e.isSingleReplacement=i,e.isLongReplacement=o,e.isSideCommasReplacement=s,e.isNoReplacement=a;var h=function(){function t(t,e,n,r){var i=this;this.tooltipText=t,this._replacement1=e,this._replacement2=n,this._onReplace=r,this.template=u.or,this.transform1=this._replacement1.transform,this.transform2=this._replacement2.transform,this.onReplace1=function(){return i._onReplace(i._replacement1.newText)},this.onReplace2=function(){return i._onReplace(i._replacement2.newText)}}return t}();e.CardReplacementOr=h;var d=function(){function t(t,e,n,r){var i=this;this.tooltipText=t,this.isExpanded=e,this.replacements=n,this._onReplace=r,this.getOnReplace=function(t){return function(){return i._onReplace(t.newText)}},this.template=this.isExpanded?u.multiExpanded:u.multi}return t.prototype.getTitleReplacement=function(){return new f(this.tooltipText,this.replacements[0],this._onReplace)},t}();e.CardReplacementMulti=d;var p=function(){function t(){this.template=u.empty,this.tooltipText=""}return t}();e.EmptyReplacement=p;var f=function(){function t(t,e,n){var r=this;this.tooltipText=t,this._replacement=e,this._onReplace=n,this.transform=this._replacement.transform,this.onReplace=function(){return r._onReplace(r._replacement.newText)},this.template=u.single}return t}();e.CardReplacementSingle=f;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.template=u.sideCommas,e}return l.__extends(e,t),e}(f);e.CardReplacementSideCommas=_;var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.template=u.didYouMean,e}return l.__extends(e,t),e}(f);e.CardReplacementDidYouMean=g;var m=function(){function t(t,e,n){var r=this;this.tooltipText=t,this.replacements=e,this._onReplace=n,this.getOnReplace=function(t){return function(){return r._onReplace(t.newText)}},this.template=u.long}return t}();e.CardReplacementLong=m;var y=function(){function t(t,e,n){var r=this;this.headerText=t,this.replacements=e,this._onReplace=n,this.template=u.list,this.tooltipText="",this.getOnReplace=function(t){return function(){return r._onReplace(t.newText)}}}return t}();e.CardReplacementList=y;var v=function(t){function e(e,n,r){var i=t.call(this,e,n,r)||this;return i.headerText=e,i.template=u.flatList,i}return l.__extends(e,t),e}(y);e.CardReplacementFlatList=v,e.getReplacementModel=c,e.getReplacementListModel=function(t){var e=t.title,n=t.replacements,r=void 0===n?[]:n,i=t.onReplace;return new y(e,r,i)},e.getReplacementFlatListModel=function(t){var e=t.title,n=t.replacements,r=void 0===n?[]:n,i=t.onReplace;return new v(e,r,i)}},234:function(t,e,n){"use strict";function r(t,n){var r=n?e.DefaultAcademicGenresTitleMap[t]:e.GenresTitleMap[t];if(!r)throw new TypeError("Coudn't find title for "+t);return r}function i(t){return{contextualSpelling:t,grammar:t,sentenceStructure:t,punctuation:t,style:t,enhancement:t,plagiarism:t}}function o(t,e){return Object.assign({},t,{plagiarism:e})}Object.defineProperty(e,"__esModule",{value:!0});var s=n(76);e.GenresTitleMap={general:"General (default)",academic:"Academic",academic_general:"General academic",academic_essay:"Essay",academic_report:"Report",academic_case:"Case study",academic_review:"Book/literature review",academic_proposal:"Research proposal",academic_results:"Research results",academic_disser:"Dissertation",academic_letter:"Admission letter",business:"Business",business_other:"General business",business_letter:"Business letter",business_email:"Business email",business_report:"Report",business_memo:"Memo",business_proposal:"Proposal",business_article:"Article/blog post",business_adv:"Ad/website copy",technical:"Technical",technical_other:"General technical",technical_manual:"End-user assistance document",technical_documentation:"Technical documentation",technical_marketing:"Marketing document",medical:"Medical",medical_other:"General medical",medical_regulatory:"Regulatory writing",medical_educational:"Educational writing",creative:"Creative",creative_other:"General creative",creative_nonfiction:"Creative non-fiction",creative_novel:"Novel",creative_script:"Script",creative_story:"Short story",casual:"Casual",casual_other:"General casual",casual_email:"Personal email",casual_blog:"Personal blog post"},e.DefaultAcademicGenresTitleMap=Object.assign({},e.GenresTitleMap,{general:"General",academic_general:"General academic (default)"}),e.getGenreMenuTitle=r,e.createChecksDefaultState=i,e.setPlagiarism=o,e.defaultState={contextualSpelling:!0,grammar:!0,sentenceStructure:!0,punctuation:!0,style:!0,enhancement:!0,plagiarism:!1};var a=function(){function t(t,e,n){this._genre=t,this._checks=e,this._telemetry=n,this.genre=this._genre,this.contextualSpellingEnabled=this._checks.lens(function(t){return t.contextualSpelling}),this.grammarEnabled=this._checks.lens(function(t){return t.grammar}),this.sentenceStructureEnabled=this._checks.lens(function(t){return t.sentenceStructure}),this.punctuationEnabled=this._checks.lens(function(t){return t.punctuation}),this.styleEnabled=this._checks.lens(function(t){return t.style}),this.enhancementEnabled=this._checks.lens(function(t){return t.enhancement}),this.plagiarismEnabled=this._checks.lens(function(t){return t.plagiarism}),this.checksEnabled=this._checks}return t.prototype.setGenre=function(t){this._genre.set(t)},t.prototype.toggleFreemiumChecks=function(){var t=[this.contextualSpellingEnabled,this.grammarEnabled,this.punctuationEnabled,this.sentenceStructureEnabled,this.styleEnabled],e=t.some(function(t){return t.get()});t.forEach(function(t){return t.set(!e)}),this._telemetry.settingsToggled(!e,"all")},t.prototype.isAlertGroupEnabled=function(t){var e=this._checks.get();return t===s.AlertGroup.contextualSpelling&&e.contextualSpelling||t===s.AlertGroup.enhancement&&e.enhancement||t===s.AlertGroup.grammar&&e.grammar||t===s.AlertGroup.plagiarism&&e.plagiarism||t===s.AlertGroup.punctuation&&e.punctuation||t===s.AlertGroup.sentenceStructure&&e.sentenceStructure||t===s.AlertGroup.style&&e.style},t}();e.CheckingSettingsModelImpl=a},235:function(t,e,n){"use strict";function r(t){switch(t){case"red":return i.red;case"green":return i.green;case"yellow":return i.yellow;default:return i.grey}}Object.defineProperty(e,"__esModule",{value:!0});var i,o=n(6);!function(t){t[t.red=0]="red",t[t.green=1]="green",t[t.yellow=2]="yellow",t[t.grey=3]="grey"}(i=e.AlertExampleColor||(e.AlertExampleColor={}));!function(t){t[t.italic=0]="italic",t[t.plain=1]="plain"}(e.AlertExampleTextType||(e.AlertExampleTextType={})),e.getColor=r;e.parseExamples=function(t){return t?t.replace(/^<p>/,"").split("<p>").map(function(t){var e=t.match(/<span.*?<\/span><br\/>/g);return e&&e.length?e.map(function(t){var e=r(o.StringUtils.getFirstWord(o.StringUtils.getFirstMatch(t,/^<span.*?class="(.+?)".*?>/)||"")),n=o.StringUtils.getFirstMatch(t,/^<span.*?>(.+?): /)||"Comment",i=o.StringUtils.getFirstMatch(t,/^<span.*?>(?:.+?: )?(.+?)<\/span><br\/>/);return i?{color:e,type:n,text:i}:null}).filter(function(t){return!!t}):[]}).filter(function(t){return t.length}):[]}},236:function(t,e,n){"use strict";function r(t){var e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60);return{h:e,m:n,s:t-3600*e-60*n}}function i(t){return s.padStart(String(t),2,"0")}function o(t,e){var n=void 0===e?{}:e,o=n.short,a=void 0!==o&&o,c=n.withSec,u=void 0!==c&&c,l=r(t),h=l.h,d=l.m,p=l.s,f=[];return h>0&&f.push(i(h)+" "+(a?"h":s.pluralize(h,"hour","hours"))),(d>0||!u)&&f.push(i(d)+" "+(a?"min":s.pluralize(d,"minute","minutes"))),u&&f.push(i(p)+" "+(a?"sec":s.pluralize(p,"second","seconds"))),f.join(" ")}Object.defineProperty(e,"__esModule",{value:!0});var s=n(123);e.MS_IN_SEC=1e3,e.MS_IN_MIN=60*e.MS_IN_SEC,e.MS_IN_HOUR=60*e.MS_IN_MIN,e.MS_IN_DAY=24*e.MS_IN_HOUR,e.secondsToTime=r,e.formatTime=o},237:function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t){return t&&!Array.isArray(t)&&"object"==typeof t}function o(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function s(t){return Object.keys(t).map(function(e){return t[e]})}function a(t,e){return function(n){var r=t,i=n[r],o=u.__rest(n,["symbol"==typeof r?r:r+""]);return"function"==typeof e?u.__assign((s={},s[t]=e(l.Option.of(i)),s),o):u.__assign((a={},a[t]=e,a),o);var s,a}}function c(t,e){return function(n){var r=t,i=n[r],o=u.__rest(n,["symbol"==typeof r?r:r+""]);return("function"==typeof e?e(l.Option.of(i)):e).fold(function(){return o},function(e){return u.__assign((n={},n[t]=e,n),o);var n})}}Object.defineProperty(e,"__esModule",{value:!0});var u=n(3),l=n(35);e.objectWithoutProperties=r,e.isObject=i,e.isEmptyObject=o,e.toArray=s,e.immutableUpdate=a,e.immutableUpdateOption=c},238:function(t,e,n){"use strict";function r(t){if(!t)return"general";switch(t.split("_")[0]){case"academic":return"academic";case"business":return"business";case"technical":case"medical":return"technical";case"creative":return"creative";case"casual":return"casual";default:return"general"}}function i(t){switch(t){case"general":return"general";case"academic":return"academic_general";case"business":return"business_other";case"technical":return"technical_other";case"creative":return"creative_other";case"casual":return"casual_other";default:;return t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(144),s=n(202),a=n(314),c=n(4),u=n(35);!function(t){function e(t){return{goals:new Set,domain:t,audience:u.None,style:u.None,emotion:u.None}}function n(t,e){return e.map(function(e){return"formal"===e?"creative"!==t&&"casual"!==t:"academic"!==t}).getOrElse(!0)}function r(t,e){return{_A:o._A,name:t,validate:function(t,n){return e.indexOf(t)>-1?o.success(t):o.failure(t,n)}}}function i(t){return{_A:o._A,name:t.name+"Option",validate:function(e,n){return void 0===e?a.either.right(u.None):t.validate(e,n).map(u.Some)}}}function l(t){var e=o.validate(t,v).mapLeft(s.failure).mapLeft(function(t){return c.Monitoring.Logging.getLogger("coreclients.dox.context").warn("failed to parse document context",t),t});return a.either.isLeft(e)?u.Left(e.value):u.Right(e.value)}function h(t){if(void 0!==t)return l(t).fold(function(){},function(t){return t})}function d(t){var e=t.goals,n=t.domain,r=t.audience,i=t.style,o=t.emotion;return{goals:Array.from(e),domain:n.toLowerCase(),audience:r.getOrElse(void 0),style:i.getOrElse(void 0),emotion:o.getOrElse(void 0)}}t.goals=["inform","describe","convince","tell a story"],t.audiences=["general","knowledgeable","expert"],t.styles=["formal","informal"],t.emotions=["mild","strong"],t.domains=["general","academic","business","technical","creative","casual"],t.fromDomain=e,t.empty=e("general"),t.isStyleValidWithDomain=n;var p=r("goal",t.goals),f=r("audience",t.audiences),_=r("style",t.styles),g=r("emotion",t.emotions),m=r("domain",t.domains),y={_A:o._A,name:"goals",validate:function(t,e){return o.array(p).validate(t,e).map(function(t){return new Set(t)})}};t.option=i;var v=o.interface({goals:y,domain:m,audience:i(f),style:i(_),emotion:i(g)});t.tryParse=l,t.parse=h,t.serialize=d}(e.DocumentContext||(e.DocumentContext={})),e.genreToDomain=r,e.domainToGenre=i},239:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(15),i=n(747),o=n(706);e.Logo=function(t){return r.createElement("div",{"data-name":"gr-logo",className:i.logoWrapper},r.createElement("a",{href:t.mainPageUrl},r.createElement("img",{className:i.logo,src:o})))}},240:function(t,e,n){"use strict";function r(t){return{proofit:(t.data&&t.data.proofit?f.parseProofitResult(t.data.proofit):void 0)||void 0}}function i(t){return!!t&&![t.ContextualSpelling,t.Enhancement,t.Grammar,t.Plagiarism,t.Punctuation,t.SentenceStructure,t.Style].map(function(t){return t&&"object"==typeof t&&"boolean"==typeof t.active}).some(function(t){return!t})}function o(t){return t?{ContextualSpelling:{active:t.contextualSpelling},Enhancement:{active:t.enhancement},Grammar:{active:t.grammar},Plagiarism:{active:t.plagiarism},Punctuation:{active:t.punctuation},SentenceStructure:{active:t.sentenceStructure},Style:{active:t.style}}:null}function s(t){return t&&i(t)?{contextualSpelling:t.ContextualSpelling.active,grammar:t.Grammar.active,sentenceStructure:t.SentenceStructure.active,punctuation:t.Punctuation.active,style:t.Style.active,enhancement:t.Enhancement.active,plagiarism:t.Plagiarism.active}:null}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),c=n(314),u=n(68),l=n(166),h=n(127),d=n(167),p=n(448),f=n(241),_=n(53),g=n(238),m=n(4);e.CLOSED_ERROR=new l.WSError({status:"closed",message:"client was close from client side"}),e.DoxErrorCodes={GOING_AWAY:1001,TOO_BIG:1009,VIOLATED_POLICY:1008,UNEXPECTED_CONDITION:1011,SERVICE_RESTART:1012,BLOCKED_BY_CLIENT:4e3,UNAUTHORIZED:4001,NOT_FOUND:4004,TOO_MANY_REQUESTS:4029,UNKNOWN_WS_ERROR:-1},e.DoxAjaxErrorCodes={NOT_FOUND:404,UNAUTHORIZED:401,BAD_REQUEST:400,TOO_MANY_REQUESTS:429};var y=function(){function t(t){if(this._delta={},!t||!t.id)throw new Error("document is undefined or doesn't have ID");try{this._parsedRemoteMongodb=t.mongodb?JSON.parse(t.mongodb):void 0}catch(e){throw new Error("Corrupted 'mongodb' value in document ID "+t.id+": "+t.mongodb)}this._original=Object.assign({},t,{id:String(t.id),extraProps:this._parseSettings(t.mongodb)})}return Object.defineProperty(t.prototype,"id",{get:function(){return this._original.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this._delta.title||this._original.title||""},set:function(t){this._delta.title=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstContent",{get:function(){return this._original.first_content||""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return this._original.content||""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"revision",{get:function(){return this._original.vsn||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originalFileName",{get:function(){return this._original.orig_filename||""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"createdAt",{get:function(){return this._original.created_at?_.stringToDate(this._original.created_at):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatedAt",{get:function(){return this._original.updated_at?_.stringToDate(this._original.updated_at):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errors",{get:function(){return this._delta.errors||this._original.errors||0},set:function(t){this._delta.errors=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._original.size||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"settings",{get:function(){return Object.assign({},this._original.extraProps,this._delta.extraProps)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"genre",{get:function(){return this.settings.genre||null},enumerable:!0,configurable:!0}),t.prototype.setGenre=function(t){this._delta.extraProps=Object.assign({},this._delta.extraProps,{genre:t})},Object.defineProperty(t.prototype,"checks",{get:function(){return this.settings.checks||null},enumerable:!0,configurable:!0}),t.prototype.setChecks=function(t){this._delta.extraProps=Object.assign({},this._delta.extraProps,{checks:t})},Object.defineProperty(t.prototype,"context",{get:function(){return void 0===this.settings.context?c.option.none:c.option.some(this.settings.context)},enumerable:!0,configurable:!0}),t.prototype.setContext=function(t){this._delta.extraProps=Object.assign({},this._delta.extraProps,{context:t})},Object.defineProperty(t.prototype,"proofit",{get:function(){return this.settings.proofit||null},enumerable:!0,configurable:!0}),t.prototype.resetProofit=function(){this._delta.extraProps=Object.assign({},this._delta.extraProps,{proofit:null})},t.prototype._isDirty=function(){return Object.getOwnPropertyNames(this._delta||{}).length>0},t.prototype._popChanges=function(){var t=this._getRawDocument(this._delta);return t.id=Number(this._original.id),t},t.prototype._getRawDocument=function(t){if(t.extraProps){var e=Object.assign({},this.settings,t.extraProps),n=null===e.proofit;return Object.assign({},t,{mongodb:JSON.stringify(Object.assign({},this._parsedRemoteMongodb,{genre:e.genre,apps:o(e.checks)},void 0!==e.context&&{context:g.DocumentContext.serialize(e.context)},n?{proofit:null}:void 0))})}return Object.assign({},t)},t.prototype.syncWithRemoteMongodb=function(t){this._parsedRemoteMongodb=t},t.prototype._parseDeltaDocument=function(t){return Object.assign({},t,{extraProps:this._parseSettings(t.mongodb)})},t.prototype._mergeParsedDocuments=function(t,e){return Object.assign({},t,e,{extraProps:Object.assign({},t.extraProps,e.extraProps)})},t.prototype._applyChanges=function(t){this._original=this._mergeParsedDocuments(this._original,this._parseDeltaDocument(t)),this._delta={}},t.prototype._parseSettings=function(t){var e={};if(!t)return e;try{var n=JSON.parse(t);if(n){var r=f.parseProofitResult(n.proofit),i=n.genre,o=s(n.apps),a=g.DocumentContext.parse(n.context);return Object.assign({},void 0!==n.proofit&&{proofit:r},void 0!==n.genre&&{genre:i},void 0!==n.apps&&{checks:o},void 0!==a&&{context:a})}return e}catch(t){return e}},t}();e.Document=y;var v=function(){function t(e,n,r){this._url=e,this._fetch=n,this._token=r,this._ajax=u.Ajax.factory(this._fetch,"dox",t.doxErrorMapper),this._wsBaseUrl=this._getWsBaseUrl(e)}return t.prototype._getWsBaseUrl=function(t){var e=new RegExp("http(s?)://([^/]+)/?.*$"),n=e.exec(t);if(null===n)throw new Error("Cannot parse ws url");n[0];return"ws"+n[1]+"://"+n[2]},t.prototype._getWsUrl=function(t){var e=null===t||void 0===t?"/documents/ws":"/documents/"+t+"/ws";return""+this._wsBaseUrl+e},t.prototype.listDocuments=function(e,n,r){return void 0===e&&(e=t.unlimited),void 0===n&&(n=N.Any),void 0===r&&(r=!1),this.searchDocument(M.all(),e,n,r)},t.prototype.openDocumentsWS=function(t,e){return void 0===e&&(e=R._defaultReconnect),I.create(this._getWsUrl(),t,e)},t.prototype.getDocumentById=function(t){var e=u.RequestBuilder.get(this._url,"/documents").pathParam(t);return this._ajax(this._prepareRequest(e).build()).then(function(t){return new y(t)})},t.prototype.openDocumentById=function(t,e,n,r){return void 0===r&&(r=P._defaultReconnect),P.create(this._getWsUrl(t),e,n,r)},t.prototype.searchDocument=function(e,n,r,i){void 0===n&&(n=t.unlimited),void 0===r&&(r=N.Any),void 0===i&&(i=!1);var o=u.RequestBuilder.get(this._url,"/documents").queryParam("search",e.toSearchString()).queryParam("limit",String(n)).queryParam("firstCall",String(i));return this._ajax(this._prepareRequest(o).build()).then(function(t){return t.map(function(t){return new y(t)})})},t.prototype.createDocument=function(t){var e=t._getHttpRequestBuilder().url(this._url,"/documents").method("post");return this._ajax(this._prepareRequest(e).build()).then(function(t){return new y(t)})},t.prototype.ensuredDownloadLink=function(t,e){var n=this;return void 0===e&&(e=!0),this.getDocumentById(t).then(function(t){return n.downloadLink(t.id,e)})},t.prototype.downloadLink=function(t,e){return void 0===e&&(e=!0),u.RequestBuilder.join(this._url,"/documents",encodeURIComponent(t),"download")+(e?"":"?no_tracking")},t.prototype.deleteDocumentById=function(t){var e=u.RequestBuilder.del(this._url,"/documents").pathParam(t);return this._ajax(this._prepareRequest(e).build(),u.Ajax.toVoid)},t.prototype.restoreDocumentById=function(t){var e=u.RequestBuilder.post(this._url,"/documents",encodeURIComponent(t),"restore");return this._ajax(this._prepareRequest(e).build(),u.Ajax.toVoid)},t.prototype.saveDocument=function(t){if(!t._isDirty())return Promise.resolve();var e=t._popChanges(),n=u.RequestBuilder.put(this._url,"/documents").pathParam(String(t.id)).json(e);return this._ajax(this._prepareRequest(n).build(),u.Ajax.toVoid).then(function(){return t._applyChanges(e)})},t.doxErrorMapper=function(t){return a.__awaiter(this,void 0,void 0,function(){var e,n,r;return a.__generator(this,function(i){switch(i.label){case 0:e={},n="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.text()];case 2:return n=i.sent(),e=JSON.parse(n),[3,4];case 3:return r=i.sent(),e={info:"unknown"},[3,4];case 4:switch(e.info){case"too_big":throw new w(D.maxFileSize,e.status,e.info,t.url);case"document not found":throw new E(e.status,e.info,t.url);case"user not found":throw new S(e.status,e.info,t.url);case"tracked":throw new x(e.status,e.info,t.url);case"too many requests":throw new T(e.status,e.info,t.url);default:throw new u.HTTPError({code:t.status,status:t.statusText,url:t.url,body:n})}return[2]}})})},t.prototype._prepareRequest=function(t){return this._authorize(t).header("X-API-Version","1")},t.prototype._authorize=function(t){return this._token?t.cookie("grauth",this._token):t},t.unlimited=0,t}();e.Dox=v;var b=function(t){function e(e,n,r,i){void 0===n&&(n=0),void 0===r&&(r="connect_error"),void 0===i&&(i="Cannot connect");var o=t.call(this,{code:n,message:i,url:e,status:r})||this;return o.name="ConnectionError",o}return a.__extends(e,t),e}(u.HTTPError);e.ConnectionError=b;var w=function(t){function n(n,r,i,o){void 0===r&&(r="too_big"),void 0===i&&(i="Document is too big");var s=t.call(this,{code:e.DoxAjaxErrorCodes.BAD_REQUEST,message:i,url:o,status:r})||this;return s.maxSizeLimit=n,s.name="FileSizeOutOfRangeError",s}return a.__extends(n,t),n}(u.HTTPError);e.FileSizeOutOfRangeError=w;var E=function(t){function n(n,r,i){void 0===n&&(n="not_found"),void 0===r&&(r="Document doesn't exist");var o=t.call(this,{code:e.DoxAjaxErrorCodes.NOT_FOUND,message:r,url:i,status:n})||this;return o.name="DocumentNotFoundError",o}return a.__extends(n,t),n}(u.HTTPError);e.DocumentNotFoundError=E;var S=function(t){function n(n,r,i){void 0===n&&(n="error"),void 0===r&&(r="user not found");var o=t.call(this,{code:e.DoxAjaxErrorCodes.UNAUTHORIZED,message:r,url:i,status:n})||this;return o.name="UnauthorizedError",o}return a.__extends(n,t),n}(u.HTTPError);e.UnauthorizedError=S;var C=function(t){function n(n,r,i,o){void 0===r&&(r="bad_type"),void 0===i&&(i="Unsupported file type");var s=t.call(this,{code:e.DoxAjaxErrorCodes.BAD_REQUEST,message:i,url:o,status:r})||this;return s.originalFileName=n,s.name="UnsupportedFileTypeError",s}return a.__extends(n,t),n}(u.HTTPError);e.UnsupportedFileTypeError=C;var x=function(t){function n(n,r,i){void 0===n&&(n="error"),void 0===r&&(r="Document with tracked changes is not supported");var o=t.call(this,{code:e.DoxAjaxErrorCodes.BAD_REQUEST,message:r,url:i,status:n})||this;return o.name="TrackedChangesIsUnsupported",o}return a.__extends(n,t),n}(u.HTTPError);e.TrackedChangesIsUnsupported=x;var T=function(t){function n(n,r,i){void 0===n&&(n="error"),void 0===r&&(r="Too many requests");var o=t.call(this,{code:e.DoxAjaxErrorCodes.TOO_MANY_REQUESTS,message:r,url:i,status:n})||this;return o.name="TooManyRequestsError",o}return a.__extends(n,t),n}(u.HTTPError);e.TooManyRequestsError=T;var A=function(t){function e(e,n,r,i){void 0===n&&(n="disconnected"),void 0===r&&(r="Cannot connect to DOX");var o=t.call(this,{status:n,message:r,code:e,url:i})||this;return o.name="WSDisconnectedOnInitError",o}return a.__extends(e,t),e}(l.WSError);e.WSDisconnectedOnInitError=A;var k=function(t){function n(n,r,i){void 0===n&&(n="too_big"),void 0===r&&(r="Message is too big, server rejected it");var o=t.call(this,{status:n,message:r,code:e.DoxErrorCodes.TOO_BIG,url:i})||this;return o.name="WSMessageIsTooBigError",o}return a.__extends(n,t),n}(l.WSError);e.WSMessageIsTooBigError=k;var O=function(t){function e(e,n,r,i,o){void 0===i&&(i="Disconnected after multiple retries");var s=t.call(this,{status:r,message:i,code:n,url:o})||this;return s.retriesMade=e,s}return a.__extends(e,t),e}(l.WSError);e.WSDisconnectedAfterMultipleRetries=O,e.processMongodbChange=r;var R=function(){function t(t){var e=this;this._url=t,this._log=m.Monitoring.Logging.getLogger("coreclients.remote",m.Logging.LogLevel.DEBUG),this._ws=l.WS.create().onDisconnect(function(t){return e._handleDisconnect(t)}).onMessage(function(t,n){return e._handleMessage(n)}).onError(l.errPrintln),this._fsm=new h.StateMachine(L.DISCONNECTED,L.CLOSED).from(L.DISCONNECTED).to(L.CONNECTING).on(U.CONNECT).from(L.DISCONNECTED).to(L.RECONNECT_SCHEDULED).on(U.SCHEDULE_RECONNECT).from(L.CONNECTING,L.RECONNECT_SCHEDULED).to(L.CONNECTED).on(U.CONNECTED).from(L.CONNECTED).to(L.READY).on(U.INITIALIZE).from(L.CONNECTED,L.CONNECTING,L.RECONNECT_SCHEDULED,L.READY).to(L.DISCONNECTED).on(U.DISCONNECT).from(L.CONNECTED,L.CONNECTING,L.RECONNECT_SCHEDULED,L.READY,L.DISCONNECTED).to(L.CLOSED).on(U.CLOSE).on(L.CLOSED,function(t){e._conn&&e._conn.close(),t.args&&t.args instanceof l.WSError&&(e._error=t.args,e._log.error("Remote connection to dox ws closed",e._error))}).on(L.CONNECTING,function(t){return e._connect()})}return t.prototype._handleDisconnect=function(t){return a.__awaiter(this,void 0,void 0,function(){var e,n=this;return a.__generator(this,function(r){switch(r.label){case 0:return[4,this._fsm.event(U.DISCONNECT,t.reason)];case 1:if(!r.sent())return[3,5];this._log.info("Disconnected",t.reason),r.label=2;case 2:return r.trys.push([2,3,,5]),this._disconnectHandler(t,t.reconnect.nextDelay,function(e){return a.__awaiter(n,void 0,void 0,function(){var n,r,i=this;return a.__generator(this,function(o){switch(o.label){case 0:return[4,this._fsm.event(U.SCHEDULE_RECONNECT)];case 1:return o.sent()?[4,t.reconnect.scheduleReconnect(e)]:[3,4];case 2:return n=o.sent(),[4,this._fsm.event(U.CONNECTED,n).catch(function(t){i._log.warn("Reconnect failed due to error",t),n.close()})];case 3:r=o.sent(),r?(this._log.info("Reconnected to DOX WS successful",{url:this._url,canFinalize:r}),this._conn=n):(this._log.info("Immediate disconnect after reconnect to DOX WS",{url:this._url,state:L[this._fsm.current]}),n.close()),o.label=4;case 4:return[2]}})})}),[3,5];case 3:return e=r.sent(),[4,this._fsm.event(U.CLOSE,e)];case 4:return r.sent(),[3,5];case 5:return[2]}})})},t.prototype.close=function(){var t=this;return this._fsm.event(U.CLOSE).then(function(e){e&&clearTimeout(t._timeout)})},t.prototype._connect=function(){return a.__awaiter(this,void 0,void 0,function(){var t,e;return a.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this._ws.connect(this._url)];case 1:return t=n.sent(),[4,this._fsm.event(U.CONNECTED,t)];case 2:return n.sent()?[2,this._conn=t]:(t.close(),[2,void 0]);case 3:throw e=n.sent(),new b(this._url);case 4:return[2]}})})},t._defaultReconnect=function(t,n,r){var i=t.code,o=t.reason,s=t.reconnect;if(i!==e.DoxErrorCodes.GOING_AWAY){if(i===e.DoxErrorCodes.NOT_FOUND||i===e.DoxErrorCodes.UNAUTHORIZED)throw new A(i,o);if(i===e.DoxErrorCodes.TOO_BIG)throw new k;var a=s.reconnectCounter;if(a>=5)throw new O(a,i,o);r(n).catch(function(t){m.Monitoring.Logging.getLogger("coreclients.remote").warn("Reconnect failed with an error",t)})}},t}();e.Remote=R;var I=function(t){function n(n,r,i,o,s){var a=t.call(this,n)||this;return a.url=n,a._initHandler=r,a._failHandler=i,a._mongodbchangeHandler=o,a._disconnectHandler=s,a._fsm.on(L.CLOSED,function(t){var n=t.args?t.args:e.CLOSED_ERROR;a._failHandler&&a._failHandler(n)}),a._fsm.event(U.CONNECT).then(function(){return r(a)}).catch(i),a}return a.__extends(n,t),n.create=function(t,e,r){return new Promise(function(i,o){return new n(t,i,o,e,r)})},n.prototype._handleMessage=function(t){return a.__awaiter(this,void 0,void 0,function(){var e;return a.__generator(this,function(n){switch(this._log.trace("<<< ",{message:t}),t.op){case"mongodb_change":this._handleMongodbChangeMessage(t);break;default:e=t.op,this._log.warn("Never",{message:e})}return[2]})})},n.prototype._handleMongodbChangeMessage=function(t){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(e){return this._mongodbchangeHandler&&this._mongodbchangeHandler(String(t.id),r(t)),[2]})})},n}(R);e.RemoteDocumentsList=I;var P=function(t){function n(n,r,i,o,s,a,c){void 0===c&&(c=500);var u=t.call(this,n)||this;return u.url=n,u._changeHandler=o,u._mongodbchangeHandler=s,u._sendDelay=c,u._nextId=0,u._revision=0,u._clientId=-1,u._text="",u._linkedDocument=void 0,u._initHandler=r,u._failHandler=i,u._disconnectHandler=a,u._fsm.from(L.READY).to(L.WAIT_ACK).on(U.SEND).from(L.WAIT_ACK).to(L.READY).on(U.ACK,U.RESET).from(L.WAIT_ACK).to(L.DISCONNECTED).on(U.DISCONNECT).from(L.WAIT_ACK).to(L.CLOSED).on(U.CLOSE).on(L.READY,function(t){return u._trySendAfterTimeout()}).on(L.CLOSED,function(t){var n=t.args?t.args:e.CLOSED_ERROR;u._failHandler&&u._failHandler(n),u._queue&&u._queue.clear(n,0)}).on(L.DISCONNECTED,function(t){return u._clear()}),u._fsm.event(U.CONNECT).catch(function(t){u._failHandler&&(u._failHandler(t),u._failHandler=null)}),u}return a.__extends(n,t),n.create=function(t,e,r,i,o){return void 0===o&&(o=500),new Promise(function(s,a){return new n(t,s,a,e,r,i,o)})},n.prototype.pushChanges=function(t){var n=this;return new Promise(function(r,i){if(n._fsm.is(L.CLOSED))return void i(n._error?n._error:e.CLOSED_ERROR);0===t.length?r():n._queue.pushAll(t,function(){return r()},i)})},n.prototype.setText=function(t){var n=this;return new Promise(function(r,i){if(n._fsm.is(L.CLOSED))return void i(n._error?n._error:e.CLOSED_ERROR);var o=p.Diff.diffAsOperations(n._text,t);0===o.length?r(t):(n._queue.pushAll(o,function(){return r(t)},i),n._text=t)})},n.prototype.getText=function(){return this._text},n.prototype._clear=function(){this._nextId=0,this._clientId=0,this._revision=0},n.prototype._trySendAfterTimeout=function(){var t=this;this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){t._queue.isEmpty||t._queue.isStaging?t._trySendAfterTimeout():t._send()},this._sendDelay)},n.prototype._replaceText=function(t){this._text=t,this._changeHandler&&this._changeHandler(this,this._text)},n.prototype._handleMessage=function(t){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(n){switch(this._log.trace("<<<",{message:t}),t.op){case"init":this._handleInitMessage(t);break;case"patch":this._handlePatchMessage(t);break;case"reset":this._handleResetMessage(t);break;case"vsn":break;case"mongodb_change":this._handleMongodbChangeMessage(t);break;default:t.code===e.DoxErrorCodes.GOING_AWAY||t.code===e.DoxErrorCodes.NOT_FOUND?this._log.info("Unexpected message",{message:t}):this._log.warn("Unexpected message",{message:t})}return[2]})})},n.prototype._handleResetMessage=function(t){return a.__awaiter(this,void 0,void 0,function(){var e;return a.__generator(this,function(n){switch(n.label){case 0:return e=this._fsm.current===L.READY,e?[3,2]:[4,this._fsm.event(U.RESET)];case 1:e=n.sent(),n.label=2;case 2:return e&&(this._queue.clear("reset",t.vsn),this._revision=t.vsn,this._clientId=t.clientId,this._replaceText(t.text)),[2]}})})},n.prototype._handlePatchMessage=function(t){return a.__awaiter(this,void 0,void 0,function(){var e;return a.__generator(this,function(n){switch(n.label){case 0:return this._revision=t.v,t.cl!==this._clientId?[3,2]:[4,this._fsm.event(U.ACK)];case 1:return n.sent()&&this._queue.acknowledge(t.v),[3,3];case 2:e=d.Changesets.unpack(t.ch),e=this._queue.transformAgainst(e,this._revision),this._replaceText(e.apply(this._text)),n.label=3;case 3:return this._conn.send(new F(t.v)),[2]}})})},n.prototype._handleInitMessage=function(t){return a.__awaiter(this,void 0,void 0,function(){var e,n,r,i;return a.__generator(this,function(o){switch(o.label){case 0:return[4,this._fsm.event(U.INITIALIZE)];case 1:return(e=o.sent())?(n=this._queue,r=t.text,this._clientId=t.clientId,this._revision=t.vsn,this._nextId=1,this._queue=new d.ChangesetsQueue(this._revision),n?(r=n.reload(this._queue,r),this._queue.isStaging?[4,this._fsm.event(U.SEND)]:[3,3]):[3,3]):[3,4];case 2:o.sent()&&(i=this._queue.poll())&&this._conn.send(new j(this._nextId++,this._clientId,this._revision,i.pack())),o.label=3;case 3:this._initHandler?(this._text=r,this._initHandler(this),this._initHandler=null,this._failHandler=null):this._replaceText(r),o.label=4;case 4:return[2]}})})},n.prototype._handleMongodbChangeMessage=function(t){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(e){return this._mongodbchangeHandler&&this._mongodbchangeHandler(String(t.id),r(t)),this._linkedDocument&&t.data&&this._linkedDocument.syncWithRemoteMongodb(t.data),[2]})})},n.prototype._send=function(){var t=this;this._fsm.event(U.SEND).then(function(e){if(e){var n=t._queue.poll();if(null===n)return;var r=n.pack(),i=new j(t._nextId++,t._clientId,n.revision,r);t._log.trace(">>>",{message:i}),t._conn.send(i)}else t._fsm.event(U.CONNECT)}).catch(l.errPrintln)},n.prototype.linkToDocument=function(t){this._linkedDocument=t},n}(R);e.RemoteDocument=P;var D=function(){function t(t){this._httpRequest=t}return t.text=function(e,n){var r=u.RequestBuilder.create().json();return(e||n)&&r.body({content:e,title:n}),new t(r)},t.file=function(e){var n=u.RequestBuilder.create();if(!e)throw new TypeError("File was not provided");if(!e.name)throw new TypeError("Empty filename passed to file() function");if(!e.size)throw new TypeError("File size wasn't provided");if(e.size>t.maxFileSize)throw new w(t.maxFileSize);var r=(e.name.split("\\").pop()||"").split("/").pop();if(!r)throw new C(e.name);if(!r.match(t.supportedExtensionsRE))throw new C(r);var i=new FormData;return i.append("source_file",e),n.body(i),new t(n)},t.prototype._getHttpRequestBuilder=function(){return this._httpRequest.isBodyPresent()?this._httpRequest:this._httpRequest.body({})},t.supportedExtensions=["doc","docx","odt","rtf","txt","htm","html"],t.supportedExtensionsRE=new RegExp("\\.("+t.supportedExtensions.join("|")+")$","i"),t.maxFileSize=4194304,t}();e.CreateRequest=D;var M=function(){function t(t){this._str=t}return t.contains=function(e){return new t(e)},t.all=function(){return new t("")},t.prototype.toSearchString=function(){return this._str},t}();e.SearchRequest=M;var N;!function(t){t[t.Updated=0]="Updated",t[t.Created=1]="Created",t[t.Any=2]="Any"}(N=e.OrderBy||(e.OrderBy={})),e.fromCheckingSettings=o,e.toCheckingSettings=s;var L;!function(t){t[t.DISCONNECTED=0]="DISCONNECTED",t[t.CONNECTING=1]="CONNECTING",t[t.RECONNECT_SCHEDULED=2]="RECONNECT_SCHEDULED",t[t.CONNECTED=3]="CONNECTED",t[t.READY=4]="READY",t[t.WAIT_ACK=5]="WAIT_ACK",t[t.CLOSED=6]="CLOSED"}(L=e.States||(e.States={}));var U;!function(t){t[t.CONNECT=0]="CONNECT",t[t.CONNECTED=1]="CONNECTED",t[t.SCHEDULE_RECONNECT=2]="SCHEDULE_RECONNECT",t[t.DISCONNECT=3]="DISCONNECT",t[t.CLOSE=4]="CLOSE",t[t.INITIALIZE=5]="INITIALIZE",t[t.SEND=6]="SEND",t[t.ACK=7]="ACK",t[t.RESET=8]="RESET"}(U=e.Events||(e.Events={}));var j=function(){function t(t,e,n,r){this.id=t,this.cl=e,this.v=n,this.ch=r,this.op="patch"}return t}();e.PatchMessage=j;var F=function(){function t(t){this.vsn=t,this.op="vsn"}return t}();e.VersionMessage=F;var B=function(){function t(t,e,n,r){this.title=t,this.errors=e,this.extra_params=n,this.proofit=r,this.op="update_document_metadata"}return t}();e.UpdateDocumentMetadata=B},241:function(t,e,n){"use strict";function r(t){switch(t){case"New":return a.newJob;case"Building":return a.building;case"paymentError":return a.paymentError;case"duplicate":return a.duplicate;case"emptyDocument":return a.emptyDocument;case"Completed":return a.completed;case"Cancelled":return a.cancelled;default:return a.unknown}}function i(t){switch(t){case"Instant":return l.Instant;case"ThreeHours":return l.ThreeHours;case"TwentyFourHours":return l.TwentyFourHours;default:throw new Error("Unknown turnaround type "+t)}}function o(t){if(!t)return null;try{t.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/)&&(t=t.replace(/\s/,"T"));return new Date(t).getTime()}catch(t){return null}}function s(t){return t?{downloadResultUrl:t.downloadResultUrl||null,submitted:o(t.submitted),corrections:t.corrections||null,due:o(t.due),price:t.price||null,name:t.name||null,completed:o(t.completed),id:t.id||null,status:r(t.status),is_dox_applied:t.is_dox_applied||null}:null}Object.defineProperty(e,"__esModule",{value:!0});var a,c=n(68),u=n(42);!function(t){t[t.paymentError=0]="paymentError",t[t.duplicate=1]="duplicate",t[t.emptyDocument=2]="emptyDocument",t[t.newJob=3]="newJob",t[t.building=4]="building",t[t.completed=5]="completed",t[t.cancelled=6]="cancelled",t[t.unknown=7]="unknown"}(a=e.ProofitJobStatus||(e.ProofitJobStatus={}));var l;!function(t){t[t.Instant=0]="Instant",t[t.ThreeHours=1]="ThreeHours",t[t.TwentyFourHours=2]="TwentyFourHours"}(l=e.TurnaroundType||(e.TurnaroundType={})),e.parseStatus=r,e.parseTurnaroundType=i,e.parseProofitResult=s;var h=function(){function t(t,e,n){this._doxUrl=t,this._fetch=e,this._token=n,this._ajax=c.Ajax.factory(this._fetch,"proofit",u.Dox.doxErrorMapper)}return t.prototype._processJobResponse=function(t){var e=t.jobId,n=t.status,i=t.token;return{jobId:e,status:r(n),token:i}},t.prototype._processOptions=function(t){var e=t.words,n=t.turnaroundOptions;return n&&n.length||(n=[]),{words:e,turnaroundOptions:n.map(function(t){return{enabled:t.enabled,label:t.label,minutesToProcess:t.minutesToProcess,perWord:t.perWord,price:t.price,turnaround:i(t.turnaround)}})}},t.prototype.getOptions=function(t){var e=c.RequestBuilder.get(this._doxUrl,"documents/"+t+"/proofit/turnaroundOptions");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build()).then(this._processOptions)},t.prototype.createJob=function(t){var e=t.docId,n=t.turnaround,r=l[n],i=c.RequestBuilder.post(this._doxUrl,"documents/"+e+"/proofit/job").queryParam("turnaround",r);return this._token&&i.cookie("grauth",this._token),this._ajax(i.build()).then(this._processJobResponse)},t}();e.Proofit=h},242:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=n(245),o=n(4),s=n(10);!function(t){t[t.Querying=0]="Querying",t[t.Ready=1]="Ready"}(r=e.SynonymsStateKind||(e.SynonymsStateKind={}));var a;!function(t){function e(t){return null!==t&&t.kind===r.Ready}function n(t){return null!==t&&t.kind===r.Querying}t.isReady=e,t.isQuerying=n}(a=e.SynonymsModel||(e.SynonymsModel={}));var c=function(){function t(t){this._query=t,this.state=s.Atom.create({kind:r.Ready}),this._log=o.Monitoring.Logging.getLogger("editor.SynonymsModelImpl"),this._cache=new i.LRUCache(20)}return t.prototype.query=function(t){var e=this;this._log.trace("SynonymsQuery: "+t.word),this.state.set({kind:r.Querying,query:t});var n=this._getKey(t),i=this._cache.get(n);if(void 0!==i){this._log.trace("Cache hit for "+n);var o={kind:r.Ready,query:t,synonyms:i};this._onResponse(o)}else this._query(t.start,t.word).then(function(i){var o={kind:r.Ready,query:t,synonyms:i};e._cache.put(n,i),e._onResponse(o)}).catch(function(t){e.abortQuery()})},t.prototype.abortQuery=function(){a.isQuerying(this.state.get())&&this.state.set({kind:r.Ready})},t.prototype._getKey=function(t){return t.word+"#"+t.start},t.prototype._onResponse=function(t){this._log.trace("_onResponse() newState: "+t);var e=this.state.get();a.isQuerying(e)&&e.query.word===t.query.word?this.state.set(t):this._log.trace("Discarding result for "+t.query.word)},t}();e.SynonymsModelImpl=c},243:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(23),i=n(10),o=n(4),s=function(){function t(){}return t.prototype.error=function(t){return{type:"error",args:{errorMessage:t},dontRemoveOnAnyAction:!0}},t.prototype.documentUploaded=function(t){return{type:"documentUploaded",args:{navigateToDocument:t},showTimeMs:1/0}},t.prototype.newDocumentCreated=function(t){return{type:"newDocumentCreated",args:{navigateToDocument:t},showTimeMs:1/0}},t.prototype.documentDeleted=function(t,e,n,r){return void 0===r&&(r=!1),{type:"documentDeleted",args:{documentTitle:e,documentId:t,failedToRestore:r,restoreDocument:n}}},t.prototype.documentTypeUnsupported=function(){return{type:"documentTypeUnsupported"}},t.prototype.trackedChangesIsUnsupported=function(){return{type:"trackedChangesIsUnsupported",showTimeMs:3e4}},t.prototype.documentUploadGeneralError=function(){return{type:"documentUploadGeneralError"}},t.prototype.documentIsEmpty=function(){return{type:"documentIsEmpty"}},t.prototype.generic=function(t,e){return{type:"generic",args:{message:t,description:e}}},t.prototype.documentSizeExceeded=function(){return{type:"documentSizeExceeded"}},t.prototype.changeEmail=function(t){return{type:"changeEmail",args:{email:t}}},t.prototype.logoutError=function(t,e){return{type:"logoutError",args:{forceRetry:t,timeToRetry:e},showTimeMs:1/0,dontCloseOnClick:!0,important:!0}},t.prototype.unauthorizedError=function(){return{type:"unauthorizedError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0}},t.prototype.offline=function(t,e){return{type:"offline",args:{resetClock:t,reconnectTime:e},showTimeMs:1/0,dontCloseOnClick:!0,important:!0}},t.prototype.slowNetwork=function(){return{type:"slowNetwork",showTimeMs:1/0,dontCloseOnClick:!0}},t.prototype.serverError=function(){return{type:"serverError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0}},t.prototype.tooManyRequestsError=function(){return{type:"tooManyRequestsError",dontCloseOnClick:!1}},t.prototype.unknownConnectionError=function(){return{type:"unknownConnectionError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0}},t.prototype.connectionWSError=function(){return{type:"connectionWSError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0}},t.prototype.clientConnectionError=function(){return{type:"clientConnectionError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0}},t.prototype.checkingIsDown=function(){return{type:"checkingIsDown",showTimeMs:1/0,dontCloseOnClick:!0}},t.prototype.extensionInstallFailed=function(){return{type:"extensionInstallFailed"}},t.prototype.copyToClipboardFailed=function(){return{type:"copyToClipboardFailed"}},t.prototype.alertUndo=function(t,e){return{type:"alertUndo",args:{undoAction:t,action:e},showTimeMs:1/0,size:"flexible"}},t}();e.EditorNotificationFactory=s,e.defaultState={items:[],counterId:0};var a=function(){function t(t){this._state=t,this._items=this._state.lens(function(t){return t.items}),this.items=this._items.view(),this.create=new s}return t.prototype.show=function(t){return o.Monitoring.Logging.getLogger("notifications").log("error"===t.type?o.Logging.LogLevel.WARN:o.Logging.LogLevel.INFO,"Notification shown: "+t.type,o.EventProps.fromAny(t)),this._addNotifications(this._state,t).id},t.prototype.showMessage=function(t){return this.show(this.create.generic(t))},t.prototype.showError=function(t){return this.show(this.create.error(t))},t.prototype.hide=function(t){this._hideNotification(this._state,t)},t.prototype.expire=function(t){this._hideNotification(this._state,t)},t.prototype.cleanup=function(){this._items.modify(this._cleanup)},t.prototype._addNotifications=function(t,e){var n=this,r=(t.get().counterId||0)+1,i=Object.assign({},e,{id:r});return t.modify(function(t){var e=n._cleanup(t&&t.items||[]),o=e.filter(function(t){return t.important}),s=e.filter(function(t){return!t.important});return{counterId:r,items:o.concat([i],s)}}),i},t.prototype._cleanup=function(t){return t.filter(function(t){return t&&!t.expired&&(t.dontRemoveOnAnyAction||t.important)})},t.prototype._hideNotification=function(t,e){t.lens(function(t){return t.items}).lens(i.Lens.find(function(t){return e===t.id})).lens(i.Lens.create(function(t){return t&&t.expired},function(t,e){return e?Object.assign({},e,{expired:t}):e})).set(!0)},t}();e.NotificationsModelImpl=a,e.notificationsContextTypes={notifications:r.object}},244:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(15),o=n(122),s=n(239),a=n(749),c=n(707),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.render=function(){return i.createElement(o.BasePage,{title:"Grammarly"},i.createElement("div",null,i.createElement(s.Logo,{mainPageUrl:this.context.appConfig.funnel.mainPage}),i.createElement("div",{className:a.robot},i.createElement("img",{src:c,width:155,height:215})),i.createElement("div",{className:a.header},i.createElement("div",{className:a.headOne},"Our grammar robot is recharging."),i.createElement("div",{className:a.headSub},i.createElement("p",{className:a.sub},"Grammarly is currently unavailable while we make upgrades",i.createElement("br",null),"to improve the service for you. Please try again in a minute."))),i.createElement("div",{className:a.smallText},"We apologize for the inconvenience and appreciate your patience.",i.createElement("br",null),"For more information, please"," ",i.createElement("a",{className:a.contact,href:this.context.appConfig.support.newRequest},"contact support"),".")))},e}(o.BaseComponent);e.Error500Page=u},245:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this.capacity=t,this.size=0,this._keymap={}}return t.prototype.put=function(t,e){var n={key:t,value:e};if(this._keymap[t]=n,this._tail?(this._tail.newer=n,n.older=this._tail):this._head=n,this._tail=n,this.size===this.capacity)return this.shift().value;++this.size},t.prototype.get=function(t){var e=this._getImpl(t);return e&&e.value},t.prototype.peek=function(t){var e=this._keymap[t];return e&&e.value},t.prototype.set=function(t,e){var n=this._getImpl(t),r=e(n&&n.value);return r?n?n.value=r:this.put(t,r):n&&this.remove(t),r},t.prototype.getRef=function(t){return this._getImpl(t)},t.prototype.remove=function(t){var e=this._keymap[t];if(e)return delete this._keymap[t],e.newer&&e.older?(e.older.newer=e.newer,e.newer.older=e.older):e.newer?(e.newer.older=void 0,this._head=e.newer):e.older?(e.older.newer=void 0,this._tail=e.older):this._head=this._tail=void 0,--this.size,e.value},t.prototype.forEach=function(t){for(var e in this._keymap)t(e,this._keymap[e].value)},t.prototype.shift=function(){var t=this._head;return this._head&&(this._head.newer?(this._head=this._head.newer,this._head.older=void 0):this._head=void 0,t.newer=t.older=void 0,delete this._keymap[t.key]),t},t.prototype._getImpl=function(t){var e=this._keymap[t];if(e)return e===this._tail?e:(e.newer&&(e===this._head&&(this._head=e.newer),e.newer.older=e.older),e.older&&(e.older.newer=e.newer),e.newer=void 0,e.older=this._tail,this._tail&&(this._tail.newer=e),this._tail=e,e)},t}();e.LRUCache=r},261:function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)n[r]=t[r][e];return n}function i(t){return r(a,t)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(23),s=n(43),a={tooltipDownloadProofreadVersion:{webeditor:"Download proofread version",desktopeditor:"Export proofread version"},tooltipDownloadOriginalVersion:{webeditor:"Download original version",desktopeditor:"Export original version"},tooltipDownload:{webeditor:"Download",desktopeditor:"Export document"},uploadText:{webeditor:"Upload",desktopeditor:"Import"},tooltipUploadElementInput:{webeditor:"Click here to upload document",desktopeditor:"Click here to import document"},menuDownloadText:{webeditor:"Download",desktopeditor:"Export"},documentPlaceholderText:{webeditor:"Upload a document to save original formatting.",desktopeditor:"Import a document to save original formatting."},modalUploadingDocumentText:{webeditor:"Uploading document",desktopeditor:"Importing document"},notificationUploadFileText:{webeditor:"Upload a file in one of the following formats",desktopeditor:"Import a file in one of the following formats"},copyToClipboardIsNotAvailable:{webeditor:"Click and copy with "+s.hotkeyLabel("C",s.getBrowserInfo().os),desktopeditor:"Click and copy with "+s.hotkeyLabel("C",s.getBrowserInfo().os)},notEnoughTextToAnalize:{webeditor:"Write away!\nWe need at least 4 sentences\nfor Grammarly to work its true magic.",desktopeditor:"Write away!\nWe need at least 4 sentences\nfor Grammarly to work its true magic."}};e.getTextResources=i,e.textResourcesContextTypes={textResources:o.object}},262:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),i=function(){};e.defaultReconnect=function(t,e,n){var i=r.Monitoring.Logging.getLogger("coreclients.capi");return i.info("Disconnected from CAPI.",t.reason),n(e).catch(function(t){i.warn("Reconnect failed with an error: ",t)})};var o=function(){function t(){this.onSesionStarted=i,this.beforeAlert=i,this.onAlert=i,this.onRemove=i,this.onSynonyms=i,this.onPlagiarism=i,this.onPlagiarismFinish=i,this.onError=i,this.onFinish=i,this.onStats=i,this.onPong=i,this.onDebugInfo=i,this.onDisconnect=e.defaultReconnect}return t}();e.DefaultCAPIEventHandler=o},263:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){function e(t,e){return Object.assign({},t,{begin:t.begin+e,end:t.end+e,highlightBegin:t.highlightBegin+e,highlightEnd:t.highlightEnd+e})}function n(t){return"Plagiarism"===t.category}function r(t,n){for(var r=0,i=n;r<i.length;r++)for(var o=i[r],s=0,a=o.operations;s<a.length;s++){var c=a[s];if(c.end>t.begin&&t.end>c.begin||c.end>t.highlightBegin&&t.highlightEnd>c.begin)return null;"+"===c.type?(t.begin<0||t.highlightBegin<0||t.begin>=c.begin||t.highlightBegin>=c.begin)&&(t=e(t,c.length)):"-"===c.type&&(t.begin>=c.begin||t.highlightBegin>=c.begin)&&(t=e(t,-c.length))}return t}function i(t){if(!t)return!1;var e=t;return Number.isInteger(e.rev)&&Number.isInteger(e.begin)&&Number.isInteger(e.end)&&Number.isInteger(e.highlightBegin)&&Number.isInteger(e.highlightEnd)}t.shift=e,t.isPlagiarism=n,t.transformMarkupAgainst=r,t.isRawAlert=i,t.mock={id:"",rev:0,pname:"Spelling/BritishVsAmerican/BrInstOfAm/BrInstOfAm",group:"ContextualSpelling",category:"BritishVsAmerican",hidden:!1,text:"centralise",todo:"correct",title:"Inconsistent spelling",transforms:["<span class='gr_grammar_del'>centralise</span>→<span class='gr_grammar_ins'>centralize</span>"],details:"<p>One of&nbsp;the most obvious differences between American and British English is&nbsp;the spelling of&nbsp;certain words such as&nbsp;<b>color/colour, learned/learnt,</b> and <b>toward/towards</b>. Typically, the spelling of&nbsp;words like these only varies by&nbsp;one or&nbsp;two letters. In&nbsp;the interest of&nbsp;consistency and clarity, you should use the spelling that will be&nbsp;more familiar to&nbsp;your intended audience.\n",explanation:"<p>The word <b>centralise</b> is&nbsp;a&nbsp;British English spelling. In&nbsp;the interest of&nbsp;consistency, consider replacing it&nbsp;with the American English spelling.\n",examples:'<p><span class="grey">British: I&nbsp;wish you success in&nbsp;all your endeavours.</span><br/><span class="grey">American: I&nbsp;wish you success in&nbsp;all your endeavors.</span><br/><p><span class="grey">British: Sweet yoghurts contain a&nbsp;lot of&nbsp;sugar.</span><br/><span class="grey">American: Sweet yogurts contain a&nbsp;lot of&nbsp;sugar.</span><br/><p><span class="grey">British: Serena moved towards the blinking light.</span><br/><span class="grey">American: Serena moved toward the blinking light.</span><br/>',free:!0,highlightBegin:5092,highlightEnd:5102,highlightText:"",begin:5092,end:5102,replacements:["centralize"],extra_properties:{priority:"2"},cardLayout:{category:"Accuracy",group:"Spelling",groupDescription:"Checks spelling, confused words, capitalization",rank:10}}}(e.RawAlert||(e.RawAlert={}));!function(t){t[t.NOT_AUTHORIZED=0]="NOT_AUTHORIZED",t[t.SESSION_NOT_INITIALIZED=1]="SESSION_NOT_INITIALIZED",t[t.BAD_REQUEST=2]="BAD_REQUEST",t[t.BACKEND_ERROR=3]="BACKEND_ERROR",t[t.AUTH_ERROR=4]="AUTH_ERROR",t[t.RUNTIME_ERROR=5]="RUNTIME_ERROR",t[t.ILLEGAL_DICT_WORD=6]="ILLEGAL_DICT_WORD",t[t.TIMEOUT=7]="TIMEOUT",t[t.CANNOT_FIND_SYNONYM=8]="CANNOT_FIND_SYNONYM",t[t.CANNOT_GET_TEXT_STATS=9]="CANNOT_GET_TEXT_STATS"}(e.ErrorCode||(e.ErrorCode={}));!function(t){t[t.INFO=0]="INFO",t[t.WARN=1]="WARN",t[t.ERROR=2]="ERROR"}(e.ErrorSeverity||(e.ErrorSeverity={}));!function(t){t[t.AUTOCORRECT_ACCEPT=0]="AUTOCORRECT_ACCEPT",t[t.AUTOCORRECT_IGNORE=1]="AUTOCORRECT_IGNORE",t[t.IGNORE=2]="IGNORE",t[t.IGNORE_ALL=3]="IGNORE_ALL",t[t.ADD_TO_DICTIONARY=4]="ADD_TO_DICTIONARY",t[t.REPORT_SUGGESTION=5]="REPORT_SUGGESTION",t[t.REMOVE_FROM_DICTIONARY=6]="REMOVE_FROM_DICTIONARY",t[t.LOOKED=7]="LOOKED",t[t.ACCEPTED=8]="ACCEPTED",t[t.ACKNOWLEDGED=9]="ACKNOWLEDGED",t[t.POPUP_OPEN=10]="POPUP_OPEN",t[t.POPUP_CLOSE=11]="POPUP_CLOSE",t[t.UNDOED=12]="UNDOED"}(e.FeedbackType||(e.FeedbackType={}))},264:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(236);!function(t){function e(t,e){var n=e/60,i=r.secondsToTime(t.words/n);return i.s=i.h>0&&i.m>10?0:Math.floor(i.s),i}function n(t){return e(t,250)}function i(t){return e(t,130)}function o(e,n){var r={words:e,chars:n,sentences:Math.floor(e/5),readingTime:{},speakingTime:{},uniqueWords:40*Math.random(),uniqueWordsIndex:100*Math.random(),rareWords:20*Math.random(),rareWordsIndex:100*Math.random(),wordLength:5.4,wordLengthIndex:100*Math.random(),sentenceLength:16.7,sentenceLengthIndex:100*Math.random(),readabilityScore:73,readabilityDescription:"Your text is likely to be understood by a reader who has at least 7th grade education (age 12)"};return r.readingTime=t.calculateReadingTime(r),r.speakingTime=t.calculateSpeakingTime(r),r}t.calculateReadingTime=n,t.calculateSpeakingTime=i,t.generateStats=o}(e.DocumentStatistics||(e.DocumentStatistics={}))},265:function(t,e,n){"use strict";function r(t,n){var r="function"==typeof t?t:n,i="function"!=typeof t?t:void 0;return r.contextTypes=e.baseComponentContextTypes,i&&(r.propTypes=i),r}function i(t){return r(t)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=n(15),a=n(23),c=n(163),u=n(261),l=n(270),h=n(243),d=n(107),p={appConfig:a.object};e.baseComponentContextTypes=Object.assign({router:a.object},d.Router.ContextTypes,p,c.telemetryContextType,u.textResourcesContextTypes,h.notificationsContextTypes,l.tooltipContextTypes);var f=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(n,t),n.contextTypes=e.baseComponentContextTypes,n}(s.Component);e.BaseComponent=f,e.component=r,e.withContext=i},266:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ONLINE="online"},267:function(t,e,n){"use strict";function r(t,e,n,r){return{id:t,title:e,localText:n,proofitState:r}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),o=n(4),s=n(42),a=n(6),c=n(471);e.createInitialState=r;var u=function(){function t(t,e,n,r,u,l,h,d){var p=this;this._state=t,this._doxApi=e,this._remoteDocSession=n,this._document=r,this._textChangedByServer=u,this._documentErrors=l,this._onClose=h,this._preventSyncWithDox=d,this._sessionActive=!0,this._contentSync=new c.BufferedRemoteSync(function(t){if(p._preventSyncWithDox)return Promise.resolve();a.invariant(null!==p._remoteDocSession,"Expect remote session to be established");var e=p._remoteDocSession.getText(),n=p._remoteDocSession.setText(p.localText.get()).catch(function(t){t&&"reset"===t.message?o.Monitoring.Logging.getLogger("model.editor.document_model").warn("Got DOX reset",t):p._documentErrors.set({type:"error",reason:"Cannot set text: "+(t&&t.message),error:t})});return n.then(function(t){void 0!==t&&t!==e&&p.proofitState.get().proofit&&(p._document.resetProofit(),p._doxApi.saveDocument(p._document).then(function(){return p.proofitState.set({proofit:null,source:"websocket"})}))}),n.then(function(){})}),this._titleSync=this._createDocumentDataSync(function(t,e){t.title=e},1e3),this._genreSync=this._createDocumentDataSync(function(t,e){t.setGenre(e)},200),this._checksSync=this._createDocumentDataSync(function(t,e){t.setChecks(e)},200),this._contextSync=this._createDocumentDataSync(function(t,e){t.setContext(e)},1e3),this._alertCountSync=this._createDocumentDataSync(function(t,e){t.errors=e},3e3),this._allSyncs=[this._contentSync,this._titleSync,this._genreSync,this._checksSync,this._contextSync,this._alertCountSync],this.localTitle=this._state.lens(function(t){return t.title}),this.localText=this._state.lens(function(t){return t.localText}),this.proofitState=this._state.lens(function(t){return t.proofitState}),this.proofitCompleted=this.proofitState.skip(1).map(function(t){var e=t.proofit;return e&&e.status===s.ProofitJobStatus.completed?e:null}).distinctUntilChanged(),this.id=this._state.view(function(t){return t.id}),this.isNew=this._state.view(function(t){return!(!t.title&&!t.localText)}).scan(function(t,e){return t||e},!1),this.localChangesSaved=i.Atom.combine(this._contentSync.hasUnsavedChanges,this._titleSync.hasUnsavedChanges,this._genreSync.hasUnsavedChanges,this._checksSync.hasUnsavedChanges,this._contextSync.hasUnsavedChanges,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.every(function(t){return!1===t})}),this.textChangedByServer=this._textChangedByServer,this._allSyncs.forEach(function(t){return t.startSyncing()})}return t.prototype.setRemoteDocumentSession=function(t){this._remoteDocSession=t},t.prototype._createDocumentDataSync=function(t,e){var n=this;return new c.BufferedRemoteSync(function(e){if(n._preventSyncWithDox)return Promise.resolve();a.invariant(null!==n._document,"Expect remote session to be established"),t(n._document,e);var r=i.Atom.create(a.Async.defaultValue());return a.Async.OperationRetrier.create(function(){return n._doxApi.saveDocument(n._document)},r,a.Async.OperationRetrier.RetryStrategy.conditional(function(t){return!(t instanceof s.HTTPError)||a.isServerErrorCode(t.code)},a.Async.OperationRetrier.RetryStrategy.linear(3,3e3))),r.filter(a.Async.isTerminated).first().toPromise().then(function(t){a.Async.isFatal(t)&&n._documentErrors.set({type:"error",reason:"Saving document error: "+t.error.message,error:t.error})})},e)},t.prototype._expectActiveSession=function(){a.invariant(this._sessionActive,"Expect remote session to be established")},t.prototype.setDocumentContent=function(t){this._expectActiveSession(),this._contentSync.setLocalValue(t),this.localText.set(t)},t.prototype.setDocumentTitle=function(t){this._expectActiveSession(),this.localTitle.set(t),this._titleSync.setLocalValue(t)},t.prototype.setDocumentGenre=function(t){var e=this;this._expectActiveSession(),this._genreSync.setLocalValue(t),this._document.context.map(function(){var n=Object.assign({},e.context,{domain:s.genreToDomain(t)});e._contextSync.setLocalValue(n)})},t.prototype.setDocumentAlertCount=function(t){this._expectActiveSession(),this._alertCountSync.setLocalValue(t)},t.prototype.setDocumentChecks=function(t){this._expectActiveSession(),this._checksSync.setLocalValue(t)},t.prototype.end=function(){var t=this;return new Promise(function(e,n){t._onClose(),t._alertCountSync.syncNow(),t._allSyncs.forEach(function(t){return t.stopSyncing()}),t._expectActiveSession(),t._sessionActive=!1,t._remoteDocSession.close().then(function(){return e()})})},Object.defineProperty(t.prototype,"context",{get:function(){var t=this;return this._document.context.getOrElse(function(){var e=s.genreToDomain(t._document.genre);return Object.assign({},s.DocumentContext.empty,{domain:e})})},enumerable:!0,configurable:!0}),t.prototype.setDocumentContext=function(t){this._expectActiveSession(),this._contextSync.setLocalValue(t),this._genreSync.setLocalValue(s.domainToGenre(t.domain))},t}();e.DocumentSessionImpl=u},268:function(t,e,n){"use strict";function r(t,e,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=!1);var r=d.Cookie.getCookie(_),i=c.setPlagiarism(e||c.defaultState,"true"===r),o=t||(n?"academic_general":"general");return{textStats:u.defaultState,checkingSettings:i,checkingGenre:o,editor:l.defaultState,cards:h.defaultState}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(42),s=n(10),a=n(4),c=n(234),u=n(168),l=n(269),h=n(472),d=n(6),p=n(464),f=n(465),_="isPlagiarismFunnel";e.defaultState=r(),e.createDefaultState=r;var g=function(){function t(t,e,n,r,i,o,a,c,u,l){this._state=t,this.documentSession=e,this.textStats=n,this._capiWsUrl=r,this._dialectSettingsModel=i,this._features=o,this._telemetry=a,this._alertCache=c,this._getContainerId=u,this._capiConnectivity=l,this.editorEngine=s.Atom.create(null),this.cardsModel=null,this.denaliScrollModel=new p.DenaliScrollModelImpl,this.denaliEditorViewModel=new f.DenaliEditorViewModel,this.contextState=s.Atom.create(this.documentSession.context),this._documentSyncSubs=null}return t.prototype.startEditor=function(t,e,n){var r=this;d.invariant(null===this.editorEngine.get()&&null===this._documentSyncSubs,"editor should not be started");var i=new c.CheckingSettingsModelImpl(this._state.lens(function(t){return t.checkingGenre}),this._state.lens(function(t){return t.checkingSettings}),this._telemetry),s=this._dialectSettingsModel.dialect.get(),a=new l.GrammarlyEditorEngine(this._state.lens(function(t){return t.editor}),t,"textarea",e,this.documentSession.id.get(),this.documentSession.localText.get(),this._capiWsUrl,i,this._dialectSettingsModel,function(){return r._alertCache.load(r.documentSession.id.get().toString(),s,r._features.isFree)},function(t){return r._alertCache.save(r.documentSession.id.get().toString(),s,r._features.isFree,t)},this._getContainerId,this._capiConnectivity,this._features.isDesktopEditor?"desktop_editor":void 0,n,this._features.isUserTesting.get());return this.cardsModel=new h.CardsModelImpl(this._state.lens(function(t){return t.cards}),a,this._features),a.mount(),this._documentSyncSubs=[this.documentSession.textChangedByServer.subscribe(function(t){a.setDocumentContent(t)}),a.textChangedByUser.subscribe(function(t){r.documentSession.setDocumentContent(t)}),a.scores.view(function(t){return[t.visiblePremiumAlerts,t.criticalAlerts]}).skip(1).subscribe(function(t){var e=t[0],n=t[1];r.documentSession.setDocumentAlertCount(n+(r._features.isFree?0:e))}),i.checksEnabled.skip(1).subscribe(function(t){return r.documentSession.setDocumentChecks(t)}),i.genre.skip(1).subscribe(function(t){return r.documentSession.setDocumentGenre(t)})],n&&this._documentSyncSubs.push(this.contextState.skip(1).subscribe(function(t){r.documentSession.setDocumentContext(t),i.genre.set(o.domainToGenre(t.domain))})),this.editorEngine.set(a),a},t.prototype.stopEditor=function(){var t=this.editorEngine.get();if(!t||!this._documentSyncSubs)throw new d.InvariantError("editor should be started");this._documentSyncSubs.forEach(function(t){return t.unsubscribe()}),this._documentSyncSubs=null,this.editorEngine.set(null),t.unmount()},Object.defineProperty(t.prototype,"isActive",{get:function(){return null!==this.editorEngine.get()},enumerable:!0,configurable:!0}),t.prototype.end=function(){return i.__awaiter(this,void 0,void 0,function(){var t;return i.__generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.isActive&&this.stopEditor(),[4,this.documentSession.end()];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),a.Monitoring.Logging.getLogger("model.editor.editor_sesion").error("DOX editor session end failed",t),[3,3];case 3:return[2]}})})},t}();e.EditorSessionImpl=g},269:function(t,e,n){"use strict";function r(t){function e(t){var e=typeof t;return null!=t&&("object"===e||"function"===e)}function n(t){var n={};for(var r in t)"ts"!==r&&"renderTs"!==r&&"tracked"!==r&&("r"!==r&&"origReplacements"!==r&&"rHtml"!==r&&"examples"!==r&&"references"!==r&&"rawMatch"!==r&&(e(t[r])||"selected"===r&&!Array.isArray(t[r]))||(n[r]=t[r]));return n}return t.filter(function(t){return!t.replaced}).map(n)}function i(t,e,n,r,i,o,s,a,c,l,h,d,p,g,m){g&&(u.Capi.CLIENT_NAME=g);var v=u({silentLogs:!0,el:t,docid:parseInt(r,10),value:i,sid:0,capiUrl:o,matches:h,apps:{plagiarismActive:s},editorType:"textarea"===e?{textarea:!0,value:"textarea"}:{contenteditable:!0,value:"contenteditable"},asPlainText:!0,textareaWrapSelector:"#"+n,plagiarismCheckDelay:1e4,dialect:a,filter:function(t){return t?t.filter(function(t){return(m||!t.rawMatch.hidden)&&("synonyms"===t.rawMatch.action||c(y.alertGroupFromString(t.rawMatch.group)))}):[]},canRemoveSynonym:function(t){return!!_.DOM.hasParentWithClassName(t,"closeSyn")||!_.DOM.hasParentWithClassName(t,"cardSyn")},extendParams:function(t){t.genre=l()},exposeRawMatch:!0,exposeSynApi:!0,getContainerId:d,capiIdleTimeout:24e4,textareaBottomPadding:36,removeByPIDOnIgnore:!m,synAutofix:!0,skipMousedownWhen:function(t){return _.DOM.hasParentWithClassName(t.target,b.CardBaseClassName)}});if(m)v.synonyms.disable(),v.getMatchClass=function(t){if(!t.rawMatch)return"";if("synonyms"===t.rawMatch.action)return"gr_syn_replaced";var e=f.pnameToLensProp(t.rawMatch.pname,function(t){return t.type});if(!e||t.rawMatch.hidden)return"";var n=["grAlert"+e];t.replaced&&n.push("Replaced"),t.selected&&n.push(" sel");var r=p(t.rawMatch);return r&&n.push(" "+r)," gr_"+t.rawMatch.id+" "+n.join("")};else{var w=v.getMatchClass;v.getMatchClass=function(t,e){var n=w(t,e);return t.rawMatch?((t.rawMatch.renderedOnce||"safari"===C.browser)&&(n+=" gr_disable_anim_appear"),"synonyms"===t.rawMatch.action&&(n+=" gr_syn_replaced"),t.rawMatch.renderedOnce=!0,n):n}}return v}function o(t){return t.rawMatch.group||"synonyms"===t.rawMatch.action}Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),a=n(24),c=n(35),u=n(407),l=n(42),h=n(10),d=n(4),p=n(128),f=n(388),_=n(6),g=n(43),m=n(234),y=n(76),v=n(390),b=n(231),w=n(473),E=n(477),S=n(242);e.defaultState={pendingAlertAction:null,alertHighlights:{focused:{id:null,source:null},highlighted:null},alerts:{},premiumMatches:[],checkingStatus:b.CheckingStatus.idle};var C=g.getBrowserInfo(),x=function(){function t(t,e,n,r,i,o,u,l,p,g,v,C,x,T,A,k){var O=this;this._state=t,this._domElement=e,this._textAreaType=n,this._textAreaWrapperElementId=r,this._docId=i,this._initialText=o,this._capiWsUrl=u,this._checkingSettings=l,this._dialectSetting=p,this._getCachedMatches=g,this._cacheSerializableMatches=v,this._getContainerId=C,this._capiConnectivity=x,this._capiClientName=T,this._isDenali=A,this._isUserTesting=k,this.synonymsViewModel=new E.SynonymsViewModelImpl(new S.SynonymsModelImpl(function(t,e){return s.__awaiter(O,void 0,void 0,function(){var n,r,i;return s.__generator(this,function(o){switch(o.label){case 0:if(!this._editor)throw new _.InvariantError("editor should be mounted");return this._editor.synonyms.requestSynonyms(t,e),[4,this._synonymAlerts.first().toPromise()];case 1:if(n=o.sent(),n.title===e){if(0!==n.meanings.length)return r=function(t){return{word:t.newText,definition:""}},i=1===n.meanings.length?c.Either.left(n.meanings[0].replacements.map(r)):c.Either.right(n.meanings.map(function(t){return{meaning:t.title,words:t.replacements.map(r)}})),[2,{originalWord:e,synonymsOrGroups:i,alert:n}];throw new Error("Wrong synonym alert for "+e+": expecting meanings to exists")}throw new Error("Wrong synonym alert: expecting "+e+", got "+n.title)}})})}),function(){if(!O._editor)throw new _.InvariantError("editor should be mounted");return O._editor.synonyms},function(t,e,n){var r=t.match;r.replaced=!0,r.replace(n,!1)}),this.pendingAlertAction=this._state.lens(function(t){return t.pendingAlertAction}),this._undoedAction=h.Atom.create(null),this.undoedAlert=this._undoedAction.skip(1).switchMap(function(t){return t?O._visibleAlerts.view(function(e){return e[t.id]}).filter(function(t){return!!t}).take(1):a.Observable.of(null)}),this._log=d.Monitoring.Logging.getLogger("model.editor.ge_engine"),this.appliedAlertIds=new Set,this._highlights=this._state.lens(function(t){return t.alertHighlights}),this._focusedAlert=this._highlights.lens(function(t){return t.focused}),this._highlightedAlert=this._highlights.lens(function(t){return t.highlighted}),this._visibleAlerts=this._state.lens(function(t){return t.alerts}),this._synonymAlerts=new a.Subject,this._matchFilterState=h.Atom.create({typeOrCategory:null,premium:null}),this._visibleAlertsFlattened=h.Atom.combine(this._visibleAlerts,this._matchFilterState,function(t,e){return Object.keys(t).map(function(e){return t[e]}).filter(function(t){return O._isVisible(t.alert.pname,t.alert.isFree,e)})}),this._premiumMatches=this._state.lens(function(t){return t.premiumMatches}),this._checkingStatus=this._state.lens(function(t){return t.checkingStatus}),this._textChangedByUser=new a.Subject,this._editor=null,this._editorEventSubs=null,this.denaliScores=h.Atom.create({accuracy:0,clarity:0,effectiveness:0,score:0,rank:0}),this._editorRendered=this._unsafeEditorEvent("rendered"),this._editorAlertRemovedOnServer=this._unsafeEditorEvent("serverRemove"),this._editorAlertSelected=this._unsafeEditorEvent("selectedMatch"),this._editorAlertDeselected=this._unsafeEditorEvent("deselectedMatch"),this._editorSending=this._unsafeEditorEvent("sending"),this._capiSocketConnect=this._unsafeEditorEvent("socketConnect"),this._capiSocketStart=this._unsafeEditorEvent("socketStart"),this._capiSocketError=this._unsafeEditorEvent("socketError"),this._capiSocketDisconnect=this._unsafeEditorEvent("disconnect"),this._editorFinishedChecking=this._unsafeEditorEvent("finish"),this._pastedTextSize=new a.Subject,this.recheckingState=h.Atom.create(this._initialText.length>0),this._editorPlagiarismChecked=this._unsafeEditorEvent("plagiarismChecked"),this._editorFix=this._unsafeEditorEvent("fix"),this.alerts=this._visibleAlerts,this.checkingStatus=this._checkingStatus,this.hoveredAlert=a.Observable.fromEvent(this._domElement,"mousemove").throttleTime(100).map(function(t){var e=O._domElement.getBoundingClientRect();return O._getAlertByPosition({x:t.clientX-e.left,y:t.clientY-e.top})}).map(function(t){return null===t?null:!0===t.alert.hidden?null:t}).map(function(t){var e=O.pendingAlertAction.get();return e&&t?b.AppliedAlertAction.isSingle(e)?t.alert.id===e.alertId?null:t:-1!==e.alertIds.indexOf(t.alert.id)?null:t:t}),this.settings=this._checkingSettings,this.localText=h.Atom.create(this._initialText),this.approximateWordCount=h.Atom.create(_.StringUtils.wordCount(this._initialText)),this.approximateCharCount=h.Atom.create(_.StringUtils.charCount(this._initialText)),this.scores=h.Atom.combine(this.localText.view(function(t){return null!=t?t:""}),this.approximateWordCount,this._visibleAlerts,this._premiumMatches,function(t,e,n,r){return w.calculateScores(t.length,e||0,Object.keys(n).filter(function(t){return!O.appliedAlertIds.has(t)}).map(function(t){return n[t].alert}),r.length)}),this.alertsCount=this._visibleAlerts.view(function(t){var e=m.createChecksDefaultState(0);return Object.keys(t).map(function(e){return t[e].alert}).forEach(function(t){switch(t.group){case y.AlertGroup.contextualSpelling:e.contextualSpelling++;break;case y.AlertGroup.enhancement:e.enhancement++;break;case y.AlertGroup.grammar:e.grammar++;break;case y.AlertGroup.plagiarism:e.plagiarism++;break;case y.AlertGroup.punctuation:e.punctuation++;break;case y.AlertGroup.sentenceStructure:e.sentenceStructure++;break;case y.AlertGroup.style:e.style++;break;case y.AlertGroup.synonym:break;default:throw new TypeError("Unknown alert group: "+t.group)}}),e}),this.premiumAlertsCount=this.scores.view(function(t){return t.premiumAlerts}),this.textChangedByUser=this._textChangedByUser.distinctUntilChanged().skipWhile(function(t){return t===O._initialText}),this.focusedAlert=h.Atom.combine(this._visibleAlerts,this._focusedAlert,function(t,e){return O._getSynonymAlert(t)||e}),this.highlightedAlert=this._highlightedAlert,this._matchClassAppender=function(t){var e=O._matchFilterState.get();return O._isVisible(t.pname,t.free,e)?void 0:"grAlertHidden"},this._filterByCategory=function(t,e){if(!e)return!0;switch(e.type){case"category":return f.pnameToLensProp(t,function(t){return t.key})===e.value;case"type":return f.pnameToLensProp(t,function(t){return t.type})===e.value;default:return _.assertNever(e)}},this._filterByPremium=function(t,e){if(!e)return!0;switch(e.type){case"premium":return!t;case"free":return t;default:return _.assertNever(e)}},this._isVisible=function(t,e,n){return O._filterByPremium(e,n.premium)&&O._filterByCategory(t,n.typeOrCategory)}}return t.prototype._unsafeEditorEvent=function(t){var e=this;return a.Observable.fromEventPattern(function(n){if(!e._editor)throw new _.InvariantError("editor should be mounted");e._editor.on(t,n)},function(n){if(!e._editor)throw new _.InvariantError("editor should be mounted");e._editor.off(t,n)},function(t){return t})},t.prototype.updatePastedTextSize=function(t){this._pastedTextSize.next(t)},t.prototype._mergeUndoedAlert=function(t){var e=this._undoedAction.get();if(e){var n=t.find(function(t){return t.value===e.value&&t.rawMatch.pname===e.rawMatch.pname&&t.rawMatch.begin===e.rawMatch.begin});n&&n.id!==e.id&&(this._visibleAlerts.modify(function(t){var r=t[e.id];return Object.assign({},t,(i={},i[e.id]=null,i),(o={},o[n.id]={alert:v.createAlert(n),highlightPosition:r.highlightPosition},o));var i,o}),this._focusedAlert.modify(function(t){return t.id===e.id?{id:n.id,source:"undo"}:t}),this._highlightedAlert.modify(function(t){return t&&t===e.id?n.id:t}))}},t.prototype._updateRemovedAlerts=function(t){var e=this;this._focusedAlert.modify(function(t){return t.id&&!e._unsafeGetMatchById(t.id)?{id:null,source:null}:t}),this._highlightedAlert.modify(function(t){return t&&!e._unsafeGetMatchById(t)?null:t}),this._visibleAlerts.modify(function(e){var n=t.filter(function(t){return o(t)&&void 0!==e[t.id]}),r={};return n.forEach(function(t){return r[t.id]=e[t.id]}),r}),this.pendingAlertAction.modify(function(t){return t&&b.AppliedAlertAction.isSingle(t)&&!e._unsafeGetMatchById(t.alertId)?null:t})},t.prototype._updateAddedAlerts=function(t){var e=this,n=function(){return e._domElement.getBoundingClientRect()};this._visibleAlerts.modify(function(r){var i=t.filter(o),s={};return i.map(function(t){try{return{match:t,highlightPosition:_.DOM.absToRelativeBuggy(t.getEl()&&t.getEl().getClientRects()[0],n())}}catch(t){return e._log.error(t),null}}).forEach(function(t){if(t)try{var n=v.createAlert(t.match);"synonym"===n.kind&&e._isDenali?e._synonymAlerts.next(n):s[t.match.id]={alert:r[t.match.id]?r[t.match.id].alert:n,highlightPosition:t.highlightPosition}}catch(t){e._log.error("Failed to create alert, skip it",t)}}),s})},t.prototype._updatePremiumAlertCount=function(t){this._premiumMatches.set(t.getMatches().filter(function(t){return!t.rawMatch.free&&"synonyms"!==t.rawMatch.action}))},t.prototype._getCurrentVisibleMatches=function(t){return t.getFiltered().filter(function(t){return t.getEl()})},t.prototype._subscribeToUpdateCheckingStatus=function(){var t=this;return a.Observable.merge(this._editorSending.mapTo(1),this._editorFinishedChecking.mapTo(-1),this._editorPlagiarismChecked.mapTo(-1),this._capiSocketDisconnect.mapTo(NaN)).scan(function(t,e){return Number.isNaN(e)?0:Math.max(0,t+e)},0).map(function(t){return 0===t?b.CheckingStatus.finished:b.CheckingStatus.inProgress}).subscribe(function(e){return t._checkingStatus.set(e)})},t.prototype._checkPlagiarism=function(t){var e=this;void 0===t&&(t=100),setTimeout(function(){e._editor&&e._checkingSettings.plagiarismEnabled.get()&&e._editor.checkPlagiarism()},t)},t.prototype.mount=function(){var t=this;_.invariant(null==this._editorEventSubs&&null==this._editor,"editor should not be mounted");var e,n=this._dialectSetting.dialect.get();try{e=this._getCachedMatches()}catch(t){this._log.error("could not load cached alerts",t)}if(this._editor=i(this._domElement,this._textAreaType,this._textAreaWrapperElementId,this._docId,this._initialText,this._capiWsUrl,function(){return t._checkingSettings.plagiarismEnabled.get()},n,function(e){return t._checkingSettings.isAlertGroupEnabled(e)},function(){return t._checkingSettings.genre.get()},e||[],this._getContainerId,this._matchClassAppender,this._capiClientName,this._isDenali),this._editorEventSubs=[this._editorRendered.subscribe(function(){t._editor&&(t._undoedAction.get()&&t._mergeUndoedAlert(t._getCurrentVisibleMatches(t._editor)),t._updateRemovedAlerts(t._getCurrentVisibleMatches(t._editor)),t._updatePremiumAlertCount(t._editor))}),a.Observable.merge(this._editorRendered,a.Observable.fromEvent(window,"resize")).auditTime(50).subscribe(function(){t._editor&&(t._updateAddedAlerts(t._getCurrentVisibleMatches(t._editor)),t._updatePremiumAlertCount(t._editor))}),a.Observable.merge(this._editorRendered,this._checkingStatus.skip(1).filter(function(t){return t===b.CheckingStatus.finished})).auditTime(1e3).subscribe(function(){t._editor&&t._tryCacheCurrentAlerts()}),this._editorRendered.subscribe(function(){if(t._editor){var e=t._editor.getText();t.localText.set(e),t._textChangedByUser.next(t._editor.getText())}}),this.localText.audit(function(t){return a.Observable.timer(t&&t.length>1e3?1e3:100)}).startWith(this.localText.get()).subscribe(function(e){t.approximateWordCount.set(_.StringUtils.wordCount(e)),t.approximateCharCount.set(_.StringUtils.charCount(e))}),this._editorAlertRemovedOnServer.subscribe(function(e){t.appliedAlertIds.has(e.id)&&(e.cancelServerRemove=!0);var n=t._undoedAction.get();n&&n.id===e.id&&(e.cancelServerRemove=!0,t._undoedAction.set(null))}),this._editorAlertSelected.subscribe(function(e){_.invariant(null===t._focusedAlert.get().id,"alert selected without prior deselect:\n            had "+t._focusedAlert.get()+" selected,\n            selecting "+e.id),t._focusedAlert.set({id:e.id,source:"text"})}),this._editorAlertDeselected.subscribe(function(e){_.invariant(t._focusedAlert.get().id===e.id||t._highlightedAlert.get()===e.id,"other alert deselected:\n            had "+t._focusedAlert.get()+" selected,\n            deselecting "+e.id),t._focusedAlert.modify(function(t){return t.id===e.id?{id:null,source:null}:t}),t._highlightedAlert.modify(function(t){return t===e.id?null:t})}),this._subscribeToUpdateCheckingStatus(),this._checkingSettings.genre.skip(1).subscribe(function(e){t._editor&&(t.pendingAlertAction.get()&&t.commitLastAlertAction(),t._editor.hardReset(),t._checkPlagiarism(1e3))}),this._checkingSettings.checksEnabled.skip(1).subscribe(function(e){t._editor&&(t.pendingAlertAction.get()&&t.commitLastAlertAction(),t._editor.render(),t._checkPlagiarism())}),n?a.Subscription.EMPTY:this._editorFinishedChecking.map(function(t){return t&&t.dialect}).skipWhile(function(t){return!p.isDialectString(t)}).take(1).subscribe(function(e){p.isDialectString(e)&&t._dialectSetting.setDialectWeak(e)}),a.Observable.merge(this._capiSocketDisconnect.filter(function(t){return 4095!==t.code&&1001!==t.code}).map(function(t){var e=t.code,n=t.reason;return{type:"disconnected",error:new l.WSError({status:n,code:e,message:"Cannot connect to CAPI"})}}),this._capiSocketStart.mapTo({type:"connected"})).distinctUntilChanged(function(t,e){return t.type===e.type}).switchMap(function(t){return"connected"===t.type?a.Observable.of(t):a.Observable.of(t).delay(5e3)}).subscribe(function(e){return t._capiConnectivity.set(e)}),this._capiSocketConnect.subscribe(function(e){var n=t.pendingAlertAction.get();if(t._editor&&n)if(t._log.debug("Pending alert action on CAPI connect: kind = "+n.kind+";\naction = "+(b.AppliedAlertAction.isSingle(n)&&n.action)),b.AppliedAlertAction.isSingle(n)){var r=t._unsafeGetMatchById(n.alertId),i=r&&!r.undoed;i||t._log.error("Alerts not in sync: pending undone alert action")}else b.AppliedAlertAction.isBatchIgnore(n)&&!n.alertIds.some(function(e){var n=t._unsafeGetMatchById(e);return n&&!n.undoed||!1})&&t._log.error("Alerts not in sync: pending undone alert action")}),this._capiSocketError.map(function(t){var e=t.code,n=t.reason;return new l.WSError({status:n,code:e,message:"CAPI socket error"})}).distinctUntilChanged(function(t,e){return t.code===e.code}).subscribe(function(e){return t._log.warn("CAPI socket error",e)}),this._editorFix.subscribe(_.Extension.notifications.sendEditorFix),this._undoedAction.subscribe(function(e){e&&e.id&&(t.setFocusedAlert(e.id,"undo"),t.setHighlightedAlert(e.id))})],this._isDenali){var r=function(t,e){var n=t.slice(0,e+1).search(/\w+$/),r=t.slice(e).search(/\W/);return[n,r<0?t.length-1:r+e]},o=function(){if(!t._editor)throw new _.InvariantError("editor should be mounted");var e=t._editor.getSelection(),n=function(t){var e=t.s,n=t.text||"",i=r(n,e),o=i[0],s=i[1];return{pos:e,s:o,e:s,word:n.slice(o,s)}}(e),i=function(e){return c.Option.of(t._editor.dom.htmlDom.renderRange({s:e.s,e:e.s+1})[0]).map(function(e){var n=_.DOM.absToRelativeBuggy(e.getClientRects()[0],t._domElement.getBoundingClientRect());return e.className="denaliCarretPoint",t._editor.dom.htmlDom.removeBySelector(".denaliCarretPoint"),n})},o=i(e),s=i(n);return o.chain(function(t){return s.map(function(e){return{cursor:t,word:e}})})},s=function(){requestAnimationFrame(function(){return o().map(function(t){return{cursor:{x:t.cursor.left,y:t.cursor.top},word:{x:t.word.left,y:t.word.top}}}).map(function(e){return t.synonymsViewModel.move(e.cursor,e.word)})})};if(!this._isUserTesting){var u=a.Observable.merge(a.Observable.fromEvent(this._domElement,"click")).map(function(){if(!t._editor)throw new _.InvariantError("editor should be mounted");var e=t._editor.getSelection();return c.Option.of(e.s===e.e?e:null).map(function(t){var e=t.s,n=t.text||"",i=r(n,e),o=i[0],s=i[1];return{pos:e,s:o,e:s,word:n.slice(o,s)}}).filter(function(t){return t.word.length>2&&t.pos>t.s})}).share(),h=u.distinctUntilChanged(function(t,e){return t.equals(e)}).subscribe(function(e){e.fold(function(){return t.synonymsViewModel.hide()},function(e){return t.synonymsViewModel.showButton({start:e.s,word:e.word})})});this.synonymsViewModel.viewState.view(function(t){return null===t?null:t.synonymsState}).filter(function(t){return null!==t&&S.SynonymsModel.isReady(t)&&void 0!==t.synonyms}).subscribe(function(){s()}),this._editorEventSubs.push(h)}this._editorEventSubs.push(this._matchFilterState.skip(1).subscribe(function(){if(!t._editor)throw new _.InvariantError("editor should be mounted");t._getCurrentVisibleMatches(t._editor).forEach(function(e){var n=e.getEl(),r=t._editor.getMatchClass(e,"");n.className!==r&&(n.className=r)})}),this._editorFinishedChecking.subscribe(function(e){var n=e.scores,r=void 0===n?{Accuracy:0,Clarity:0,Effectiveness:0}:n,i=e.score,o=void 0===i?0:i;return t.denaliScores.set({accuracy:r.Accuracy,clarity:r.Clarity,effectiveness:r.Effectiveness,score:o,rank:Math.round(.5*r.Accuracy+.25*(r.Clarity+r.Effectiveness))})}),a.Observable.merge(this._capiSocketStart.mapTo(!0),this._pastedTextSize.filter(function(t){return t>1e3}).mapTo(!0),this._editorFinishedChecking.debounceTime(1e3).mapTo(!1)).subscribe(function(e){return t.recheckingState.set(t._initialText.length>0&&e)}))}this._editor.run(),this._checkPlagiarism()},t.prototype._unsafeGetMatchById=function(t){if(!this._editor)throw new Error("editor should be mounted");return this._editor.matches.byId(t)},t.prototype._getMatchById=function(t){var e=this._unsafeGetMatchById(t);if(!e)throw new _.InvariantError("expected non-null match #"+t);return e},t.prototype._updateHighlights=function(t,e){var n=this;[t.focused.id,t.highlighted].forEach(function(t){var e=null!==t&&n._unsafeGetMatchById(t);e&&e.deselect(!0)}),[e.focused.id,e.highlighted].forEach(function(t){try{null!==t&&n._getMatchById(t).select(!0)}catch(t){n._log.warn("Update highlights failed",t)}})},t.prototype._tryCacheCurrentAlerts=function(){if(!this._editor)throw new _.InvariantError("editor should be mounted");try{this._cacheSerializableMatches(r(this._editor.getMatches().filter(function(t){return"synonyms"!==t.rawMatch.action})))}catch(t){this._log.error("could not cache alerts",t)}},t.prototype.unmount=function(){if(!this._editor||!this._editorEventSubs)throw new _.InvariantError("editor should be mounted");this.pendingAlertAction.get()&&this.commitLastAlertAction(),this._tryCacheCurrentAlerts(),this._editorEventSubs.forEach(function(t){return t.unsubscribe()}),this._editorEventSubs=null,this._editor.exit(),this._editor=null},t.prototype.setDocumentContent=function(t){if(!this._editor)throw new _.InvariantError("editor should be mounted");this.pendingAlertAction.get()&&this.commitLastAlertAction(),this._editor.setText(t)},t.prototype.skipInputEvents=function(t){var e=(void 0===t?{turnBack:!1}:t).turnBack;if(!this._editor)throw new _.InvariantError("editor should be mounted");this._editor.inputListener.skipInputEvents(!1!==e||void 0)},t.prototype._applyAlert=function(t,e){if(!this._editor)throw new _.InvariantError("editor should be mounted");var n=this._getMatchById(t);switch(e.action){case"replace":n.replaced=!0,n.replace(e.replacementText,!1),e.isSynonym&&n.removeUnderline();break;case"ignore":case"addToDictionary":case"acknowledge":this._isDenali?(n.replaced=!0,n.getEl().className=this._editor.getMatchClass(n,"")):n.getEl().classList.add("gr_replaced");break;default:return _.assertNever(e)}this.pendingAlertAction.set(b.AppliedAlertAction.createSingle(t,e)),this.appliedAlertIds.add(t)},t.prototype.batchIgnore=function(t){var e=this;if(!this._editor)throw new _.InvariantError("editor should be mounted");var n=this.pendingAlertAction.get();if(n&&(this.commitLastAlertAction(),b.AppliedAlertAction.isBatchIgnore(n)&&n.alertIds.length>0&&JSON.stringify(n.alertIds)===JSON.stringify(t)))throw new _.InvariantError("alert was already applied");try{t.forEach(function(t){return requestAnimationFrame(function(){e._getMatchById(t).replaced=!0,e.appliedAlertIds.add(t)})}),this.pendingAlertAction.set(b.AppliedAlertAction.createBatchIgnore(t))}catch(t){this._log.warn("Apply alert failed, action: batchIgnore",t)}this._focusedAlert.set({id:null,source:null}),this.setHighlightedAlert(null)},t.prototype.applyAlert=function(t,e){if(!this._editor)throw new _.InvariantError("editor should be mounted");var n=this.pendingAlertAction.get();if(n&&(this.commitLastAlertAction(),b.AppliedAlertAction.isSingle(n)&&n.alertId===t))throw new _.InvariantError("alert was already applied");try{this._applyAlert(t,e)}catch(t){this._log.warn("Apply alert failed, action: "+e.action,t)}this._focusedAlert.set({id:null,source:null}),this.setHighlightedAlert(null),this._undoedAction.set(null)},t.prototype.commitLastAlertAction=function(){var t=this;if(!this._editor)throw new _.InvariantError("editor should be mounted");var e=this.pendingAlertAction.get();if(!e)throw new _.InvariantError("can not commit when no action was applied");if(b.AppliedAlertAction.isBatchIgnore(e))return e.alertIds.forEach(function(e){t._getMatchById(e).ignore()}),this.appliedAlertIds.clear(),void this.pendingAlertAction.set(null);if("replace"===e.action.action&&e.action.isSynonym)return void this.pendingAlertAction.set(null);try{var n=this._getMatchById(e.alertId);switch(e.action.action){case"replace":n.remove();break;case"ignore":n.ignore();break;case"addToDictionary":this._isUserTesting?n.remove():n.addToDict();break;case"acknowledge":n.acknowledged();break;default:return _.assertNever(e.action)}}catch(t){this._log.warn("commitLastAlertAction failed",t)}this.appliedAlertIds.clear(),this.pendingAlertAction.set(null)},t.prototype._removeUndoStyles=function(t){this._isDenali?(t.replaced=!1,t.getEl().className=this._editor.getMatchClass(t,"")):t.getEl().classList.remove("gr_replaced")},t.prototype.undoLastAlertAction=function(){var t=this;if(!this._editor)throw new _.InvariantError("editor should be mounted");var e=this.pendingAlertAction.get();if(!e)throw new _.InvariantError("can not undo when no action was applied");if(b.AppliedAlertAction.isBatchIgnore(e))return void e.alertIds.forEach(function(e){t._removeUndoStyles(t._getMatchById(e))});var n=this._getMatchById(e.alertId);"replace"===e.action.action&&(n.undo(),this.appliedAlertIds.delete(e.alertId)),this._removeUndoStyles(n),this._undoedAction.set(this._unsafeGetMatchById(e.alertId)),this.pendingAlertAction.set(null)},t.prototype.setFocusedAlert=function(t,e){_.invariant(null!==this._editor,"editor should be mounted");var n=this._highlights.get();this._focusedAlert.set({id:t,source:e}),this._updateHighlights(n,this._highlights.get())},t.prototype.setHighlightedAlert=function(t){_.invariant(null!==this._editor,"editor should be mounted");var e=this._highlights.get();this._highlightedAlert.set(t),this._updateHighlights(e,this._highlights.get())},t.prototype.getPremiumAlerts=function(){return this._premiumMatches.get().map(v.createAlert)},t.prototype._getAlertByPosition=function(t){var e=t.x,n=t.y;return this._visibleAlertsFlattened.get().find(function(t){var r=t.highlightPosition;return r.left<=e&&e<=r.left+r.width&&r.top<=n&&n<=r.top+r.height})||null},t.prototype._getSynonymAlert=function(t){var e=Object.keys(t).find(function(e){return t[e].alert.group===y.AlertGroup.synonym});return e?{id:e}:null},t.prototype.isFocused=function(t){return this.focusedAlert.view(function(e){return e.id===t})},t.prototype.getCurrentSelection=function(){if(!this._editor)throw new _.InvariantError("editor should be mounted");var t=this._editor.getSelection();return t?{start:t.s,end:t.e}:null},t.prototype.setSelection=function(t){if(!this._editor)throw new _.InvariantError("editor should be mounted");this._editor.setCursor({s:t.start,e:t.end})},t.prototype.getUnderlinedHtml=function(){if(!this._editor)throw new _.InvariantError("editor should be mounted");return this._editor.dom.cloneVal.innerHTML},t.prototype.filterViewByTypeOrCategoryOnly=function(t){this._matchFilterState.set({typeOrCategory:t,premium:null})},t.prototype.filterView=function(t){this._matchFilterState.set(t)},t}();e.GrammarlyEditorEngine=x},270:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(23),i=n(230);e.defaultState={visible:!1,title:"",alignment:"auto",targetRect:i.Rect.empty};var o=function(){function t(t){this.state=t}return t.prototype.show=function(t,e,n){void 0===n&&(n="auto"),this.state.set({visible:!0,title:e,alignment:n,targetRect:t})},t.prototype.hide=function(){this.state.set(e.defaultState)},t}();e.TooltipModelImpl=o,e.tooltipContextTypes={tooltip:r.object}},271:function(t,e,n){"use strict";function r(t,e){if(!t)throw new l("string"==typeof e?e:e&&e())}function i(t,e){if(!t)throw new l("string"==typeof e?e:e&&e());return t}function o(t){throw new d(t)}function s(t){if(!u.isObject(t))return!1;var e=t.name,n=t.message;return"FetchError"===e&&n===f||"TypeError"===e&&n===p||"TypeError"===e&&"Failed to fetch"===n}function a(t){return void 0!==t&&(t>=500&&t<=599)}Object.defineProperty(e,"__esModule",{value:!0});var c=n(3),u=n(237);e.CustomError=function(t){void 0===t&&(t="(nomessage)"),Error.call(this,t),this.stack=(new Error).stack,this.message=t,this.name=this.constructor.name},e.CustomError.prototype=Object.create(Error.prototype);var l=function(t){function e(e){return t.call(this,"Invariant condition failed: "+(e||"(unnamed)"))||this}return c.__extends(e,t),e}(e.CustomError);e.InvariantError=l;var h=function(t){function e(e){return t.call(this,e)||this}return c.__extends(e,t),e}(e.CustomError);e.IllegalArgumentError=h;var d=function(t){function e(e){return t.call(this,"Matching not exhaustive"+(e?": unexpected value "+e:""))||this}return c.__extends(e,t),e}(e.CustomError);e.MatchingNotExhaustiveError=d,e.invariant=r,e.expectNonNull=i,e.assertNever=o;var p="NetworkError when attempting to fetch resource.",f="Client fetch error: Failed to fetch";e.isClientFetchError=s,e.isServerErrorCode=a},272:function(t,e,n){"use strict";function r(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 0===t.length?o.Properties.of(e.ls):o.Properties.of.apply(o.Properties,t.map(function(t){return n={},n[t]=e.ls.getItem(t),n;var n}))}function i(t){for(var n=0,r=t.entries();n<r.length;n++){var i=r[n],o=i[0],a=i[1];try{var c=a.getStr();c&&e.ls.setItem(o,c)}catch(t){return void s.Monitoring.Logging.getLogger("model.settings.localStorage").warn("Cannot save data to local storage",t)}}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(42),s=n(4),a=n(6),c=n(35);e.ls=window.localStorage||Object.create({getItem:function(t){return null},setItem:function(t,e){return a.noop},removeItem:function(t){return null}}),e.readProperties=r,e.writeProperties=i;!function(t){function e(t){return{getItem:function(e){return c.Option.of(t.getItem(e))},setItem:function(e,n){return t.setItem(e,n)},safeRemoveItem:function(e){try{t.removeItem(e)}catch(t){}},getKeys:function(){return Object.keys(t)},removeItem:function(e){return t.removeItem(e)}}}t.fromLocalStorage=e}(e.DenaliStorage||(e.DenaliStorage={}))},301:function(t,e){t.exports={spinner:"_51ca9a4d-editor-core-spinner",desktopEditorPreventSelection:"_a3ef96c1-editor-core-desktopEditorPreventSelection"}},385:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(486),n(489).initializeMonitoring();var r=n(15),i=n(389),o=n(455);i.render(r.createElement(o.Main,null),document.getElementById("page"))},386:function(t,e,n){n(690),t.exports=n(1130)},387:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(262);e.defaultReconnect=i.defaultReconnect;var o=n(444);e.CAPIClientImpl=o.CAPIClientImpl,r.__exportStar(n(263),e);var s=n(264);e.DocumentStatistics=s.DocumentStatistics},388:function(t,e,n){"use strict";function r(t,e){var n="prev"===e?t.previousSibling:t.nextSibling;if(!n)return t.parentNode?r(t.parentNode,e):"";var i=n.textContent;return i?" "===i?"prev"===e?r(n,"prev")+" ":" "+r(n,"next"):i:""}function i(t,e){var n=r(t,e);if(!n)return null;var i="prev"===e?n.replace(/\s$/," ").match(/\w+.\w+.?$/):n.replace(/^\s/," ").match(/^.?\w+.\w+/);return null===i?null:i[0]}function o(t){var e=document.querySelector(".gr_"+t.id);return e?[i(e,"prev"),i(e,"next")]:[null,null]}Object.defineProperty(e,"__esModule",{value:!0});var s=n(463);e.Lenses=s.Lenses,e.pnameToLensUnsafe=s.pnameToLensUnsafe,e.pnameToLensProp=s.pnameToLensProp,e.getAlertContext=o},390:function(t,e,n){"use strict";function r(t){var e=t.rawMatch;return d.invariant("synonym"!==e.action,"Do not use `getBasicAlertFields` for synonyms."),{id:e.id.toString(),title:e.title,hidden:e.hidden,category:e.category,pid:e.pid,pname:e.pname,isFree:e.free,highlightText:e.highlightText,range:{start:e.begin,end:e.end},group:p.alertGroupFromString(e.group)}}function i(t){var e=t.rawMatch,n=e.synonyms.token,r=t.value;return{id:t.id,title:n||r,hidden:!1,category:e.category,pid:e.pid,pname:e.pname,isFree:!0,highlightText:"",range:{start:t.begin,end:t.end},group:p.AlertGroup.synonym}}function o(t){var e=t.rawMatch,n=e.extra_properties||{},i=r(t);e.replacements&&e.transforms&&d.invariant(e.replacements.length===e.transforms.length,"every transform should have replacement");var o={kind:"common",details:e.details,explanation:e.explanation,examples:p.parseExamples(e.examples),todo:e.todo,replacements:(e.transforms||[]).map(function(t,n){return p.createReplacement(t,e.replacements[n])}),extraProperties:{hasAddToDictionary:!!n.add_to_dict,isDidYouMean:!!n.did_you_mean,isShowTitle:!!n.show_title,isEnhancement:!!n.enhancement,plagiarismUrl:n.url,sentence:n.sentence,priority:n.priority?parseInt(n.priority,10):0}};return Object.assign(i,o)}function s(t){var e=p.parsePlagiarism(t),n=r(t),i={kind:"plagiarism",title:e.title,description:e.description,url:e.url,reference:e.reference};return Object.assign(n,i)}function a(t){var e=t.rawMatch,n=r(t),i={details:e.details,explanation:e.explanation,examples:p.parseExamples(e.examples),todo:e.todo,kind:"enhancement",replacements:(e.replacements||[]).map(p.createSimpleReplacement),extraProperties:{isEnhancement:!0}};return Object.assign(n,i)}function c(t,e){return void 0===e&&(e=""),t&&""!==t&&""!==e&&(t.includes(e)||e.includes(t))}function u(t){var e=h.Monitoring.Logging.getLogger("grammarly_editor_alert.synonyms"),n=h.Monitoring.TimeSeries.root.getMetric("grammarly_editor_alert"),r=t.rawMatch,o=r.synonyms,s=o.token,a=o.meanings,u=t.value,l=t.badSyn,d=i(t);return l?(e.warn("Synonym error: cannot_find_synonym",{expected:t.value}),n.getCounter("synonyms.error.cannot_find_synonym").increment()):s&&s!==u?n.getCounter("synonyms.error.syn_for_wrong_token").increment():s?n.getCounter("synonyms.success").increment():n.getCounter("synonyms.error.token_missing").increment(),s&&s!==u?(e.warn(c(s,u)?"Got synonym for similar word":"Got synonym for wrong token",{expected:u,got:s}),Object.assign(d,{kind:"synonym",title:u,meanings:[],replacements:[]})):Object.assign(d,{kind:"synonym",match:t,meanings:a.map(function(t){return{title:t.meaning,replacements:t.synonyms.map(function(t){return p.createSimpleReplacement(t.derived)})}}),replacements:(r.replacements||[]).map(p.createSimpleReplacement)})}function l(t){var e=t.rawMatch;if(!e.group&&"synonyms"===e.action)return u(t);switch(p.alertGroupFromString(t.rawMatch.group)){case p.AlertGroup.plagiarism:return s(t);case p.AlertGroup.enhancement:return a(t);default:return o(t)}}Object.defineProperty(e,"__esModule",{value:!0});var h=n(4),d=n(6),p=n(76);e.getBasicAlertFields=r,e.getSynonymBasicAlertFields=i,e.isTokensSimilar=c,e.createAlert=l},391:function(t,e,n){"use strict";function r(t,e){return{re:new RegExp("^("+t+")([\\s\\S]*)$"),createResult:e}}function i(t){for(var e=[],n=t,r=!1,i=0,o=void 0;n.length>0;){var s=function(t){for(var e=0,n=c;e<n.length;e++){var r=n[e],i=t.match(r.re);if(null!==i)return[r.createResult(i),i[i.length-1]]}}(n);void 0===s&&(r=!0);var u=s||function(e){var n=["<span class='gr_grammar_del'>","<span class='gr_grammar_ins'>","→"].map(function(t){return e.indexOf(t)});if(n.findIndex(function(t){return 0===t})>0)throw new Error("Couldn't parse transform: "+t);if(n=n.filter(function(t){return t>0}),n.length>0){var r=Math.min.apply(Math,n);return[{type:"text",text:e.substring(0,r)},e.substring(r)]}return[{type:"text",text:e},""]}(n),l=u[0],h=u[1];o&&"text"===o.type&&"text"===l.type?o.text+=l.text:(o&&"delete"===o.type&&"insert"===l.type&&(e.push({type:"arrow"}),i++),e.push(l)),"arrow"===l.type&&i++,o=e[e.length-1],n=h}return(r||0===e.length||i>1)&&a.Monitoring.Logging.getLogger("model.editor.alert_replacement").warn("Bad parsing of transform",{transformHtml:t,transformPartCount:e.length,arrowCount:i}),e}function o(t,e){return{newText:e,transform:i(t)}}function s(t){return{newText:t,transform:[{type:"insert",text:t}]}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(4),c=[r("(?:\\<span class='gr_grammar_del'\\>([\\S\\s]*?)\\</span\\>)",function(t){return{type:"delete",text:t[2]}}),r("(?:\\<span class='gr_grammar_ins'\\>([\\S\\s]*?)\\</span\\>)",function(t){return{type:"insert",text:t[2]}}),r("(→)",function(t){return{type:"arrow"}}),r("([^<>→]+)",function(t){return{type:"text",text:t[1]}})];e.parseTransformHtml=i,e.createReplacement=o,e.createSimpleReplacement=s},393:function(t,e,n){"use strict";function r(t){switch(t){case"office-addin":return"officeAddin";case"desktop-mac":return"macApp";case"desktop-windows":return"winApp";case"chrome-extension":return"chromeExt";case"firefox-extension":return"firefoxExt";case"safari-extension":return"safariExt";case"edge-extension":return"edgeExt";case"referral":return"referral";case"no-referral":return"no-referral";case"campaign-end":return"campaignEnd";case"proofit-cancelled":return"proofitCancel";case"proofit-completed":return"proofitComplete";default:return i.assertNever(t)}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(6),o=n(129),s=n(105);e.defaultState={active:null},e.bannerToTracking=r;var a=function(){function t(t,e,n,r,i,o){this._state=t,this._browser=e,this._os=n,this._extension=r,this._telemetry=i,this._showEdgeExtension=o,this.state=this._state.view()}return t.prototype.initialize=function(t,e,n){this._settings=n,this._banners=t;var r=t.later,i=r.filter(function(t){return Date.now()<=t.expire});i.length!==r.length&&this._updateBanners({later:i});var o=this._getActiveBanner(e);this._state.set({active:o}),o&&this._shown(o)},t.prototype._notHidden=function(t){return this._banners.dismiss.concat(this._banners.later.map(function(t){return t.type})).indexOf(t)<0},t.prototype._showInProd=function(){return"edge"!==this._browser||this._showEdgeExtension&&this._showEdgeExtension.enabled},t.prototype._getExtensionBanner=function(){var t=this._browser+"-extension";return!o.isExtensionInstalled()&&this._notHidden(t)&&o.isBrowserHasExtension(this._browser)&&this._showInProd()?t:null},t.prototype._getDesktopBanner=function(t){if("mac"!==this._os&&"windows"!==this._os)return null;var e="desktop-"+this._os;return!t.has(s.UserGroups.DESKTOP_EDITOR_INSTALLED)&&this._notHidden(e)?e:null},t.prototype._getOfficeAddinBanner=function(t){if("windows"!==this._os)return null;var e="office-addin",n=this._banners.shown.indexOf(e)>-1;return o.isAddinInstalled(t)||n||!this._notHidden(e)?null:e},t.prototype._getActiveBanner=function(t){var e=this._getExtensionBanner(),n=this._getDesktopBanner(t),r=this._getOfficeAddinBanner(t);return e||n||r||null},t.prototype._updateBanners=function(t){this._banners=Object.assign({},this._banners,t),this._settings&&this._settings.updateBanners(this._banners)},t.prototype._shown=function(t){var e=this._banners.shown;e.indexOf(t)>-1||(e.push(t),this._updateBanners({shown:e}))},t.prototype.remind=function(t){var e=this._banners.later;e.push({type:t,expire:Date.now()+864e5}),this._updateBanners({later:e}),this._state.set({active:null})},t.prototype.dismiss=function(t){var e=this._banners.dismiss;e.push(t),this._updateBanners({dismiss:e}),this._state.set({active:null})},t.prototype.cancel=function(t){this._state.set({active:null})},t.prototype._isExtension=function(t){return["chrome-extension","firefox-extension","safari-extension","edge-extension"].indexOf(t)>-1},t.prototype.install=function(t,e){var n=this;this._isExtension(t)?(this._telemetry.bannerActionClicked(r(t),e),this._extension.install().then(function(t){return t&&n._state.set({active:null})})):this._state.set({active:null})},t}();e.BannersModelImpl=a},394:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(233),i=function(){function t(t,e,n,i,o,s,a,c){this.title=t,this.todo=e,this.replacements=n,this.isActive=i,this.isApplied=o,this.extraProperties=s,this.isVisibleQuickReplacement=a,this.onReplace=c,this.isDidYouMean=!!this.extraProperties.isDidYouMean,this.hasAddToDictionary=!!this.extraProperties.hasAddToDictionary,this.isEmptyReplacement=r.isNoReplacement(this.replacements),this.replacement=r.getReplacementModel({isDidYouMean:this.isDidYouMean,isActive:this.isActive,replacements:this.replacements,todo:this.todo,onReplace:this.onReplace}),this.isLongReplacement=this.replacement.template===r.CardReplacementTemplate.long,this.isReplacementUnderTitle=this.isLongReplacement||this.replacement.template===r.CardReplacementTemplate.didYouMean,this.isHighlightTextLabel=!this.isVisibleQuickReplacement,this.isShowTextTitle=this.isEmptyReplacement||this.extraProperties.isShowTitle||this.isReplacementUnderTitle||!this.isVisibleQuickReplacement}return t}();e.CommonHeaderModelImpl=i;var o=function(){function t(t,e,n,r){this.title=t,this.isActive=e,this.isApplied=n,this._url=r,this.plagiarism={url:this._url,urlTitle:this._url.map(function(t){return t.replace(/https?:\/\//,"")}),title:this.title}}return t}();e.PlagiarismHeaderModelImpl=o;var s=function(){function t(t,e,n,r){this.title=t,this.isActive=e,this.isApplied=n,this.isVisibleQuickReplacement=r,this.isHighlightTextLabel=!this.isVisibleQuickReplacement}return t}();e.EnhancementHeaderModelImpl=s},395:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6),i=n(24);e.TIMEOUT=1e4,e.successResult=function(t,e){return{status:"success",result:t,time:e?Date.now()-e:void 0}},e.failedResult=function(t,e){return{status:"failed",result:t,time:e?Date.now()-e:void 0}},e.timeoutMessage="Failed by timeout",e.timeoutLimit=function(t){return r.delay(t).then(function(){throw new i.TimeoutError})}},396:function(t,e,n){"use strict";function r(t,e){return{dangerouslySetInnerHTML:{__html:u.sanitize(t,e)}}}function i(t){return function(e){e.stopPropagation(),t&&t(e)}}function o(t){return function(e){e.preventDefault(),t&&t(e)}}function s(t,e){return void 0===e&&(e="px"),{MsTransform:"translateY("+t+e+")",WebkitTransform:"translateY("+t+e+")",MozTransform:"translateY("+t+e+")",OTransform:"translateY("+t+e+")",transform:"translateY("+t+e+")"}}function a(t,e,n){return void 0===n&&(n="px"),{MsTransform:"translate("+t+n+", "+e+n+")",WebkitTransform:"translate("+t+n+", "+e+n+")",MozTransform:"translate("+t+n+", "+e+n+")",OTransform:"translate("+t+n+", "+e+n+")",transform:"translate("+t+n+", "+e+n+")"}}function c(t,e){return function(n){n.propertyName===t&&e(n)}}Object.defineProperty(e,"__esModule",{value:!0});var u=n(123);e.setInnerHTML=r,e.stopPropagation=i,e.preventDefault=o,e.translateY=s,e.translate=a,e.waitTransition=c},397:function(t,e,n){"use strict";function r(t){switch(t){case i.officeAddin:return"officeAddin";case i.desktopMac:return"macApp";case i.desktopWindows:return"winApp";case i.extensionChrome:return"chromeExt";case i.extensionFirefox:return"firefoxExt";case i.extensionSafari:return"safariExt";case i.extensionEdge:return"edgeExt";default:return o.assertNever(t)}}Object.defineProperty(e,"__esModule",{value:!0});var i,o=n(6),s=n(129),a=n(105);!function(t){t[t.officeAddin=0]="officeAddin",t[t.desktopMac=1]="desktopMac",t[t.desktopWindows=2]="desktopWindows",t[t.extensionChrome=3]="extensionChrome",t[t.extensionFirefox=4]="extensionFirefox",t[t.extensionSafari=5]="extensionSafari",t[t.extensionEdge=6]="extensionEdge"}(i=e.Apps||(e.Apps={}));var c=function(t,e,n,r,c){var u=[];if(!t.size)return u;var l;if(s.isBrowserHasExtension(n))switch(n){case"chrome":l=i.extensionChrome;break;case"firefox":l=i.extensionFirefox;break;case"safari":l=i.extensionSafari;break;case"edge":l=c?i.extensionEdge:void 0}else l=void 0;if(l&&u.push({app:l,installed:s.isExtensionInstalled()}),r&&("windows"===e&&u.push({app:i.officeAddin,installed:o.Extension.isAddinInstalled(t)}),"windows"===e||"mac"===e)){var h="windows"===e?i.desktopWindows:i.desktopMac;u.push({app:h,installed:t.has(a.UserGroups.DESKTOP_EDITOR_INSTALLED)})}return u},u=function(){function t(t,e,n,r,i,o){this._browser=t,this._os=e,this._extension=n,this._showDesktopApps=r,this._telemetry=i,this._showEdgeExtension=o}return t.prototype.getAppsItems=function(t){return c(t,this._os,this._browser,this._showDesktopApps.get().enabled,this._showEdgeExtension.enabled)},t.prototype.onInstallClicked=function(t){[i.extensionChrome,i.extensionFirefox,i.extensionSafari,i.extensionEdge].indexOf(t)>-1&&this._extension.install(),this._telemetry.installAppClicked(r(t))},t.prototype.onMoreClicked=function(t){this._telemetry.learnMoreClicked(r(t))},t}();e.AppsModelImpl=u},398:function(t,e,n){"use strict";function r(t,e){return t.reduce(function(t,n){return e(n)?t[0].push(n):t[1].push(n),t},[[],[]])}function i(t,e,n){if(n>=t.length||e>=t.length)return t;for(var r=new Set,i=Math.floor(e+n>e?Math.random()*(n-e)+1:0);r.size<i;){var o=Math.floor(Math.random()*t.length);r.add(o)}return Array.from(r).map(function(e){return t[e]})}function o(t){for(var e=t.slice(0),n=e.length;n>0;){var r=Math.floor(Math.random()*n);n--,i=[e[r],e[n]],e[n]=i[0],e[r]=i[1]}return e;var i}function s(t,e){for(var n=-1,r=t.length;n+1!==r;){var i=n+(r-n>>1);e(t[i])?n=i:r=i}return n+1}function a(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.sort(function(t,n){return e.reduce(function(e,r){return 0!==e?e:r(t,n)},0)})}function c(t,e,n){for(var r=e;r<t.length;++r)if(n(t[r]))return d.Some({index:r,value:t[r]});return d.None}function u(t,e,n){for(var r=e;r>=0;--r)if(n(t[r]))return d.Some({index:r,value:t[r]});return d.None}function l(t,e,n){return e<0||t.length<=e?d.None:c(t,e+1,n).orElseL(function(){return u(t,e-1,n)})}function h(t,e){for(var n,r=0;r<t.length;++r)!function(r){var i=e.findIndex(function(e){return t[r].equals(e)});-1!==i&&(t.splice(r--,1),e.splice(i,1)),n=r}(r),r=n;return t}Object.defineProperty(e,"__esModule",{value:!0});var d=n(35);e.partition=r,e.pickRandom=i,e.shuffle=o,e.lowerBound=s,e.sort=a,e.findIndexFrom=c,e.findLastIndexFrom=u,e.lookAround=l,e.arraySubstract=h},399:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(10),o=n(15),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.unsubscribe=function(){this.props.onUnmount?this.props.onUnmount(this.subscription):this.subscription&&this.subscription.unsubscribe()},e.prototype.componentDidMount=function(){this.props.onMount&&(this.subscription=this.props.onMount())},e.prototype.componentDidUpdate=function(){this.props.remountOnUpdate&&this.props.onMount&&(this.unsubscribe(),this.subscription=this.props.onMount())},e.prototype.componentWillUnmount=function(){this.unsubscribe()},e.prototype.render=function(){var t=this.props,e=t.children,n=t.className;return e&&e.length>1||n?o.createElement(i.F.div,{className:n},e):o.Children.only(this.props.children)},e}(o.Component);e.Lifecycle=s},400:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.appConfig={env:"prod",logLevel:"INFO",collectCrashLogs:!0,copyLogsToConsole:!1,enableTracking:!0,alertCachePrefix:"editorTsAlertCache",alertCacheVersion:"2",userSettingsPrefix:"userSettings",userSettingsVersion:"1",selfUpdate:{versionCheckInterval:216e5,latestVersionDelay:864e5,forceUpdateOnHiddenDelay:3e5,retryFailedVersionCheckInterval:3e5,retryFailedVersionCheckLimit:20,versionFilePath:"/version.json"},domains:{cookie:".grammarly.com",localServer:"denali-local.grammarly.com"},api:{authUrl:"https://auth.grammarly.com/v3",institutionUrl:"https://institution.grammarly.com",dapiUrl:"https://data.grammarly.com",doxUrl:"https://dox.grammarly.com",doxWsUrl:"wss://dox.grammarly.com",irbisUrl:"https://irbis.grammarly.com",subscriptionUrl:"https://subscription.grammarly.com/api/v1",capiWsUrl:"wss://capi.grammarly.com/freews",capiApiUrl:"https://capi.grammarly.com/api",gnarApi:{url:"https://gnar.grammarly.com"},pdfGeneratorUrl:"https://dox.grammarly.com/docproc/html2pdf",felogUrl:"https://f-log-editor.grammarly.io",crashLogUrl:"https://f-log-editor.grammarly.io/crash",onlineTestUrl:"/online-test.json",wsTest:"wss://wstest.grammarly.com",proofitResultUrl:"https://dox.grammarly.com/documents/_docId_/proofread"},app:{name:"editor"},urls:{free:"/free"},funnel:{resetPassword:"https://www.grammarly.com/resetpassword",accountDeleted:"https://www.grammarly.com/account-deleted",subscribe:"https://www.grammarly.com/subscribe",upgrade:"https://www.grammarly.com/upgrade",signin:"https://www.grammarly.com/signin",signup:"https://www.grammarly.com/signup",mainPage:"https://www.grammarly.com/"},officeAddin:{installURL:"http://download-office.grammarly.com/latest/GrammarlyAddInSetup.exe",infoURL:"http://www.grammarly.com/office-addin/windows"},desktop:{windows:{installURL:"http://download-editor.grammarly.com/windows/GrammarlySetup.exe",infoURL:"https://www.grammarly.com/native/windows"},mac:{installURL:"http://download-editor.grammarly.com/osx/Grammarly.dmg",infoURL:"https://www.grammarly.com/native/mac"}},extension:{chrome:{installURL:"https://chrome.google.com/webstore/detail/kbfnbcaeplbcioakkpcpgfkobkghlhen",infoURL:"https://chrome.google.com/webstore/detail/grammarly-spell-checker-g/kbfnbcaeplbcioakkpcpgfkobkghlhen?hl=en"},firefox:{installURL:"https://addons.mozilla.org/firefox/downloads/latest/566314/addon-566314-latest.xpi",iconURL:"https://addons.cdn.mozilla.net/user-media/addon_icons/566/566314-32.png",infoURL:"https://addons.mozilla.org/en-US/firefox/addon/grammarly-1/"},safari:{installURL:"https://safari-extensions.apple.com/details/?id=com.grammarly.spellchecker.extension-W8F64X92K3"},edge:{installURL:"ms-windows-store://pdp?ProductId=9p59wxtbhzzm",infoURL:"https://www.microsoft.com/en-us/store/p/grammarly-for-microsoft-edge/9p59wxtbhzzm?rtc=1"}},edu:{adminPanelURL:"https://admin-panel.grammarly.com"},support:{login:"https://support.grammarly.com/login",email:"support@grammarly.com",mainPage:"https://support.grammarly.com/",newRequest:"https://support.grammarly.com/hc/en-us/requests/new",contact:"https://www.grammarly.com/contact",connectionTroubleshooting:"https://support.grammarly.com/hc/en-us/articles/115000090271-Network-configuration-blocks-Grammarly-services",emailExistsKBUrl:"https://support.grammarly.com/hc/en-us/articles/115000090791-Changing-your-email-to-an-email-that-already-exists",phoenixSupportUrl:"https://ecampus.phoenix.edu/common/contactus/reportProblem.jsp",phoenixWritingHelpUrl:"https://portal.phoenix.edu/social/community/support/writing",diagnosticTestPath:"/diagnostic-test?origin=editor",documentAcceptTrackedChanges:"https://support.office.com/en-us/article/Accept-tracked-changes-4838d24c-d5d1-4c6c-8e39-78b44bd2b4cc"},privacyPolicy:"https://www.grammarly.com/privacy-policy",termsOfServise:"https://www.grammarly.com/terms"},e.buildInfo={}},401:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(53),o=n(104),s=function(){function t(t,e){void 0===e&&(e=0),this._operations=t,this._rev=e}return t.prototype.withRevision=function(e){return new t(this._operations,e)},Object.defineProperty(t.prototype,"revision",{get:function(){return this._rev},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"operations",{get:function(){return this._operations},enumerable:!0,configurable:!0}),t.prototype.apply=function(t){return this.operations.reduce(function(t,e){return e.apply(t)},t)},t.prototype.sequencify=function(){return this},t.prototype.transformAgainst=function(e){var n=this;if(e instanceof t){var r=[],i=e;return i=i.sequencify(),this._operations.forEach(function(t){var e=[t];i._operations.forEach(function(t){e=e.map(function(e){return e.transformAgainst(t,n._rev,i._rev)}).reduce(function(t,e){return t.concat(e)},[])}),r=r.concat(e)}),new t(r,this._rev)}throw new Error("Should be transformed only against OperationSet")},t.prototype.pack=function(t){var e=this;return this.operations.map(function(n){return n.pack(t||e._rev)})},t.unpack=function(e){if(!Array.isArray(e))throw new Error("Illegal argument. Should be string[]");if(0===e.length)return new t([]);var n=e.filter(function(t){return!t.startsWith("=")}).map(function(t){var e=t.substr(0,1),n=t.substr(1).split(":"),i=n[0],s=n[1],a=n[2],c=n[3];return r=parseInt(c,36),new o.Operation(e,parseInt(i,36),a.replace(/%3A/gi,":").replace(/%25/g,"%"),parseInt(s,36))}),r=0;return new t(n,r)},t.prototype.toString=function(){return this._operations.toString()},t}();e.OperationSet=s;var a=function(t){function e(e){void 0===e&&(e="Unknown reason");var n=t.call(this,e)||this;return n.name="OTError",n.reason=e,n}return r.__extends(e,t),e}(i.CustomError);e.OTError=a;var c=function(t){function e(e){void 0===e&&(e="removed");var n=t.call(this,e)||this;return n.name="OTRemoveError",n}return r.__extends(e,t),e}(a);e.OTRemoveError=c;var u=function(){function t(t,e,n){void 0===e&&(e=function(){}),void 0===n&&(n=function(){}),this.cs=t,this.successCallback=e,this.failureCallback=n}return Object.defineProperty(t.prototype,"operations",{get:function(){return this.cs.operations},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"revision",{get:function(){return this.cs.revision},enumerable:!0,configurable:!0}),t.prototype.apply=function(t){return this.cs.apply(t)},t.prototype.pack=function(){return this.cs.pack()},t}();e.Revision=u;var l=function(){function t(t){void 0===t&&(t=0),this._operations=[],this._staging=!1,this._revision=t}return Object.defineProperty(t.prototype,"revision",{get:function(){return this._revision},enumerable:!0,configurable:!0}),t.prototype.push=function(t,e,n){this.pushAll([t],e,n)},t.prototype.pushAll=function(t,e,n){var r=new u(new s(t,++this._revision),e,n);this._operations.push(r)},t.prototype.incRevision=function(){this._revision++},t.prototype.clear=function(t,e){void 0===e&&(e=0);var n="string"==typeof t?t:t.message;this._operations.forEach(function(t){return t.failureCallback(new a(n))}),this._operations=[],this._revision=e,this._staging=!1},t.prototype.acknowledge=function(t){if(this._staging){this._staging=!1;var e=this._operations.shift();e&&e.successCallback(t)}},t.prototype.forEach=function(t){this._operations.forEach(function(e){return t(e.cs)})},t.prototype.remove=function(){var t=this._operations.shift();return t&&(this._staging=!1,t.failureCallback(new c)),void 0!==t},t.prototype.poll=function(){var t=this._operations.slice(0,1);return 0===t.length?null:(this._staging=!0,t[0])},t.prototype.pop=function(){var t=this._operations.shift();return void 0===t?null:t},t.prototype.popAll=function(){if(this.isStaging)throw new Error("Invalid state");var t=this._operations;return this._operations=[],t},t.prototype.reload=function(t,e){if(this._staging){var n=this._operations.slice(0,1);if(0!==n.length){try{var r=n[0];e=new s(r.operations,t._revision).apply(e),t.pushAll(r.operations,r.successCallback,r.failureCallback),t._staging=!0}catch(t){}this.remove()}}try{for(var i=e,o=0,c=this._operations;o<c.length;o++){var u=c[o];i=new s(u.operations,t._revision).apply(i)}e=i;for(var l=0,h=this._operations;l<h.length;l++){var u=h[l];t.pushAll(u.operations,u.successCallback,u.failureCallback)}}catch(t){for(var d=0,p=this._operations;d<p.length;d++){var u=p[d];u.failureCallback(new a("cannot be applied"))}}return e},Object.defineProperty(t.prototype,"length",{get:function(){return this._operations.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isStaging",{get:function(){return this._staging},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this._operations.length},enumerable:!0,configurable:!0}),t.prototype.transformAgainst=function(t,e){void 0===e&&(e=t.revision);var n=e+1;return this._operations=this._operations.map(function(e){var r=new s(e.operations,n),i=t.transformAgainst(r),o=r.transformAgainst(t);return t=i,new u(new s(o.operations,o.revision),e.successCallback,e.failureCallback)}),this._revision=this.isEmpty?e:this._operations[this.length-1].revision,t.withRevision(t.revision)},t.prototype.getChangesSince=function(t){return this._operations.filter(function(e){return e.revision>t}).map(function(t){return new s(t.operations,t.revision)})},t}();e.OperationQueue=l},402:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(24),o=n(10),s=n(4),a=n(161);e.defaultState={items:[],importantItems:[]};var c=function(){function t(t,e){var n=this;this._state=t,this.create=new a.Notifications.EditorNotificationFactory,this._queue=this._state.lens(function(t){return t.items}),this._importantQueue=this._state.lens(function(t){return t.importantItems}),this.items=o.Atom.combine(this._queue,this._importantQueue,function(t,e){return e.length?[e[0]]:t.slice(0,3)}),this._notificationsSubs=new Map,this._nextId=function(){var t=1;return function(){return t++}}(),this.items.pairwise().subscribe(function(t){var e=t[0],r=t[1];e.filter(function(t){return-1===r.indexOf(t)}).forEach(function(t){return n._extract(t.id)}),r.filter(function(t){return-1===e.indexOf(t)}).forEach(function(t){return n._put(t)})}),e.subscribe(function(t){return n.cleanup()})}return t.prototype.show=function(t){var e=this._nextId(),n=r.__assign({},t,{id:e});return(n.important?this._importantQueue:this._queue).modify(function(t){return t.concat([n])}),e},t.prototype.showMessage=function(t){return this.show(this.create.generic(t))},t.prototype.showError=function(t){return this.show(this.create.error(t))},t.prototype.hide=function(t){this._hideNotification(t)},t.prototype.expire=function(t){this._hideNotification(t)},t.prototype.cleanup=function(){this._queue.modify(this._cleanup)},t.prototype._cleanup=function(t){return t.filter(function(t){return t.dontRemoveOnAnyAction||t.important})},t.prototype._hideNotification=function(t){this._queue.modify(function(e){return e.filter(function(e){return e.id!==t})}),this._importantQueue.modify(function(e){return e.filter(function(e){return e.id!==t})})},t.prototype._put=function(t){var e=this;s.Monitoring.Logging.getLogger("notifications").log("error"===t.type?s.Logging.LogLevel.WARN:s.Logging.LogLevel.INFO,"Notification shown: "+t.type,s.EventProps.fromAny(t)),t.showTimeMs===1/0||t.important||this._notificationsSubs.set(t.id,i.Observable.interval(t.showTimeMs||7e3).take(1).subscribe(function(){e.hide(t.id)}))},t.prototype._extract=function(t){this._notificationsSubs.has(t)&&(this._notificationsSubs.get(t).unsubscribe(),this._notificationsSubs.delete(t))},t}();e.DenaliNotificationsModelImpl=c},403:function(t,e,n){"use strict";function r(t,e){return e?Math.max(t,e+u):t}function i(t){return Object.keys(t).map(function(e){return t[e]}).sort(function(t,e){return t.alert.highlightPosition.top-e.alert.highlightPosition.top||t.alert.highlightPosition.left-e.alert.highlightPosition.left||t.alert.highlightPosition.bottom-e.alert.highlightPosition.bottom||t.alert.highlightPosition.right-e.alert.highlightPosition.right||(t.alert.alert.id<e.alert.alert.id?-1:1)}).reduce(function(e,n,i,o){var s=o[i-1]&&o[i-1].alert.alert.id,a=i>0?e[s].top:0,c=i>0?t[s].cardHeight:0;return e[n.alert.alert.id]={top:r(n.alert.highlightPosition.top,a+c),height:n.cardHeight,alert:n.alert},e},{})}function o(t,e){var n={top:t.top+1,height:t.height,left:t.left-60,width:t.width};return{left:{top:e.top,left:e.left,width:e.width,height:e.height-4},right:n}}function s(t,e){return t-e+d}function a(t,e,n,r){var i=t+e+l-(n+r),o=t-h-r;return i<=0&&o>=0?0+r:o<0?o+r:(i>o?o:i)+r}function c(t,n,r,i,o){if(!n.id)return e.emptyLayout;var c=t[n.id];if(!c)return e.emptyLayout;var u="click"===n.source,l=u?a(c.top+r,c.height,i,o):void 0,h=s(c.top,c.alert.highlightPosition.top),d=u?[h,0]:[0,-h];return{scroll:l,textShift:d[0],cardsShift:d[1]}}Object.defineProperty(e,"__esModule",{value:!0});var u=8;e.getCardsPositions=i,e.calculateGuideLayout=o;var l=35,h=20,d=18;e.emptyLayout={scroll:0,textShift:0,cardsShift:0},e.getScrollToFitCard=a,e.calculateEditorLayout=c},42:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(387);e.CAPI=r;var i=n(446);e.Dapi=i.Dapi,e.Properties=i.Properties;var o=n(443);e.Auth=o.Auth;var s=n(450);e.Irbis=s.Irbis;var a=n(68);e.Ajax=a.Ajax,e.Request=a.Request,e.RequestBuilder=a.RequestBuilder,e.HTTPError=a.HTTPError;var c=n(166);e.WSError=c.WSError;var u=n(167);e.OTError=u.OTError,e.OTRemoveError=u.OTRemoveError;var l=n(104);e.Change=l.Change;var h=n(53);e.CustomError=h.CustomError;var d=n(241);e.Proofit=d.Proofit,e.TurnaroundType=d.TurnaroundType,e.ProofitJobStatus=d.ProofitJobStatus;var p=n(240);e.Dox=p.Dox,e.Document=p.Document,e.Remote=p.Remote,e.RemoteDocument=p.RemoteDocument,e.RemoteDocumentsList=p.RemoteDocumentsList,e.OrderBy=p.OrderBy,e.SearchRequest=p.SearchRequest,e.CreateRequest=p.CreateRequest,e.DoxErrorCodes=p.DoxErrorCodes,e.DoxAjaxErrorCodes=p.DoxAjaxErrorCodes;var f=n(238);e.DocumentContext=f.DocumentContext,e.genreToDomain=f.genreToDomain,e.domainToGenre=f.domainToGenre;var _=n(447);e.Dictionary=_.Dictionary;var g=n(449);e.Institution=g.Institution},43:function(t,e,n){"use strict";function r(t){if(t){var e=t.match(/^Grammarly\s+Desktop\s+Editor\s(.*\s)?(\d+\.\d+\.\d+).*-(osx|windows)$/);if(e){var n=parseFloat(e[2]);return{browser:"desktop-editor",version:isNaN(n)?0:n,os:"osx"===e[3]?"mac":"windows",type:"desktop",supported:function(){return!1}}}}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(248);e.getBrowserInfo=function(){return r(navigator.userAgent)||i()},e.isDesktopEditor=function(t){return"desktop-editor"===t},e.isDownloadAttrSupported="chrome"===e.getBrowserInfo().browser,e.hotkeyLabel=function(t,e){return("mac"===e||"ios"===e?"⌘":"Ctrl+")+t},e.isMac=function(t){return"mac"===t||"ios"===t}},440:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(23);!function(t){t.empty={hovered:void 0,disabled:void 0,active:void 0},t.HoveredContextTypes={hovered:r.object},t.DisabledContextTypes={disabled:r.object},t.ActiveContextTypes={active:r.object},t.contextTypes=Object.assign({},t.HoveredContextTypes,t.DisabledContextTypes,t.ActiveContextTypes)}(e.ElementState||(e.ElementState={}))},441:function(t,e,n){"use strict";function r(t,e){var n=o.Atom.create(l.defaultState);a.Monitoring.Logging.root.debug("Constructing model for "+t.env+" on the client");var r=t.enableTracking?i(t,h.RxFetch.withTargetTag(h.RxFetch.request,"gnar")):new u.DummyGnarClient;return r.getContainerId().then(function(t){return a.Monitoring.Logging.root.context.add({containerId:t})}).catch(function(t){return a.Monitoring.Logging.root.debug("cant get containerId",t)}),new l.AppModelImpl(n,new s.Auth(t.api.authUrl,h.RxFetch.request),new s.Institution(t.api.institutionUrl,h.RxFetch.request),new s.Dapi(t.api.dapiUrl,h.RxFetch.request),d.getBrowserInfo(),new s.Dictionary(t.api.capiApiUrl,h.RxFetch.request),new s.Irbis(t.api.irbisUrl,t.api.subscriptionUrl,h.RxFetch.request),new s.Dox(t.api.doxUrl,h.RxFetch.request),new u.EditorTelemetry(r),t,function(){return r.getContainerId()},e)}function i(t,e){var n=t.api.gnarApi.url,r=t.domains.cookie,i=new c.ContainerIdManager(new c.CookieStorage(r),[new c.LocalStorage,new c.MemoryStorage],a.Monitoring.Logging.root.getLogger("gnar.containerIdManager"),a.Monitoring.TimeSeries.root.getMetric("gnar.containerIdManager"));return new c.GnarClientImpl(n,t.app.name,p.buildInfo.version,e,i,a.Monitoring.Logging.root.getLogger("gnar"),a.Monitoring.TimeSeries.root.getMetric("gnar"))}Object.defineProperty(e,"__esModule",{value:!0});var o=n(10),s=n(42),a=n(4),c=n(433),u=n(163),l=n(161),h=n(160),d=n(43),p=n(89);e.defaultModel=r},442:function(t,e,n){"use strict";function r(t,e){return i(i({},t),e)}function i(t,e){for(var n in e){var r=t[n]||{},o=e[n];null!=o&&null!=r&&o.constructor===Object&&r.constructor===Object?t[n]=i(r,o):t[n]=o}return t}Object.defineProperty(e,"__esModule",{value:!0}),e.merge=r},443:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(68),i=function(){function t(t,e,n){this._url=t,this._fetch=e,this._token=n,this._ajax=r.Ajax.factory(this._fetch,"auth")}return t.prototype._setToken=function(t){this._token=t},t.prototype.orAnonymous=function(t){var e=r.RequestBuilder.get(this._url,"user/oranonymous").queryParam("app",t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build())},t.prototype.signup=function(t,e,n,i){return void 0===i&&(i=!1),this._ajax(r.RequestBuilder.post(this._url,"/signup").formParam("name",t).formParam("email",e).formParam("password",n).formParam("test",i.toString()).build())},t.prototype.login=function(t,e){return this._ajax(r.RequestBuilder.post(this._url,"/login").formParam("email",t).formParam("password",e).build())},t.prototype.logout=function(){return this._ajax(r.Request.post(this._url,"/logout"),r.Ajax.toVoid)},t.prototype.changeName=function(t){var e=r.RequestBuilder.post(this._url,"/user").json({name:t});return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),r.Ajax.toVoid)},t.prototype.changeEmail=function(t,e){var n=r.RequestBuilder.post(this._url,"/user/email/change").json({newEmail:t,password:e});return this._token&&n.cookie("grauth",this._token),this._ajax(n.build(),r.Ajax.toVoid)},t.prototype.changePassword=function(t,e,n){var i=r.RequestBuilder.post(this._url,"/user/password/change").formParam("email",t).formParam("new_pwd",n).formParam("old_pwd",e).build();return this._ajax(i,r.Ajax.toVoid)},t.prototype.getUser=function(t){var e=r.RequestBuilder.get(this._url,"user").queryParam("app",t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build())},t.prototype.getSettings=function(){var t=r.RequestBuilder.get(this._url,"/user/settings");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build())},t.prototype._setSettings=function(t){var e=r.RequestBuilder.post(this._url,"/user/settings").json(t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build())},t.prototype.setSettings=function(t){var e=this;return this.getSettings().then(function(n){return e._setSettings(Object.assign({},n,t))})},t.prototype.enableSandbox=function(t){var e=r.RequestBuilder.put(this._url,"user").json({id:t,customFields:{"sandbox.payments":"Yes"}});return this._ajax(e.build(),r.Ajax.toVoid)},t.prototype.addInstitution=function(t,e){var n=r.RequestBuilder.put(this._url,"user").json({id:t,institutionId:e});return this._ajax(n.build(),r.Ajax.toVoid)},t}();e.Auth=i},444:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=n(3),o=n(263),s=n(4),a=n(401),c=n(104),u=n(127),l=n(166),h=n(445),d=n(264),p=n(53),f=n(35),_=n(262),g=n(6),m=n(42);!function(t){t[t.DISCONNECTED=0]="DISCONNECTED",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.STARTED=3]="STARTED",t[t.ANY=4]="ANY",t[t.CLOSED=5]="CLOSED"}(r||(r={}));var y;!function(t){t[t.CONNECT=0]="CONNECT",t[t.CONNECTED=1]="CONNECTED",t[t.DISCONNECT=2]="DISCONNECT",t[t.START=3]="START",t[t.CLOSE=4]="CLOSE"}(y||(y={}));var v=function(){function t(t){var e=t.url,n=t.handler,i=t.context,o=void 0===i?m.DocumentContext.empty:i,c=t.dialect,h=void 0===c?"undefined":c,d=t.client,v=void 0===d?"web":d,b=t.clientVersion,w=void 0===b?"":b,E=t.extDomain,S=void 0===E?"":E,C=t.sendDelay,x=void 0===C?1e3:C,T=t.docid,A=void 0===T?"":T,k=t.token,O=void 0===k?"":k,R=this;this._log=s.Monitoring.Logging.getLogger("coreclients.capi"),this._nextId=1,this._queue=new a.OperationQueue,this._commandsQueue=new Array,this._ack={},this._setContextFinishedAcc=new Set,this._checkingState="full",this._recheckRevision=f.None,this._statsRequester=new p.ValueRequester(function(t){return R._sendInbandCommand(t)},15e3,"DocStats"),this._synonymsRequester=new p.ValueRequester(function(t){return R._sendInbandCommand(t)},15e3,"Synonyms"),this._getTextRequester=new p.ValueRequester(function(t){return R._sendInbandCommand(t)},15e3,"Text"),this._startSession=function(){R._sendMessage(R._createStartMessage()),R._handler.onSesionStarted({kind:"session_started"})},this._send=function(){R._log.trace("send("+R._fsm.current+")"),R._fsm.current===r.STARTED&&(!R._queue.isEmpty||R._commandsQueue.length>0)&&(R._splitRevisions(R._queue.popAll(),R._commandsQueue).forEach(R._sendMessage),R._commandsQueue=[])},this._sendMessage=function(t){R._log.isEnabled(s.Logging.LogLevel.TRACE)&&R._log.trace("Sending >>> "+JSON.stringify(t).replace("\n"," ").substring(0,300)),R._conn.send(t)},this._handler=Object.assign(new _.DefaultCAPIEventHandler,n||{}),this._url=e,this._context=o,this._dialect=h,this._client=v,this._clientVersion=w,this._extDomain=S,this._sendDelay=x,this._docid=A,this._token=O,this._fsm=new u.StateMachine(r.DISCONNECTED,r.CLOSED).with(r.ANY).parentOf(r.CONNECTED,r.CONNECTING,r.DISCONNECTED,r.STARTED).from(r.ANY).to(r.CLOSED).on(y.CLOSE).from(r.DISCONNECTED).to(r.CONNECTING).on(y.CONNECT).from(r.CONNECTING).to(r.CONNECTED).on(y.CONNECTED).from(r.CONNECTED,r.STARTED,r.CONNECTING).to(r.DISCONNECTED).on(y.DISCONNECT).from(r.CONNECTED).to(r.STARTED).on(y.START).on(r.CONNECTED,this._startSession).on(r.STARTED,function(t){return R._trySend(t.to)}).on(r.DISCONNECTED,function(t){return R._clear(t.args)}).on(r.CLOSED,function(){return R._close()}),this._log.isEnabled(s.Logging.LogLevel.TRACE)&&this._fsm.verbose(r,y),this._ws=l.WS.create().onMessage(function(t,e){return R._handleMessage(e)}).onDisconnect(function(t){return R._handleDisconnect(t)}).onError(l.errPrintln),this._tryConnect(),g.registerDebugHelper("closeCapiSocket",function(t,e){void 0===t&&(t=1e3),R._conn._ws.close(t,e)})}return t.prototype.setText=function(t){this._log.debug("setText(...)");this._clear("Text replaced by setText"),this._fsm.current===r.STARTED&&this._sendInbandCommand(this._createStartMessage());var e=this.pushChanges([new c.Operation("+",0,t,0)]);return this._checkingState="full",e},t.prototype.pushChange=function(t){return this.pushChanges([t])},t.prototype.pushChanges=function(t){var e=this;if(0===t.length)throw new Error("Empty changeset");for(var n=t.length-1;n>=0&&"*"!==t[n].type;)--n;var r=t;if(-1!==n){r=t.slice(n+1);var i=this.setText(t[n].text);if(0===r.length)return i}return new Promise(function(t,i){var o=r[0].textLength,s=r.filter(function(t){return"+"===t.type}).reduce(function(t,e){return t+e.text.length},0);e._queue.pushAll(r,t,i),s>0&&-1===n&&(10*s>o&&s>300?(e._checkingState="full",e._recheckRevision=f.Some(e._queue.revision)):e._recheckRevision.isEmpty()&&(e._checkingState="checking")),e._trySend(e._fsm.current)})},Object.defineProperty(t.prototype,"checkingState",{get:function(){return this._checkingState},enumerable:!0,configurable:!0}),t.prototype.accept=function(t,e,n){this._sendInbandCommand(new h.UserFeedback(this._nextId++,this._feedbackToString(o.FeedbackType.ACCEPTED),t,e,n))},t.prototype.setContext=function(t){this._log.debug("setContext(...)"),"idle"===this._checkingState&&(this._checkingState="full"),this._queue.incRevision(),this._sendInbandCommand(new h.SetContext(this._nextId++,this._queue.revision,m.DocumentContext.serialize(t))),this._setContextFinishedAcc.add(this._queue.revision),this._context=t},t.prototype.reportUserFeedback=function(t,e){this._sendInbandCommand(new h.UserFeedback(this._nextId++,this._feedbackToString(e),t.id,t.begin))},t.prototype.requestSynonyms=function(t,e){return this._synonymsRequester.request(new h.SynonymsRequest(this._nextId++,this._queue.revision,t,e))},t.prototype.requestDocStats=function(){return this._statsRequester.request(new h.StatsRequest(this._nextId++))},t.prototype.enablePlagiarismSearch=function(){this._sendInbandCommand(new h.ToggleChecksRequest(this._nextId++,{plagiarism:!0}))},t.prototype.disablePlagiarismSearch=function(){this._sendInbandCommand(new h.ToggleChecksRequest(this._nextId++,{plagiarism:!1}))},t.prototype.setOption=function(t,e){this._sendInbandCommand(new h.Option(this._nextId++,t,e))},t.prototype.ping=function(){this._sendInbandCommand(new h.Ping(this._nextId++))},t.prototype.close=function(){return this._fsm.event(y.CLOSE)},t.prototype.getText=function(){return this._getTextRequester.request({id:this._nextId++,action:"get_debug_info"})},t.prototype._trySend=function(t){this._log.trace("_trySend("+t+")"),this._timeout&&clearTimeout(this._timeout),t===r.STARTED&&(this._timeout=setTimeout(this._send,this._sendDelay))},t.prototype._close=function(){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(t){switch(t.label){case 0:return this._clear("close() called"),this._timeout&&clearTimeout(this._timeout),this._conn?[4,this._conn.close()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype._clear=function(t){var e=this;this._queue.clear(t),this._queue=new a.OperationQueue,this._commandsQueue=[],Object.keys(this._ack).forEach(function(n){return e._ack[Number(n)].fail(t)}),this._timeout&&clearTimeout(this._timeout),this._ack={},this._setContextFinishedAcc.clear()},t.prototype._createStartMessage=function(){return new h.Start(this._nextId++,this._client,this._clientVersion,this._extDomain,this._dialect,this._docid,this._token,m.DocumentContext.serialize(this._context))},t.prototype._createSubmitOt=function(t){var e=Math.min.apply(Math,t.map(function(t){return t.revision}));return this._ack[e]={done:function(e){return t.forEach(function(t){return t.successCallback(e)})},fail:function(e){return t.forEach(function(t){return t.failureCallback(e)})}},new h.SubmitOt(this._nextId++,e,(n=new Array).concat.apply(n,t.map(function(t){return t.pack()})));var n},t.prototype._splitRevisions=function(t,e){var n=this;if(0===t.length)return e.map(function(t){return t.command});if(0===e.length)return[this._createSubmitOt(t)];var r=e.reduce(function(t,e){return(t[e.afterRevision]=t[e.afterRevision]||[]).push(e),t},{});return Object.keys(r).map(function(t){return Number(t)}).sort(function(t,e){return t-e}).map(function(t){return r[t]}).reduce(function(e,r,i,o){var s=t.filter(function(t){return t.revision<=r[0].afterRevision});s.length>0&&e.push(n._createSubmitOt(s)),r.forEach(function(t){return e.push(t.command)});var a=o.length-1===i?t.filter(function(t){return t.revision>r[0].afterRevision}):[];return a.length>0&&e.push(n._createSubmitOt(a)),e},[])},t.prototype._sendInbandCommand=function(t){return this._queue.isEmpty&&this._fsm.current===r.STARTED?(this._log.trace("Q.isEmpty, sending command immidiately",t),this._sendMessage(t)):this._commandsQueue.push({afterRevision:this._queue.revision,command:t}),t.id},t.prototype._tryConnect=function(){return i.__awaiter(this,void 0,void 0,function(){var t,e,n,r,o;return i.__generator(this,function(i){switch(i.label){case 0:return[4,this._fsm.event(y.CONNECT)];case 1:if(!(t=i.sent()))return[2];i.label=2;case 2:return i.trys.push([2,9,,10]),[4,this._ws.connect(this._url)];case 3:e=i.sent(),this._conn=e,i.label=4;case 4:return i.trys.push([4,6,,8]),[4,this._fsm.event(y.CONNECTED,e)];case 5:if(!(n=i.sent()))throw new Error("State change failed");return[3,8];case 6:return r=i.sent(),this._log.warn("Connection cannot be finalized due to error",r),[4,e.close()];case 7:return i.sent(),[3,8];case 8:return[3,10];case 9:return o=i.sent(),l.errPrintln(o),[3,10];case 10:return[2]}})})},t.prototype._handleMessage=function(t){switch(this._log.trace("<<<",{message:{action:t.action,id:t.id,rev:t.rev}}),t.action){case"start":this._fsm.event(y.START);break;case"alert":this._handleAlert(t);break;case"remove":this._handler.onRemove({kind:"alert_removed",alertId:t.id.toString()});break;case"finished":this._handleFinish(t);break;case"async_check_finished":this._handleAsyncCheckFinished(t);break;case"feedback":case"submit_ot":case"option":case"set_context":case"toggle_checks":this._handleAck(t);break;case"error":this._log.error("Error",{message:t});var e=t;this._handler.onError(Object.assign({kind:"error"},e)),e.error===o.ErrorCode.CANNOT_GET_TEXT_STATS&&this._statsRequester.onError(t.id,new Error("Server Error"));break;case"pong":this._handler.onPong();break;case"synonyms":this._handleSynonyms(t);break;case"text_stats":t.readingTime=d.DocumentStatistics.calculateReadingTime(t),t.speakingTime=d.DocumentStatistics.calculateSpeakingTime(t),this._handler.onStats({kind:"stats",stats:t}),this._statsRequester.onValue(t.id,t);break;case"debug_info":this._handler.onDebugInfo({kind:"debug_info",info:t}),this._getTextRequester.onValue(t.id,t.text);break;default:this._log.error("Unknown message",{message:t})}},t.prototype._handleAlert=function(t){this._handler.beforeAlert({kind:"before_alert"});var e=Object.assign(t,{id:t.id.toString()}),n=e.rev,r=this._queue.getChangesSince(n);r.length&&this._log.isEnabled(s.Logging.LogLevel.TRACE)&&this._log.trace("ALERT transforming alert against staging operations: "+r);var i=o.RawAlert.transformMarkupAgainst(e,r);null!==i?o.RawAlert.isPlagiarism(i)?this._handler.onPlagiarism({kind:"plagiarism",alert:i}):this._handler.onAlert({kind:"alert_received",alert:i}):s.Monitoring.Logging.getLogger("coreclients.capi").trace("OT ALERT: discarding alert due to position overlap",{message:e})},t.prototype._handleAsyncCheckFinished=function(t){"plagiarism"===t.check&&this._handler.onPlagiarismFinish({kind:"plagiarism_finished"})},t.prototype._handleFinish=function(t){var e=f.Option.of(t.scores),n={kind:"finish",revision:t.rev,score:e.map(function(e){return{errorRateScore:t.score,accuracy:e.Accuracy,clarity:e.Clarity,effectiveness:e.Effectiveness,rank:Math.min(100,Math.round(.5*e.Accuracy+.25*(e.Clarity+e.Effectiveness)))}})};"full"===this._checkingState&&this._recheckRevision.contains(n.revision)&&(this._recheckRevision=f.None,this._checkingState="checking"),this._queue.isEmpty&&(this._checkingState="idle"),this._handler.onFinish(n);var r=this._ack[n.revision];void 0!==r?(r.done(n),delete this._ack[n.revision]):this._setContextFinishedAcc.has(n.revision)?this._setContextFinishedAcc.delete(n.revision):this._log.warn("Finish for unexpected revision",{message:t})},t.prototype._handleAck=function(t){this._log.trace("<<< Acknowledge for "+t.action,{message:t})},t.prototype._handleSynonyms=function(t){var e={word:t.token,position:t.synonyms.pos},n=function(t){return t.derived},r=t.synonyms.meanings.length>0?f.Some({id:t.id.toString(),originalWord:t.token,synonymsOrGroups:1===t.synonyms.meanings.length?f.Either.left(t.synonyms.meanings[0].synonyms.map(n)):f.Either.right(t.synonyms.meanings.map(function(t){if(void 0===t.meaning)throw new Error("Absent meaning in synonyms group.");return{meaning:t.meaning,words:t.synonyms.map(n)}}))}):f.None,i=Object.assign({kind:"synonyms",synonyms:r},e);this._handler.onSynonyms(i),this._synonymsRequester.onValue(t.id,r)},t.prototype._handleDisconnect=function(t){return i.__awaiter(this,void 0,void 0,function(){var e,n,r,o=this;return i.__generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,this._fsm.event(y.DISCONNECT,t.reason)];case 1:return(e=s.sent())?(this._log.warn("Disconnected due to ",t.reason),[4,this._fsm.event(y.CONNECT)]):[2];case 2:return(n=s.sent())?(this._handler.onDisconnect(t,t.reconnect.nextDelay,function(e){return i.__awaiter(o,void 0,void 0,function(){var n,r,o;return i.__generator(this,function(i){switch(i.label){case 0:return[4,t.reconnect.scheduleReconnect(e)];case 1:n=i.sent(),this._conn=n,i.label=2;case 2:return i.trys.push([2,4,,6]),[4,this._fsm.event(y.CONNECTED,n)];case 3:if(!(r=i.sent()))throw new Error("State change failed");return[3,6];case 4:return o=i.sent(),this._log.warn("Reconnect failed due to error ",o),[4,n.close()];case 5:return i.sent(),[3,6];case 6:return[2]}})})}),[3,4]):[2];case 3:return r=s.sent(),l.errPrintln(r),[3,4];case 4:return[2]}})})},t.prototype._sendStatsRequest=function(){this._sendInbandCommand(new h.StatsRequest(this._nextId++))},t.prototype._feedbackToString=function(t){return o.FeedbackType[t].toLowerCase()},t}();e.CAPIClientImpl=v},445:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=function(){function t(t){this.id=t}return t}();e.MessageBase=i;var o=function(t){function e(e){var n=t.call(this,e)||this;return n.action="ping",n}return r.__extends(e,t),e}(i);e.Ping=o;var s=function(t){function e(e){var n=t.call(this,e)||this;return n.action="pong",n}return r.__extends(e,t),e}(i);e.Pong=s;var a=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.name=n,i.value=r,i.action="option",i}return r.__extends(e,t),e}(i);e.Option=a;var c=function(t){function e(e,n,r,i,o,s,a,c){void 0===a&&(a="");var u=t.call(this,e)||this;return u.client=n,u.clientVersion=r,u.extDomain=i,u.dialect=o,u.docid=s,u.token=a,u.documentContext=c,u.action="start",u}return r.__extends(e,t),e}(i);e.Start=c;var u=function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.rev=n,s.score=r,s.dialect=i,s.scores=o,s.action="finished",s}return r.__extends(e,t),e}(i);e.Finish=u;var l=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.rev=n,i.documentContext=r,i.action="set_context",i}return r.__extends(e,t),e}(i);e.SetContext=l;var h=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.rev=n,i.check=r,i.action="async_check_finished",i}return r.__extends(e,t),e}(i);e.AsyncCheckFinished=h;var d=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.rev=n,o.ch=r,o.genre=i,o.action="submit_ot",o}return r.__extends(e,t),e}(i);e.SubmitOt=d;var p=function(t){function e(e,n,r,i,o,s,a,c,u,l,h,d,p,f,_,g,m,y,v,b,w,E,S){var C=t.call(this,e)||this;return C.rev=n,C.begin=r,C.end=i,C.highlightBegin=o,C.highlightEnd=s,C.text=a,C.pname=c,C.highlightText=u,C.category=l,C.group=h,C.title=d,C.details=p,C.examples=f,C.explanation=_,C.transforms=g,C.replacements=m,C.free=y,C.extra_properties=v,C.hidden=b,C.cardLayout=w,C.sentence_no=E,C.todo=S,C.action="alert",C}return r.__extends(e,t),e}(i);e.Alert=p;var f=function(t){function e(e){var n=t.call(this,e)||this;return n.action="remove",n}return r.__extends(e,t),Object.defineProperty(e.prototype,"alertId",{get:function(){return this.id},enumerable:!0,configurable:!0}),e}(i);e.RemoveAlert=f;var _=function(t){function e(e,n){var r=t.call(this,e)||this;return r.checks=n,r.action="toggle_checks",r}return r.__extends(e,t),e}(i);e.ToggleChecksRequest=_;var g=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.rev=n,o.begin=r,o.token=i,o.action="synonyms",o}return r.__extends(e,t),e}(i);e.SynonymsRequest=g;var m=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.token=n,i.synonyms=r,i.action="synonyms",i}return r.__extends(e,t),e}(i);e.SynonymsMessage=m;var y=function(t){function e(e,n,r,i,o,s){var a=t.call(this,e)||this;return a.type=n,a.alertId=r,a.position=i,a.text=o,a.previousText=s,a.action="feedback",a}return r.__extends(e,t),e}(i);e.UserFeedback=y;var v=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.error=n,i.severity=r,i.action="error",i}return r.__extends(e,t),e}(i);e.Error=v;var b=function(t){function e(e){var n=t.call(this,e)||this;return n.action="get_text_stats",n}return r.__extends(e,t),e}(i);e.StatsRequest=b},446:function(t,e,n){"use strict";function r(t){if(null===t||"boolean"==typeof t)return null;var e=Number(t);return Number.isNaN(e)?null:e}function i(t){return"true"===t||"false"!==t&&"0"!==t&&Boolean(t)}function o(t){try{return JSON.parse(decodeURI(t))}catch(t){return null}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(68),a=function(){function t(t){this._value=t}return t.prototype.getStr=function(){return void 0!==this._value&&null!==this._value?String(this._value):null},t.prototype.getNum=function(){return r(this._value)},t.prototype.getBool=function(){return i(this._value)},t.prototype.getObject=function(){return o(this._value)},t.prototype.getObjProp=function(t){return this._value.hasOwnProperty(t)?this._value[t]:null},t}();e.Property=a;var c=function(){function t(){}return t.prototype.getStr=function(t){return this.hasOwnProperty(t)?String(this[t]):null},t.prototype.getNum=function(t){return this.hasOwnProperty(t)?r(this[t]):null},t.prototype.getBool=function(t){return this.hasOwnProperty(t)?i(this[t]):null},t.prototype.getObject=function(t){return this.hasOwnProperty(t)?o(this[t]):null},t.prototype.has=function(t){return this.hasOwnProperty(t)},t.prototype.ifPresent=function(t,e){this[t]&&e&&e.apply(this[t])},t.of=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=new t,i=0,o=e;i<o.length;i++){var s=o[i];for(var a in s){var c=s[a];r[a]="object"==typeof c?encodeURI(JSON.stringify(c)):c}}return r},t.prototype.entries=function(){var t=this;return Object.keys(this).map(function(e){return[e,new a(t[e])]})},t.find=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e.find(function(e){return e.has(t)});return new a(r&&r[t])},t}();e.Properties=c;var u=function(){function t(t,e,n){this._url=t,this._fetch=e,this._token=n,this._ajax=s.Ajax.factory(this._fetch,"dapi")}return t.prototype.load=function(){return this._execute(s.RequestBuilder.get(this._url,"api/props"))},t.prototype.get=function(t){return this._execute(s.RequestBuilder.get(this._url,"api/props").pathParam(t))},t.prototype.save=function(t){return this._execute(s.RequestBuilder.post(this._url,"api/props").json(t))},t.prototype.getMimic=function(t){var e=s.RequestBuilder.get(this._url,"api/mimic").queryParam("containerId",t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build())},t.prototype._execute=function(t){return this._token&&t.cookie("grauth",this._token),this._ajax(t.build()).then(function(t){return c.of(t)})},t}();e.Dapi=u},447:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(68),i=function(){function t(t,e,n){this._url=t,this._fetch=e,this._token=n,this._ajax=r.Ajax.factory(this._fetch,"capi")}return t.prototype._attachCookie=function(t){return this._token&&t.cookie("grauth",this._token),t.build()},t.prototype.get=function(){return this._ajax(this._attachCookie(r.RequestBuilder.get(this._url,"/dict")))},t.prototype.delete=function(t){return this._ajax(this._attachCookie(r.RequestBuilder.del(this._url,"/dict").pathParam(t)),r.Ajax.toVoid)},t.prototype.add=function(t){return this._ajax(this._attachCookie(r.RequestBuilder.post(this._url,"/dict").json({word:t})),r.Ajax.toVoid)},t}();e.Dictionary=i},448:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(687),i=n(167),o=n(104),s=function(){function t(){}return t.diffAsChanges=function(t,e){var n=new r.diff_match_patch,i=n.diff_main(t,e,!0);n.diff_cleanupSemantic(i);var s=[],a=t.length,c=0;return i.forEach(function(t){t[0]===r.DIFF_EQUAL&&(c+=t[1].length),t[0]===r.DIFF_DELETE&&(s.push(new o.Change("-",c,t[1],a)),c+=t[1].length),t[0]===r.DIFF_INSERT&&s.push(new o.Change("+",c,t[1],a))}),s},t.diff=function(t,e,n){return void 0===n&&(n=0),new i.Changesets(this.diffAsOperations(t,e),n)},t.diffAsOperations=function(t,e){return this.diffAsChanges(t,e).map(function(t){return new o.Operation(t.type,t.pos,t.text,t.len)})},t}();e.Diff=s},449:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),i=n(202),o=n(144),s=n(68),a=function(){function t(t,e,n){this._url=t,this._fetch=e,this._token=n,this._ajax=s.Ajax.factory(this._fetch,"institution"),this._log=r.Monitoring.Logging.getLogger("coreclients.institution")}return t.prototype._setToken=function(t){this._token=t},t.prototype.getInfo=function(){var t=s.RequestBuilder.get(this._url,"api/institution");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build()).then(this._parseInstitutionInfo)},t.prototype._parseInstitutionInfo=function(e){var n=this;return void 0===e?(this._log.warn("failed to parse institution info: empty payload"),t.emptyInfo):o.validate(e,t.InfoType).mapLeft(i.failure).fold(function(e){return n._log.warn("failed to parse institution info: incorrect payload",e),t.emptyInfo},function(t){return t})},t.InfoType=o.interface({id:o.number,name:o.string,plagiarismDisabled:o.boolean,scoreDisabled:o.boolean,licenseDiscountinued:o.boolean,quickReplacement:o.boolean,fullCards:o.boolean,proofit:o.boolean,domainValidation:o.boolean,admin:o.boolean}),t.emptyInfo={id:-1,name:"",plagiarismDisabled:!1,scoreDisabled:!1,licenseDiscountinued:!1,quickReplacement:!1,fullCards:!1,proofit:!1,domainValidation:!1,admin:!1},t}();e.Institution=a},450:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(68),o=n(53),s=function(){function t(t,e,n,r){this._url=t,this._subscriptionUrl=e,this._fetch=n,this._token=r,this._ajax=i.Ajax.factory(this._fetch,"irbis")}return t.prototype.deleteAccount=function(){var t=i.RequestBuilder.del(this._url,"/api/user");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),i.Ajax.toVoid)},t.prototype.getStatus=function(){var t=i.RequestBuilder.get(this._subscriptionUrl);return this._token&&t.cookie("grauth",this._token),this._ajax(t.build())},t.prototype.cancelSubscription=function(){var t=i.RequestBuilder.post(this._subscriptionUrl,"/cancel");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),i.Ajax.toVoid)},t.prototype.renewSubscription=function(){var t=i.RequestBuilder.post(this._subscriptionUrl,"/renew");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),i.Ajax.toVoid)},t.prototype.ackPremiumConversion=function(){var t=i.RequestBuilder.post(this._subscriptionUrl,"/ack-premium-conversion");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),i.Ajax.toVoid)},t.prototype.generateTokenCreditCard=function(){var t=i.RequestBuilder.post(this._subscriptionUrl,"/token/card");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),i.Ajax.parseJSON)},t.prototype.getTokenRequest=function(t){var e=this;return o.retryWithDelay(function(){return r.__awaiter(e,void 0,void 0,function(){var e,n;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._tokenRequest(t)];case 1:if(!(e=r.sent()))throw new o.RetryError("empty response");if(n=JSON.parse(e),!n.token)throw new o.RetryError("empty token");return[2,n.token]}})})})},t.prototype.getPaypalRedirectPageRequest=function(t){var e=this;return o.retryWithDelay(function(){return r.__awaiter(e,void 0,void 0,function(){var e,n;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._tokenRequest(t)];case 1:if(!(e=r.sent()))throw new o.RetryError("empty response");if(n=JSON.parse(e),!n.paypalRedirectPage)throw new o.RetryError("empty paypalRedirectPage");return[2,n.paypalRedirectPage]}})})})},t.prototype._tokenRequest=function(t){var e=i.RequestBuilder.get(this._subscriptionUrl,"/token/request").pathParam(t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),i.Ajax.parseText)},t.prototype.getAvailablePlans=function(){var t=i.RequestBuilder.get(this._subscriptionUrl,"/pricing");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build())},t.prototype.changePlan=function(t){var e=i.RequestBuilder.post(this._subscriptionUrl,"/set-plan").pathParam(t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),i.Ajax.toVoid)},t.prototype.subscribeCard=function(t){var e=i.RequestBuilder.post(this._subscriptionUrl,"/subscribe-card").formParam("nonce",t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),i.Ajax.toVoid)},t.prototype.subscribeCardSandbox=function(t){void 0===t&&(t="1");var e=i.RequestBuilder.post(this._subscriptionUrl,"/subscribe-card").formParam("planId",t).formParam("nonce","fake-valid-nonce").formParam("sessionId","test-session").formParam("billingZip","12345");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),i.Ajax.toVoid)},t.prototype.updateCreditCard=function(t){var e=i.RequestBuilder.post(this._subscriptionUrl,"/update-card").formParam("nonce",t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),i.Ajax.toVoid)},t.prototype.subscribePaypal=function(t){var e=i.RequestBuilder.post(this._subscriptionUrl,"/token/paypal").formParam("nonce",t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),i.Ajax.toVoid)},t.prototype.generateTokenPaypal=function(t){var e=t.cancelUrl,n=t.returnUrl,r=i.RequestBuilder.post(this._subscriptionUrl,"/token/paypal").formParam("cancelUrl",e).formParam("returnUrl",n);return this._token&&r.cookie("grauth",this._token),this._ajax(r.build(),i.Ajax.parseJSON)},t.prototype.updatePaypal=function(t){var e=i.RequestBuilder.post(this._subscriptionUrl,"/update-paypal").formParam("payPalToken",t);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),i.Ajax.toVoid)},t.prototype.checkDownloadBillingReceipts=function(){var t=i.RequestBuilder.head(this._subscriptionUrl,"/receipt").header("Content-Type","application/pdf");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),i.Ajax.assertMimeType("application/pdf"))},t}();e.Irbis=s},451:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(15),o=n(6),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._subs=null,e}return r.__extends(e,t),e.prototype._setupTitle=function(){return o.toObservable(this.props.title).filter(function(t){return null!==t}).subscribe(function(t){return document.title=t})},e.prototype.componentWillMount=function(){this._subs=this._setupTitle()},e.prototype.componentWillUnmount=function(){this._subs&&this._subs.unsubscribe(),this._subs=null},e.prototype.render=function(){return i.Children.only(this.props.children)},e}(i.Component);e.BasePage=s},452:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(15),o=n(160),s=n(43),a=n(265),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.getChildContext=function(){var t=this.props.model,e=t.telemetry,n=t.platformInfo,r=t.notifications,i=t.tooltip;return{appRouter:this.props.router,appConfig:this.props.config,textResources:o.getTextResources(s.isDesktopEditor(n.browser)?"desktopeditor":"webeditor"),telemetry:e,notifications:r,tooltip:i}},e.prototype.render=function(){return i.Children.only(this.props.children)},e.childContextTypes=a.baseComponentContextTypes,e}(i.Component);e.ContextAppender=c},453:function(t,e,n){"use strict";function r(t,e){var n=e.flatMap(function(t){return i.Try.of(function(){return JSON.parse(t)}).recover(a.Monitoring.Logging.getLogger("config.parser").handler("Parse error of the provided JSON config",{config:t}).info).toOption()}).orNull();return o.validate(n,l).mapLeft(s.failure).mapLeft(function(t){return a.Monitoring.Logging.getLogger("config.parser").info("Validation error of the provided JSON config",{config:n,error:t})}).toOption().fold(function(){return t},function(e){return c.merge(t,e)})}Object.defineProperty(e,"__esModule",{value:!0});var i=n(35),o=n(144),s=n(202),a=n(4),c=n(442),u={_A:o._A,name:"httpString",validate:function(t,e){return"string"==typeof t&&t.match(/^(https?|wss):\/\/(\w|\d|-|\/|\.|\?|\=|\_)*(:(\d)*)?$/)?o.success(t):o.failure(t,e)}},l=o.partial({api:o.partial({authUrl:u,capiApiUrl:u,capiWsUrl:u,crashLogUrl:u,dapiUrl:u,doxUrl:u,felogUrl:u,gnarApi:o.partial({url:u}),institutionUrl:u,irbisUrl:u,onlineTestUrl:u,pdfGeneratorUrl:u,proofitResultUrl:u,wsTest:u}),desktop:o.partial({mac:o.partial({infoURL:u,installURL:u}),windows:o.partial({infoURL:u,installURL:u})}),edu:o.partial({adminPanelURL:u}),extension:o.partial({chrome:o.partial({infoURL:u,installURL:u}),firefox:o.partial({iconURL:u,infoURL:u,installURL:u}),safari:o.partial({installURL:u})}),funnel:o.partial({accountDeleted:u,mainPage:u,resetPassword:u,signin:u,signup:u,subscribe:u,upgrade:u}),officeAddIn:o.partial({infoURL:u,installURL:u}),support:o.partial({connectionTroubleshooting:u,contact:u,diagnosticTestPath:u,documentAcceptTrackedChanges:u,email:u,emailExistsKBUrl:u,login:u,mainPage:u,newRequest:u,phoenixSupportUrl:u,phoenixWritingHelpUrl:u})});e.createConfig=r},454:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(15),o=n(23),s=n(10),a=n(107),c=function(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)},u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleClick=function(t){if(e.props.onClick&&e.props.onClick(t),!t.defaultPrevented&&0===t.button&&!e.props.target&&!c(t)){t.preventDefault();var n=(e.context.router.history,e.props.destination);e.context.appRouter.navigate(n)}},e}return r.__extends(e,t),e.prototype.componentWillMount=function(){if(!(this.context.appRouter instanceof a.Router.Impl||this.context.appRouter instanceof a.Router.DummyImpl))throw new TypeError("No router or invalid router supplied to Link.\n        It should be the editor-router and should come from the context.")},e.prototype.render=function(){var t=this.props,e=t.destination,n=t.className,o=t.activeClassName,a=t.children,c=r.__rest(t,["destination","className","activeClassName","children"]),u=this.context.router.history.createHref(e),l=this.context.appRouter.isActive(e);return i.createElement(s.F.a,r.__assign({},r.__assign({href:u},s.classes(n,l.view(function(t){return t&&o})),c),{onClick:this.handleClick}),a)},e.contextTypes=Object.assign({router:o.shape({history:o.shape({push:o.func.isRequired,replace:o.func.isRequired,createHref:o.func.isRequired}).isRequired}).isRequired},a.Router.ContextTypes),e}(i.Component);e.Link=u},455:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(15),o=n(10),s=n(89),a=n(441),c=n(6),u=n(229),l=n(244),h=n(107),d=n(456),p=n(452),f=n(43),_=n(453),g=n(301),m=new h.Router.Impl,y=_.createConfig(s.appConfig,m.query.get("config")),v=a.defaultModel(y,m),b=d.routesMap(v),w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._getContent=function(t){return function(e){return c.Async.isOk(e)?t():c.Async.isError(e)||c.Async.isFatal(e)?i.createElement(l.Error500Page,null):i.createElement(u.Spinner,{className:g.spinner})}},e}return r.__extends(e,t),e.prototype.render=function(){var t=this;return i.createElement(h.Router.Wrapper,{routesMap:b,renderer:function(e,n){var s=e.match;e.location;return n.private&&v.authentication.ensureAuthenticated(),i.createElement(p.ContextAppender,r.__assign({},{model:v,router:m,config:y}),n.private?i.createElement(o.F.div,r.__assign({},o.classes(f.isDesktopEditor(v.platformInfo.browser)&&g.desktopEditorPreventSelection)),v.authentication.status.view(t._getContent(function(){return d.globalExperiment(v,m).getOrElseL(function(){return n.component(s.params)})}))):n.component(s.params))}})},e}(i.Component);e.Main=w},456:function(t,e,n){"use strict";function r(t,e){var n=l.promiseToStream(t).map(function(t){return t.fold(function(){return s.createElement(_.Spinner,{className:g.spinner})},function(t){return t.fold(function(t){return u.Monitoring.Logging.getLogger("routes.loader").fatal("Fail on component load",t),s.createElement(h.Error500Page,null)},e)})});return s.createElement(c.F.div,null,n)}function i(t){return{documents:f.Router.bindComponent(f.Router.routes.documents,function(){return r(function(){return new Promise(function(t){return n.e(0).then(function(e){return t(n(1139))}.bind(null,n)).catch(n.oe)})},function(e){return s.createElement(e.DocumentsPage,{model:t})})}),profile:f.Router.bindComponent(f.Router.routes.profile,function(){return r(function(){return new Promise(function(t){return n.e(0).then(function(e){return t(n(1141))}.bind(null,n)).catch(n.oe)})},function(e){return s.createElement(e.ProfilePage,{model:t})})}),subscription:f.Router.bindComponent(f.Router.routes.subscription,function(){return r(function(){return new Promise(function(t){return n.e(0).then(function(e){return t(n(1142))}.bind(null,n)).catch(n.oe)})},function(e){return t.userAccount.features.isFree?s.createElement(f.Router.Redirect,{destination:f.Router.routes.free.href({})}):s.createElement(e.SubscriptionPage,{model:t})})}),apps:f.Router.bindComponent(f.Router.routes.apps,function(){return r(function(){return new Promise(function(t){return n.e(0).then(function(e){return t(n(1137))}.bind(null,n)).catch(n.oe)})},function(e){return s.createElement(e.AppsPage,{model:t})})}),new_document:f.Router.bindComponent(f.Router.routes.new_document,function(){return s.createElement(c.F.div,null,l.promiseToStream(function(){return t.documentsPage.actions.createDocument()}).map(function(t){return t.fold(function(){return s.createElement(_.Spinner,{className:g.spinner})},function(t){return t.map(function(t){return t.id.toString()}).fold(function(t){return u.Monitoring.Logging.getLogger("routes").fatal("Fail create new document",t),s.createElement(h.Error500Page,null)},function(t){return s.createElement(f.Router.Redirect,{destination:f.Router.routes.editor.href({docId:t})})})})}))}),editor:f.Router.bindComponent(f.Router.routes.editor,function(e){var i=e.docId,o=t.userAccount.features,a=o.isDenaliProto;return o.isDenaliV2?s.createElement(f.Router.Redirect,{destination:f.Router.routes.denali_editor.href({docId:i})}):a?s.createElement(f.Router.Redirect,{destination:f.Router.routes.denali_proto_editor.href({docId:i})}):r(function(){return n.e(2).then(n.bind(null,1143))},function(e){return s.createElement(e.EditorPage,{model:t,docId:i})})}),denali_proto_editor:f.Router.bindComponent(f.Router.routes.denali_proto_editor,function(e){var i=e.docId;return r(function(){return n.e(4).then(n.bind(null,1136))},function(e){return s.createElement(e.DenaliProtoEditorPage,{model:t,docId:i})})}),denali_editor:f.Router.bindComponent(f.Router.routes.denali_editor,function(e){var i=e.docId;return t.userAccount.features.forceEditorTs?s.createElement(f.Router.Redirect,{destination:f.Router.routes.editor.href({docId:i})}):r(function(){return n.e(3).then(n.bind(null,1135))},function(e){return s.createElement(e.DenaliEditorPage,{wsConnectivity:t.wsConnectivity,networkState:t.networkState,notifications:t.notifications,doxApi:t.apis.dox,docId:i,user:t.userAccount.profile.get()})})}),free:f.Router.bindComponent(f.Router.routes.free,function(){return t.userAccount.features.isFree?r(function(){return n.e(7).then(n.bind(null,1140))},function(e){return s.createElement(e.FreePage,{authentication:t.authentication,userAccount:t.userAccount})}):s.createElement(f.Router.Redirect,{destination:f.Router.routes.documents.href({})})}),componentBrowser:f.Router.bindComponent(f.Router.routes.component_browser,function(t){var e=t.component;return r(function(){return n.e(1).then(n.bind(null,1144))},function(t){return s.createElement(t.ComponentBrowserPage,{component:e})})}),card_iframe:f.Router.bindComponent(f.Router.routes.card_iframe,function(){return r(function(){return n.e(5).then(n.bind(null,1138))},function(t){return s.createElement(t.CardIframePage,null)})}),diagnostic_test:f.Router.bindComponent(f.Router.routes.diagnostic_test,function(){return r(function(){return n.e(6).then(n.bind(null,1145))},function(t){return s.createElement(t.DiagnosticPage,null)})}),notFound:f.Router.bindComponent(f.Router.routes.notFound,function(){return s.createElement(d.Error404Page,{requestedData:"page"})})}}function o(t,e){if(t.userAccount.features.isUserTesting.get()&&!e.isActive(f.Router.routes.denali_proto_editor.href({docId:"*"})).get()){var n=l.promiseToStream(function(){return t.documentsPage.actions.createDocument(p.userTestingDemoText,p.userTestingDemoTitle)});return a.Option.some(s.createElement(c.F.div,null,n.map(function(t){return t.fold(function(){return s.createElement(_.Spinner,{className:g.spinner})},function(t){return t.map(function(t){return t.id.toString()}).fold(function(t){return u.Monitoring.Logging.getLogger("global_experiment").fatal("Fail when redirecting to usertesting doc",t),s.createElement(f.Router.Redirect,{destination:f.Router.routes.documents.href({})})},function(t){return s.createElement(f.Router.Redirect,{destination:f.Router.routes.denali_proto_editor.href({docId:t})})})})})))}return a.Option.none()}Object.defineProperty(e,"__esModule",{value:!0});var s=n(15),a=n(35),c=n(10),u=n(4),l=n(6),h=n(244),d=n(485),p=n(497),f=n(107),_=n(229),g=n(301);e.routesMap=i,e.globalExperiment=o},457:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(10),o=n(24),s=n(42),a=n(4),c=n(6),u=n(43),l=n(105),h=n(169),d=n(128);e.defaultState=c.Async.defaultValue();var p="webeditor",f="desktopeditor",_=function(t){function e(){return t.call(this,{code:403,status:"error",message:"User is anonymous"})||this}return r.__extends(e,t),e}(s.HTTPError);e.AnonymousUserError=_;var g=function(t){function e(){return t.call(this,{code:0,status:"error",message:"User cannot use editor"})||this}return r.__extends(e,t),e}(s.HTTPError);e.CannotUseEditorError=g;var m=function(t){function e(e){return t.call(this,{code:e,status:"error",message:"Connection failed"})||this}return r.__extends(e,t),e}(s.HTTPError);e.ConnectionError=m;var y=function(){function t(t,e,n,r,i,o,l,h,d,_,m,y){var v=this;this._state=t,this._authApi=e,this._institutionApi=n,this._dapi=r,this._onAuthenticated=i,this._signinUrl=o,this._mainPageUrl=l,this._getContainerId=h,this._navigateToFreePage=d,this._modal=_,this._overlay=m,this._browser=y,this._log=a.Monitoring.Logging.getLogger("model.authentication"),this._authAppName=u.isDesktopEditor(this._browser)?f:p,this.status=this._state.view(function(t){return c.Async.map(t,function(t){return t})}),this._handleAuthError=function(t){t instanceof g?v._gotoFreePage():!t||401!==t.code&&403!==t.code?(v._log.fatal("authError: Failed to get user session","string"==typeof t?t:a.EventProps.fromAny(t)),v._state.modify(function(e){return c.Async.isOk(e)?c.Async.error(t||new Error("authError: Failed to get user session, error is undefined"))(e):e})):(v._log.warn("authError: Bad user session",t),v._gotoLogin())},this._retryWhen=function(t){return!(t instanceof s.HTTPError)||c.isServerErrorCode(t.code)}}return t.prototype.ensureAuthenticated=function(){return r.__awaiter(this,void 0,void 0,function(){var t,e,n=this;return r.__generator(this,function(r){switch(r.label){case 0:if(!c.Async.isIdle(this._state.get()))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),this._state.modify(c.Async.begin),[4,this._getUserSession()];case 2:if(t=r.sent(),setTimeout(function(){n._onAuthenticated(t),n._state.modify(c.Async.success(t))},0),!t.userProfile.canUseEditor)throw new g;return[3,4];case 3:return e=r.sent(),this._handleAuthError(e),e instanceof g||this._state.modify(c.Async.error(e)),[3,4];case 4:return[2]}})})},t.prototype._parseUserProfileJSON=function(t,e,n,r){var i=new Set(t.groups.filter(Boolean)),o="Free"===t.type?l.UserType.free:"Premium"===t.type?l.UserType.premium:function(){throw new Error("Unknown user type "+t.type)}();return{userProfile:{id:t.id,email:t.email,newEmail:t.newEmail,fullName:t.name,isFreebie:i.has(l.UserGroups.FREEBIE_USER),isTest:t.isTest||!1,canUseEditor:"Premium"===t.type||t.freemium||!1,groups:i,type:o},subscription:h.defaultState,institution:r,settings:e,experiments:n}},t.prototype._parseLaterBanners=function(t){return t.map(function(t){if("object"==typeof t)return t;var e=t.split(":"),n=e[0],r=e[1];return{type:n,expire:parseInt(r,10)}})},t.prototype._parseUserSettings=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=(d=s.Properties).find.apply(d,["banners"].concat(t)).getObject()||{},r=n.shown,i=void 0===r?[]:r,o=n.showen,a=void 0===o?[]:o,c=n.dismiss,u=void 0===c?[]:c,l=n.later,h=void 0===l?[]:l;return{firstCall:(p=s.Properties).find.apply(p,["firstCall"].concat(t)).getBool()||!1,seenWelcome:(f=s.Properties).find.apply(f,["seenWelcome"].concat(t)).getBool()||!1,acceptedTermsVersion:(_=s.Properties).find.apply(_,["acceptedTermsVersion"].concat(t)).getStr()||"",dialectStrong:(g=s.Properties).find.apply(g,["dialectStrong"].concat(t)).getStr(),dialectWeak:(m=s.Properties).find.apply(m,["dialectWeak"].concat(t)).getStr(),denaliLens:(y=s.Properties).find.apply(y,["denaliLens"].concat(t)).getObject()||{},banners:{dismiss:u,later:this._parseLaterBanners(h),shown:i||a}};var d,p,f,_,g,m,y},t.prototype.checkAuthenticated=function(){return this._authApi.getUser(this._authAppName).then(function(t){if(t.anonymous)throw new _}).catch(this._handleAuthError)},t.prototype._getUserMimic=function(){return r.__awaiter(this,void 0,void 0,function(){var t,e,n;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._getContainerId()];case 1:return t=r.sent(),[4,this._dapi.getMimic(t)];case 2:return e=r.sent().groups,[2,new Set(e)];case 3:return n=r.sent(),this._log.warn("dapiError: Failed to get mimic groups",n),[2,new Set];case 4:return[2]}})})},t.prototype._getUserSession=function(){return r.__awaiter(this,void 0,void 0,function(){var t,e,n,i,o,a,c=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._authApi.getUser(this._authAppName)];case 1:if(t=r.sent(),t.anonymous)throw new _;return[4,Promise.all([this._dapi.load().catch(function(t){return c._log.warn("dapiError: Failed to get dapi props",t),s.Properties.of({})}),this._getUserMimic(),void 0!==t.institutionId?this._getUserInstitution():Promise.resolve(null)])];case 2:return e=r.sent(),n=e[0],i=e[1],o=e[2],a=this._parseUserSettings(s.Properties.of(n),d.LocalStorageUserSettings.read(t.id),s.Properties.of(t.settings)),d.LocalStorageUserSettings.write(t.id,s.Properties.of(a)),[2,this._parseUserProfileJSON(t,a,i,o)]}})})},t.prototype._getUserInstitution=function(){return r.__awaiter(this,void 0,void 0,function(){var t,e=this;return r.__generator(this,function(n){return t=i.Atom.create(c.Async.defaultValue()),c.Async.OperationRetrier.create(function(){return e._institutionApi.getInfo()},t,c.Async.OperationRetrier.RetryStrategy.conditional(this._retryWhen,c.Async.OperationRetrier.RetryStrategy.linear(3,3e3))),[2,t.do(function(t){c.Async.isError(t)&&1===t.attempt?e._log.info("institutionError: Failed to get institution info from first try",t.error):c.Async.isFatal(t)&&e._log.warn("institutionError: Can not get institution info",t.error)}).filter(c.Async.isTerminated).map(function(t){return c.Async.isFatal(t)?s.Institution.emptyInfo:t.value}).first().toPromise()]})})},t.prototype._gotoLogin=function(){document.location.href=this._signinUrl},t.prototype._gotoFreePage=function(){this._navigateToFreePage()},t.prototype._gotoMainPage=function(){document.location.href=this._mainPageUrl},t.prototype.logout=function(){var t,e=this,n=i.Atom.create(0),r=i.Atom.create(5),s=i.Atom.create(5),a=function(){return e._authApi.logout().catch(function(t){throw e._log.error("Logout error",t),t})},u=new o.Subject,l=function(){t.unsubscribe(),u.next(0),n.set(1),s.set(0),r.set(5)};this._modal.show({type:"inProgressSpinner"}),o.Observable.defer(a).retryWhen(function(i){return i.scan(function(t){return t+1},0).flatMap(function(i){if(i>10)throw s.set(-1),e._modal.hide(),e._overlay.show(),new Error("Logout retry limit exceeded");n.set(i);var a=Math.min(5*i,30);return r.set(a),s.set(a),t=o.Observable.interval(1e3).take(a).subscribe(function(){s.modify(function(t){return t-1}),0===s.get()&&u.next(0)}),u=new o.Subject})}).subscribe(function(){c.Extension.notifications.sendLogout(),e._gotoMainPage()},function(t){return e._log.error("Logout error",t)}),n.filter(function(t){return t>1}).first().subscribe(function(){return e._modal.notifications.show(e._modal.notifications.create.logoutError(l,s))})},t}();e.AuthenticationModelImpl=y},458:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(4),o=n(6),s=function(){function t(t,e){this._notification=t,this._overlay=e}return t.prototype.getDisposer=function(t,e){var n=this;return void 0===e&&(e={hideOverlay:!1}),function(){t&&n._notification.hide(t),e.hideOverlay&&n._overlay.hide()}},t}();e.ErrorHandler=s;var a=function(t){function e(e,n){return t.call(this,e,n)||this}return r.__extends(e,t),e.prototype.handle=function(t){switch(t.type){case"slow":return this.getDisposer(this._notification.show(this._notification.create.slowNetwork()));case"offline":return this._overlay.show(),this.getDisposer(this._notification.show(this._notification.create.offline(t.timer.resetClock,t.timer.reconnectTime)),{hideOverlay:!0});default:return o.assertNever(t)}},e}(s);e.NetworkErrorHandler=a;var c=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r._log=i.Monitoring.Logging.getLogger("connectivity.wsProtocol"),r}return r.__extends(e,t),e.prototype.handle=function(t){switch(this._log.info(t.type),t.type){case"offline":return this._overlay.show(),this.getDisposer(this._notification.show(this._notification.create.connectionWSError()),{hideOverlay:!0});default:return o.assertNever(t.type)}},e}(s);e.WsProtocolErrorHandler=c;var u=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o._authentication=r,o._log=i.Monitoring.Logging.getLogger("connectivity.dox"),o}return r.__extends(e,t),e.prototype.handle=function(t){switch(this._log.info(t.type),this._overlay.show(),t.type){case"unauthorized":return this._authentication.checkAuthenticated(),this.getDisposer(this._notification.show(this._notification.create.unauthorizedError()),{hideOverlay:!0});case"serverError":return this.getDisposer(this._notification.show(this._notification.create.serverError()),{hideOverlay:!0});case"blockedByClient":return this.getDisposer(this._notification.show(this._notification.create.connectionWSError()),{hideOverlay:!0});case"clientConnectionError":return this.getDisposer(this._notification.show(this._notification.create.clientConnectionError()),{hideOverlay:!0});case"unknownConnectionError":return this.getDisposer(this._notification.show(this._notification.create.unknownConnectionError()),{hideOverlay:!0});default:return o.assertNever(t.type)}},e}(s);e.DoxErrorHandler=u;var l=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r._log=i.Monitoring.Logging.getLogger("connectivity.capi"),r}return r.__extends(e,t),e.prototype.handle=function(t){switch(this._log.info(t.type),t.type){case"offline":return this.getDisposer(this._notification.show(this._notification.create.checkingIsDown()));default:return o.assertNever(t.type)}},e}(s);e.CapiErrorHandler=l},459:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(10),o=n(6),s=n(266),a=function(){function t(t){var e=this;this._handlers=t,this.onlineState=i.Atom.create({network:{type:s.ONLINE},dox:{type:s.ONLINE},wsProtocol:{type:s.ONLINE},wsDox:{type:s.ONLINE},wsCapi:{type:s.ONLINE}}),this.networkOnline=this.onlineState.view(function(t){return"offline"!==t.network.type}),o.invariant(!this._subscription,"ConnectivityModel already subscribed"),this.onlineState.pairwise().subscribe(function(t){var n=t[0],r=t[1],i=e._getNextOfflineKey(n),o=e._getNextOfflineKey(r);if(null===o)return void(e._dispose&&e._dispose());var s=r[o];i===o&&n[i].type===s.type||(e._dispose&&e._dispose(),"online"!==s.type&&(e._dispose=e._handlers[o].handle(s)))})}return t.prototype.setState=function(t){var e=t.type,n=t.state;this.onlineState.modify(function(t){return r.__assign({},t,(i={},i[e]=n,i));var i})},t.prototype._getNextOfflineKey=function(t){if("offline"===t.network.type)return"network";if(t.wsProtocol.type!==s.ONLINE)return"wsProtocol";if(t.dox.type!==s.ONLINE)return"dox";if(t.wsDox.type!==s.ONLINE)return"wsDox";if(t.wsCapi.type!==s.ONLINE)return"wsCapi";if("slow"===t.network.type)return"network";var e=Object.keys(t).find(function(e){return"online"!==t[e].type});if(e)throw new o.InvariantError("Expected that state is online but got '"+e+"' is '"+t[e].type+"'");return null},t}();e.ConnectivityModelImpl=a},460:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(24),i=n(10),o=n(4),s=n(160),a=n(6),c=10,u=5e3,l={method:"HEAD",mode:"cors"},h=function(){function t(t,e){var n=this;this._connectivity=t,this._onlineTestUrl=e,this._log=o.Monitoring.Logging.getLogger("networkConnectivity"),this._online=i.Atom.create("online"),this.check=a.throttleByPromise(function(){return n._checkRequest().then(n._setOnline).catch(function(){n._log.info("Online check failed, switching to offline state"),n._setOffline(n.check)})}),this.getOnlineStatus=function(){return n._online.get()},this.checkOnlineStatus=function(){return n.check().then(n.getOnlineStatus)},this._startReconnectTimer=function(t){n._stopTimer();var e=i.Atom.create(c),o=function(){e.set(c),t&&t()};n._reconnectTimer=r.Observable.interval(1e3).subscribe(function(){e.get()<=1&&t&&t(),e.modify(function(t){return t<=1?c:t-1})}),n._timer={resetClock:o,reconnectTime:e}},this._setOnline=function(){n._stopTimer(),n._online.modify(n._toSlowOrOnline)},this._setOffline=function(t){"offline"!==n._online.get()&&(n._startReconnectTimer(t),n._online.modify(n._toOffline))},this._checkRequest=function(){return a.Async.promiseWithTimeout(s.RxFetch.nativeFetch(n._onlineTestUrl+"?_="+Date.now(),l),u)},this._online.subscribe(function(t){switch(t){case"online":n._log.info("Switch back to online state"),n._connectivity.setState({type:"network",state:{type:"online"}});break;case"slow":n._connectivity.setState({type:"network",state:{type:"slow"}});break;case"offline":n._connectivity.setState({type:"network",state:{type:"offline",timer:n._timer}});break;default:a.assertNever(t)}}),this._online.filter(function(t){return"slow"!==t}).switchMap(function(t){return"offline"===t?r.Observable.empty():s.RxFetch.requestResults.filter(function(t){return"timeoutWarn"===t.type}).do(function(){n._online.modify(n._toSlow)}).switchMap(function(){return r.Observable.of(!1).delay(s.RxFetch.FETCH_TIMEOUT)})}).subscribe(function(){return n._online.modify(n._toOnline)}),r.Observable.fromEvent(window,"online").subscribe(this._setOnline),r.Observable.fromEvent(window,"offline").mapTo(void 0).subscribe(this._setOffline),this._online.switchMap(function(t){return"offline"===t?s.RxFetch.requestResults.filter(function(t){return"success"===t.type}):r.Observable.merge(s.RxFetch.requestResults.filter(function(t){var e=t.type;return"clientError"===e||"timeoutWarn"===e||"timeoutError"===e}),n._connectivity.onlineState.skip(1).filter(function(t){var e=t.dox,n=t.wsDox;return"online"!==t.wsCapi.type||"online"!==e.type||"online"!==n.type}))}).debounceTime(1e3).subscribe(this.check)}return t.prototype._stopTimer=function(){this._reconnectTimer&&(this._reconnectTimer.unsubscribe(),this._reconnectTimer=null)},t.prototype._toSlow=function(t){return"online"===t?"slow":t},t.prototype._toOnline=function(t){return"online"},t.prototype._toSlowOrOnline=function(t){return"offline"===t?"online":t},t.prototype._toOffline=function(t){return"offline"},t}();e.NetworkConnectivityModelImpl=h},461:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(10),o=n(266),s=n(6),a=function(){function t(t,e){var n=this;this._connectivity=t,this._wsHandlers=e,this._wsState=i.Atom.create({wsDox:{type:o.ONLINE},wsCapi:{type:o.ONLINE}}),this._getChangedState=function(t){var e=t[0],r=t[1],i=Object.keys(e).find(function(t){return n._wasChanged(e,r,t)});return s.invariant(!!i,"WsState must be changed"),{type:i,state:r[i]}},this._handleStateChange=function(t){var e=t.type,r=t.state;r.type===o.ONLINE?n._connectivity.setState({type:e,state:{type:"online"}}):n._wsHandlers[e].handle(r)},this._wsState.pairwise().map(this._getChangedState).subscribe(this._handleStateChange)}return t.prototype.setState=function(t){var e=t.type,n=t.state;this._wsState.modify(function(t){return r.__assign({},t,(i={},i[e]=n,i));var i})},t.prototype._wasChanged=function(t,e,n){return t[n].type!==e[n].type},t}();e.WsConnectivityModelImpl=a},462:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(89),o=n(6),s=n(395),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e}(o.CustomError),c=function(){function t(t,e){var n=this;this.networkState=t,this.connectivity=e,this.checkWs=function(){return"offline"===n.networkState.getOnlineStatus()?Promise.resolve():n._wsTest().catch(n._checkOnline)},this._wsTest=function(){return Promise.race([new Promise(function(t,e){var n=o.getWebSocket(i.appConfig.api.wsTest);if(!n)throw new a("Socket is not accessible");n.onmessage=function(){try{n.close(),t()}catch(t){e(t)}},n.onerror=function(t){return e(t)}}),s.timeoutLimit(s.TIMEOUT)])},this._checkOnline=function(){return n.networkState.checkOnlineStatus().then(function(t){return"offline"===t?Promise.resolve():Promise.reject(new a("Websocket test failed while network test passed"))})}}return t}();e.WsErrorHandler=c;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.handle=function(t){var e=this;switch(t.type){case"unknownConnectionError":case"clientConnectionError":case"blockedByClient":this.checkWs().then(function(){return e.connectivity.setState({type:"wsDox",state:{type:t.type}})}).catch(function(){e.connectivity.setState({type:"wsProtocol",state:{type:"offline"}})});break;case"serverError":case"unauthorized":this.connectivity.setState({type:"wsDox",state:{type:t.type}});break;default:o.assertNever(t.type)}},e}(c);e.WsDoxErrorHandler=u;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.handle=function(t){var e=this;switch(t.type){case"offline":this.checkWs().then(function(){return e.connectivity.setState({type:"wsCapi",state:{type:t.type}})}).catch(function(){e.connectivity.setState({type:"wsProtocol",state:{type:"offline"}})});break;default:o.assertNever(t.type)}},e}(c);e.WsCapiErrorHandler=l},463:function(t,e,n){"use strict";function r(t){for(var e=0,n=Array.from(c.keys());e<n.length;e++){var r=n[e],i=new RegExp(r.replace("*","[\\w/]+"));if(t.match(i))return c.get(r)}throw new Error("pname doesn't match any of regexps")}function i(t){var e=r(t);if(!e)throw new Error("pname "+t+" should have a mapping");return e}function o(t,e){void 0===e&&(e=function(t){return t});try{return e(i(t))}catch(e){return void s.Monitoring.Logging.getLogger("model.denali.alert_to_lens").info("Can't find lens by pname",e,{pname:t})}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(4),a=n(1129),c=new Map;for(var u in a)!function(t){a[t].forEach(function(e){var n=e.title,r=e.rank,i=e.description;e.cards.forEach(function(e){c.set(e,{title:n,type:t,rank:r,description:i,key:n.replace(" ","_")})})})}(u);e.Lenses=Array.from(c.values()).filter(function(t,e,n){return n.findIndex(function(e){return e.key===t.key})===e}),e.pnameToLensUnsafe=i,e.pnameToLensProp=o},464:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(10),i=n(24);e.defaultState={textScrollPosition:0};var o=function(){function t(){this.textScrollPosition=new i.Subject,this.sidebarScrollTopOffset=new i.Subject,this.viewportSize=r.Atom.create({top:0,height:0,scrollTop:0,left:0}),this.sidebarScrollBy=new i.Subject,this._textScrollOffsetReset=new i.Subject}return t.prototype.setTextScrollPosition=function(t){this.textScrollPosition.next(t)},t.prototype.clearTextScrollPosition=function(){this._textScrollOffsetReset.next(0)},t.prototype.createTextScrollOffset=function(t){var e={negativeTop:0,bottom:0};return i.Observable.merge(this._textScrollOffsetReset.mapTo(e),this.textScrollPosition.map(function(e){return{negativeTop:Math.max(-e,0),bottom:Math.max(e-t(),0)}}).startWith(e)).distinctUntilChanged()},t.prototype.ensureCardIsInSidebarViewport=function(t){var e=t.top,n=t.height,r=this.viewportSize.get();if(e<52)return this.sidebarScrollTopOffset.next(r.scrollTop+e-52),52;if(e+n>r.height){var i=r.height-n<52?r.height-52:n;return this.sidebarScrollTopOffset.next(r.scrollTop+(e+i-r.height)),r.height-i}return e},t.prototype.setViewportSize=function(t,e,n,r){this.viewportSize.set({top:t,left:e,height:n,scrollTop:r})},t.prototype.scrollBy=function(t){this.sidebarScrollBy.next(t)},t}();e.DenaliScrollModelImpl=o},465:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(24),i=function(){function t(){var t=this;this.scrollTo=new r.Subject,this.focused=new r.Subject,this.focusedEvent=function(e){var n=e.target;"TEXTAREA"!==n.tagName&&"INPUT"!==n.tagName&&t.focused.next()}}return t.prototype.nextCursorPosition=function(t){var e=.7*Math.max(document.documentElement.clientHeight,window.innerHeight||0);t.top>e&&this.scrollTo.next(Math.round(t.top-e))},t}();e.DenaliEditorViewModel=i},466:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(10),i=n(6);e.defaultState={dictionary:null,status:i.Async.defaultValue()};var o=function(){function t(t,e){this._state=t,this._api=e,this.dictionary=this._state.lens(function(t){return t.dictionary}),this.syncStatus=this._state.lens(function(t){return t.status}),this.isInProgress=this.syncStatus.view(function(t){return t.status===i.Async.Status.inProgress}),this.ready=this.dictionary.view(function(t){return null!==t}),this.isReadyOrError=r.Atom.combine(this.ready,this.syncStatus,function(t,e){return t||e.status===i.Async.Status.error}),this.isNotReadyOrInProgres=r.Atom.combine(this.ready,this.isInProgress,function(t,e){return!t||e})}return t.prototype.ensureReady=function(){var t=this;return this.ready.get()||this.isInProgress.get()?Promise.resolve():i.Async.runWithTimeout(function(){return t._api.get().then(function(e){return t.dictionary.set(e)})},this.syncStatus)},t.prototype.add=function(t){var e=this;return i.Async.modifyRemoteState(this.dictionary,function(e){return[t].concat(e||[])},function(){return i.Async.runWithTimeout(function(){return e._api.add(t).then(function(t){return Promise.resolve()})},e.syncStatus)})},t.prototype.remove=function(t){var e=this;return i.Async.modifyRemoteState(this.dictionary,function(e){return(e||[]).filter(function(e){return e!==t})},function(){return i.Async.runWithTimeout(function(){return e._api.delete(t).then(function(t){return Promise.resolve()})},e.syncStatus)})},t}();e.DictionaryModelImpl=o},467:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=n(10),o=n(4),s=n(240),a=n(161),c=n(6);!function(t){t[t.documentTypeUnsupported=0]="documentTypeUnsupported",t[t.documentIsEmpty=1]="documentIsEmpty",t[t.documentSizeExceeded=2]="documentSizeExceeded",t[t.noFilesToUpload=3]="noFilesToUpload",t[t.onlyOneDocumentAllowed=4]="onlyOneDocumentAllowed"}(r||(r={}));var u=function(t){return t&&a.Documents.ACCEPTED_UPLOAD_EXTENSIONS.some(function(e){return t.endsWith(e)})},l=function(){return c.Async.defaultValue()},h=function(){function t(t,e,n,r){var o=this;this._upload=t,this._navigateToDocument=e,this._notifications=n,this._telemetry=r,this._state=i.Atom.create(l()),this._inBackground=!1,this.state=this._state.view(),this._state.filter(function(t){return c.Async.isTerminated(t)}).subscribe(function(t){if(c.Async.isOk(t)){var e=t.value.id;o._inBackground?o._notifications.show(o._notifications.create.documentUploaded(function(){return o._navigateToDocument(e)})):o._navigateToDocument(e)}else o._handleError(t.error);o._state.set(l())})}return t.prototype.upload=function(t){var e=this;if(c.Async.isInProgress(this._state.get())){var n={type:"clientError",errorType:r.onlyOneDocumentAllowed};return this._handleError(n),Promise.resolve(c.Either.left(n))}this._inBackground=!1,this._state.modify(c.Async.begin);var i=this._validateFile(t);if(i){var o={type:"clientError",errorType:i};return this._state.modify(c.Async.fatal(o)),Promise.resolve(c.Either.left(o))}var s=t[0];return this._upload(s).then(function(t){var n={id:String(t.id)};return e._state.modify(c.Async.success(n)),e._telemetry.uploadDocument(!0),c.Either.right(n.id)}).catch(function(t){var n={type:"serverError",error:t};return e._state.modify(c.Async.fatal(n)),c.Either.left(n)})},t.prototype.navigated=function(){this._inBackground=!0},t.prototype._handleError=function(t){"clientError"===t.type?this._handleClientError(t):this._handleServerError(t)},t.prototype._handleServerError=function(t){var e=t.error;o.Monitoring.Logging.getLogger("document.upload").error("uploadDocument failed",e),e instanceof s.FileSizeOutOfRangeError?(this._telemetry.uploadDocument(!1,"serverError",r[r.documentSizeExceeded]),this._notifications.show(this._notifications.create.documentSizeExceeded())):e instanceof s.UnsupportedFileTypeError?(this._telemetry.uploadDocument(!1,"serverError",r[r.documentTypeUnsupported]),this._notifications.show(this._notifications.create.documentTypeUnsupported())):e instanceof s.TrackedChangesIsUnsupported?(this._telemetry.uploadDocument(!1,"serverError",e.message),this._notifications.show(this._notifications.create.trackedChangesIsUnsupported())):e instanceof s.TooManyRequestsError?(this._telemetry.uploadDocument(!1,"serverError",e.message),this._notifications.show(this._notifications.create.tooManyRequestsError())):(this._telemetry.uploadDocument(!1,"serverError",e&&e.message),this._notifications.show(this._notifications.create.documentUploadGeneralError()))},t.prototype._handleClientError=function(t){var e=t.errorType;switch(this._telemetry.uploadDocument(!1,"clientError",r[e]),e){case r.documentTypeUnsupported:this._notifications.show(this._notifications.create.documentTypeUnsupported());break;case r.documentIsEmpty:this._notifications.show(this._notifications.create.documentIsEmpty());break;case r.documentSizeExceeded:this._notifications.show(this._notifications.create.documentSizeExceeded());break;case r.noFilesToUpload:this._notifications.showMessage("No files to upload!");break;case r.onlyOneDocumentAllowed:this._notifications.showMessage("Only one document upload at a time is allowed");break;default:c.assertNever(e)}},t.prototype._validateFile=function(t){var e=t?t[0]:null;return e?t&&t.length>1?r.onlyOneDocumentAllowed:u(e.name)?e.size?e.size>4194304?r.documentSizeExceeded:null:r.documentIsEmpty:r.documentTypeUnsupported:r.noFilesToUpload},t}();e.UploadModel=h},468:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(24),o=n(10),s=n(42),a=n(4),c=n(6);e.ACCEPTED_UPLOAD_EXTENSIONS=["doc","docx","odt","rtf","htm","html","txt"].map(function(t){return"."+t}),e.ACCEPTED_UPLOAD_MIME_TYPES=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.oasis.opendocument.text","text/rtf","text/html","text/plain"],e.defaultState={searchText:"",wsConnection:c.Async.defaultValue(),proofitResults:{},deletedDocumentIds:[],first100:c.Async.defaultValue(),remoteSearch:c.Async.defaultValue()};var u=100,l=function(){function t(t,e){this._doxApi=t,this._state=e,this._log=a.Monitoring.Logging.getLogger("model.documents.proofit"),this._operation=null,this.results=this._state.lens(function(t){return t.proofitResults}),this.cancelled=new i.Subject,this.wsConnection=this._state.lens(function(t){return t.wsConnection})}return t.prototype.init=function(){var t=this;c.invariant(null===this._operation,"Expect operation to be not established"),this._operation=c.Async.OperationRetrier.create(function(){return t._connect()},this.wsConnection)},t.prototype.reset=function(){var t=this.wsConnection.get();c.Async.isOk(t)?this._terminate(t.value):this._operation&&this._operation.unsubscribe(),this._operation=null,this.wsConnection.set(e.defaultState.wsConnection)},t.prototype._connect=function(){var t=this;return this._doxApi.openDocumentsWS(function(e,n){t.results.modify(function(t){return Object.assign({},t,(r={},r[e]=n.proofit,r));var r}),n.proofit&&n.proofit.status===s.ProofitJobStatus.cancelled&&t.cancelled.next({id:e})}).then(function(t){return{unsubscribe:t.close.bind(t)}})},t.prototype._terminate=function(t){return r.__awaiter(this,void 0,void 0,function(){var n;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.results.set(e.defaultState.proofitResults),this.cancelled.next({id:null}),[4,t.unsubscribe()];case 1:return r.sent(),[3,3];case 2:throw n=r.sent(),this._log.error("Failed to close dox session",n),n;case 3:return[2]}})})},t}();e.DocumentListProofitModelImpl=l;var h=function(){function t(t,e,n,r,i){var l=this;this._state=t,this._doxApi=e,this._settings=n,this._connectivity=r,this._handleHttpDoxError=i,this._log=a.Monitoring.Logging.getLogger("model.documents.list"),this._isLocalSearch=o.Atom.create(!1),this._first100=this._state.lens(function(t){return t.first100}),this._remoteSearch=this._state.lens(function(t){return t.remoteSearch}),this._deletedDocumentIds=this._state.lens(function(t){return t.deletedDocumentIds}),this.searchText=this._state.lens(function(t){return t.searchText}),this._trimmedSearchText=this.searchText.view(function(t){return t.trim()}),this.isFirstTimeLoaded=this._first100.view(c.Async.isOk),this.isSearching=this._remoteSearch.view(function(t){return c.Async.isInProgress(t)||c.Async.isError(t)}),this.searchResults=o.Atom.combine(this._first100,this._remoteSearch,this._deletedDocumentIds,this._trimmedSearchText,function(t,e,n,r){return c.Async.flatMap(t,function(t){return c.Async.isTerminated(e)?c.Async.flatMap(e,function(e){return c.Async.ok(l._localSearch(t,e||[],n,r))}):c.Async.ok(l._localSearch(t,[],n,r))})}),this._retryWhen=function(t){return!(t instanceof s.HTTPError)||c.isServerErrorCode(t.code)},this._documentSubs=[],this._settings.firstCall.get()||this._first100.filter(c.Async.isOk).first().subscribe(function(){l._settings.firstCallDone()}),this._first100.filter(function(t){return c.Async.isOk(t)}).subscribe(function(t){return l._isLocalSearch.set(t.value.length<u)}),this.searchResults.filter(function(t){return c.Async.isError(t)||c.Async.isFatal(t)}).subscribe(function(t){c.Async.isFatal(t)?(t instanceof s.HTTPError?l._handleHttpDoxError(t.error,"DOX: Cannot load document list"):l._connectivity.setState({type:"dox",state:{type:c.isServerErrorCode(t.error.code)?"serverError":"unknownConnectionError"}}),l._log.error("DOX: Cannot load document list",t.error)):c.Async.isError(t)&&l._log.warn("DOX: Attempt to load document list failed",t.error,{attempt:t.attempt})})}return t.prototype.load=function(){this._reset(),this._loadDocuments()},t.prototype.reset=function(){this._documentSubs.map(function(t){return t.unsubscribe()}),this._documentSubs=[],this._reset()},t.prototype._reset=function(){this.searchText.set(e.defaultState.searchText),this._isLocalSearch.set(!1),this._remoteSearch.set(c.Async.defaultValue()),this._first100.set(c.Async.defaultValue())},t.prototype._loadDocuments=function(){var t=this,e=o.Atom.create(!1);this._documentSubs=[c.Async.OperationRetrier.create(function(){return t._doxApi.listDocuments(u,s.OrderBy.Updated,!t._settings.firstCall.get())},this._first100,c.Async.OperationRetrier.RetryStrategy.conditional(this._retryWhen,c.Async.OperationRetrier.RetryStrategy.linear(3,3e3))),this._trimmedSearchText.withLatestFrom(this._first100,e).filter(function(t){return!t[0]}).throttleTime(1e3).filter(function(t){var e=(t[0],t[1]),n=t[2];return c.Async.isTerminated(e)&&!n}).subscribe(function(){e.set(!0),t._doxApi.listDocuments(u,s.OrderBy.Updated,!1).then(function(e){return t._first100.set(c.Async.ok(e))}).catch(function(e){e instanceof s.HTTPError&&t._handleHttpDoxError(e,"Failed to refresh document list"),t._log.info("Failed to refresh document list",e)}).then(function(){e.set(!1)})}),this._isLocalSearch.switchMap(function(e){return e?i.Observable.empty():i.Observable.merge(t._trimmedSearchText.map(function(t){return c.Either.left(t)}),t._trimmedSearchText.debounceTime(500).map(function(t){return c.Either.right(t)})).switchMap(function(e){return t._remoteSearch.set(c.Async.defaultValue()),c.Either.isLeft(e)||!e.value?i.Observable.empty():i.Observable.using(function(){return c.Async.OperationRetrier.create(function(){return t._doxApi.searchDocument(s.SearchRequest.contains(e.value),u)},t._remoteSearch,c.Async.OperationRetrier.RetryStrategy.conditional(t._retryWhen,c.Async.OperationRetrier.RetryStrategy.linear(3,3e3)))},function(){return t._remoteSearch.filter(c.Async.isTerminated).first()})})}).subscribe()]},t.prototype._localSearch=function(t,e,n,r){var i=new RegExp(r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");return e.concat(t.filter(function(t){return!r||i.test(t.firstContent)||i.test(t.title)}).filter(function(t){return-1===e.findIndex(function(e){return e.id===t.id})})).filter(function(t){return n.indexOf(t.id)<0})},t}(),d=function(){function t(t,e,n,r,i,s,c,u,l){this._state=t,this._doxApi=e,this._alertCache=n,this._navigateToDocument=r,this._notifications=i,this._connectivity=s,this.browser=c,this._enableTrackingOnDownload=u,this._handleHttpDoxError=l,this._log=a.Monitoring.Logging.getLogger("model.documents.actions"),this._deletedDocumentIds=this._state.lens(function(t){return t.deletedDocumentIds}),this.documentUploadProgress=o.Atom.create(null)}return t.prototype.createDocument=function(t,e){return this._doxApi.createDocument(s.CreateRequest.text(t,e))},t.prototype.createDocumentAndNavigate=function(t){var e=this;return this.createDocument().then(function(n){t.get()?e.navigateToDocument(n.id):e._notifications.show(e._notifications.create.newDocumentCreated(function(){return e.navigateToDocument(n.id)}))}).catch(function(t){return e.handleCreateDocumentError(t)})},t.prototype.deleteDocument=function(t){var e=this;return this._deletedDocumentIds.modify(function(e){return e.concat([t])}),this._doxApi.deleteDocumentById(t).catch(function(n){throw e._deletedDocumentIds.modify(function(e){return e.filter(function(e){return e!==t})}),n}).then(function(n){try{e._alertCache.remove(t.toString())}catch(t){e._log.debug("could not remove alert cache for deleted doc",t)}})},t.prototype.restoreDocument=function(t){var e=this;return this._deletedDocumentIds.modify(function(e){return e.filter(function(e){return e!==t})}),this._doxApi.restoreDocumentById(t).catch(function(n){throw e._deletedDocumentIds.modify(function(e){return e.concat([t])}),n instanceof s.HTTPError&&e._handleHttpDoxError(n,"Failed to restore document"),n})},t.prototype.getDownloadUrl=function(t){return this._doxApi.downloadLink(t,this._enableTrackingOnDownload)},t.prototype.uploadDocument=function(t){return r.__awaiter(this,void 0,void 0,function(){var e=this;return r.__generator(this,function(n){switch(n.label){case 0:return[4,this._doxApi.createDocument(s.CreateRequest.file(t)).then(function(t){return e._state.lens(function(t){return t.first100}).modify(function(e){return c.Async.isOk(e)?c.Async.ok(new Array(t).concat(e.value)):e}),t})];case 1:return[2,n.sent()]}})})},t.prototype.navigateToDocument=function(t){this._navigateToDocument(""+t)},t.prototype.handleCreateDocumentError=function(t){t instanceof s.HTTPError?(this._handleHttpDoxError(t,"Failed to create new document"),this._log.warn("Failed to create new document",t)):c.isClientFetchError(t)?(this._log.warn("Failed to create new document",t),this._notifications.showError("Failed to create new document: "+(t&&t.message))):(this._log.error("Failed to create new document",t),this._notifications.showError("Failed to create new document: "+(t&&t.message)))},t.prototype.handleDeleteDocumentError=function(t){t instanceof s.HTTPError&&(this._handleHttpDoxError(t,"Failed to remove document"),this._log.error("Failed to remove document",t))},t}(),p=function(){function t(t,e,n,r,i,o,s,a,c){this._state=t,this._doxApi=e,this._settings=n,this._alertCache=r,this._browser=i,this._connectivity=o,this._notifications=s,this._navigateToDocument=a,this._enableTrackingOnDownload=c,this.proofit=new l(this._doxApi,this._state),this.list=new h(this._state,this._doxApi,this._settings,this._connectivity,this._doxHttpErrorHandler),this.actions=new d(this._state,this._doxApi,this._alertCache,this._navigateToDocument,this._notifications,this._connectivity,this._browser,this._enableTrackingOnDownload,this._doxHttpErrorHandler)}return t.prototype._doxHttpErrorHandler=function(t,e){switch(t.code){case s.DoxAjaxErrorCodes.UNAUTHORIZED:this._connectivity.setState({type:"dox",state:{type:"unauthorized"}});break;case s.DoxAjaxErrorCodes.TOO_MANY_REQUESTS:this._notifications.show(this._notifications.create.tooManyRequestsError());break;default:this._notifications.showError(t.message)}},t}();e.DocumentsPageModelImpl=p},469:function(t,e,n){"use strict";function r(t,e){function n(r){try{return t()}catch(t){if(r<e.length)return e[r](),n(r+1);throw t}}return n(0)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),o=n(6),s=function(){function t(t,e,n,r,s,a){void 0===s&&(s=o.LocalStorage.DenaliStorage.fromLocalStorage(o.LocalStorage.ls)),void 0===a&&(a=12096e5),this._deserializeAlerts=t,this._serializeAlerts=e,this._storageNamePrefix=n,this._storageAlertVersion=r,this._storage=s,this._maxCacheAgeMs=a,this._log=i.Monitoring.Logging.getLogger("model.editor.alert_cache"),this._alertCacheKeyRe=new RegExp(o.StringUtils.escapeRegExp(this._getStorageKeyPrefix())+"-.+"),this._oldAlertsCacheKeyRe=new RegExp(o.StringUtils.escapeRegExp(this._storageNamePrefix)+"(?!"+o.StringUtils.escapeRegExp(this._storageAlertVersion)+")");try{this._pruneOldVersions()}catch(t){this._log.debug("could not clean old versions alerts",t)}}return t.prototype._decodeCacheItem=function(t){var e=this,n=t.match(/([^;]+);([^;]+);([^;]+);(.*)/);if(!n)throw new TypeError("unexpected value content");var r=n.splice(1,5).map(function(t){return JSON.parse(t)}),i=r[0],s=r[1],a=r[2],c=r[3];if(void 0!==i&&"number"==typeof i&&void 0!==s&&void 0!==a&&"boolean"==typeof a&&void 0!==c&&Array.isArray(c)){var u=o.lazy(function(){return e._deserializeAlerts(c)});return{timeStamp:i,dialect:s,isFreeUser:a,get alerts(){return u.value}}}throw new TypeError("unexpected value content")},t.prototype._encodeCacheItem=function(t){var e=t.timeStamp,n=t.dialect,r=t.isFreeUser,i=t.alerts;return[e,n,r,this._serializeAlerts(i)].map(function(t){return JSON.stringify(t)}).join(";")},t.prototype._getStorageKeyPrefix=function(){return this._storageNamePrefix+this._storageAlertVersion},t.prototype._getStorageKeyForDoc=function(t){return this._getStorageKeyPrefix()+"-"+t},t.prototype._isAlertCacheKey=function(t){return this._alertCacheKeyRe.test(t)},t.prototype._isOldAlertCacheKey=function(t){return this._oldAlertsCacheKeyRe.test(t)},t.prototype._saveAlerts=function(t,e,n,r){var i=this._encodeCacheItem({timeStamp:Date.now(),dialect:e,isFreeUser:n,alerts:r});this._storage.setItem(this._getStorageKeyForDoc(t),i)},t.prototype._loadAlerts=function(t,e,n){var r=this._storage.getItem(this._getStorageKeyForDoc(t));if(r.isEmpty())return null;var i=void 0;try{i=this._decodeCacheItem(r.get())}catch(e){try{this._removeAlerts(t)}catch(t){this._log.debug("could not remove broken cache item",t)}return null}if(i.isFreeUser===n&&i.dialect===e)return i.alerts;try{this._removeAlerts(t)}catch(t){this._log.debug("could not remove cache for a user of different type",t)}return null},t.prototype._removeAlerts=function(t){this._storage.removeItem(this._getStorageKeyForDoc(t))},t.prototype._pruneOldEditor=function(){var t=this;this._storage.getKeys().filter(function(t){return/matches_\d+/.test(t)}).forEach(function(e){return t._storage.removeItem(e)})},t.prototype._getAlertCacheKeys=function(){var t=this;return this._storage.getKeys().filter(function(e){return t._isAlertCacheKey(e)})},t.prototype._pruneOld=function(){var t=this,e=Date.now();this._getAlertCacheKeys().forEach(function(n){var r=t._storage.getItem(n);if(!r.isEmpty()){var i=void 0;try{i=t._decodeCacheItem(r.get())}catch(e){return void t._storage.removeItem(n)}e-i.timeStamp>t._maxCacheAgeMs&&t._storage.removeItem(n)}})},t.prototype._pruneAll=function(){var t=this;this._getAlertCacheKeys().forEach(function(e){return t._storage.removeItem(e)})},t.prototype._pruneOldVersions=function(){var t=this;this._storage.getKeys().filter(function(e){return t._isOldAlertCacheKey(e)}).forEach(function(e){return t._storage.removeItem(e)})},t.prototype.load=function(t,e,n){return this._loadAlerts(t,e,n)},t.prototype.save=function(t,e,n,i){var o=this;try{return r(function(){return o._saveAlerts(t,e,n,i)},[function(){return o._pruneOldEditor()},function(){return o._pruneOld()},function(){return o._pruneAll()}])}catch(t){this._log.warn("Cannot write to localStorage",t)}},t.prototype.remove=function(t){this._removeAlerts(t)},t}();e.AlertCacheImpl=s},470:function(t,e,n){"use strict";function r(t,e){var n=t.extra_properties&&t.extra_properties[e];return o.Option.of(n)}function i(t){var n=t.rawMatch,i=r(n,"source").filter(function(t){return"PUBLICATION"===t}),a=r(n,"title"),c=i.fold(function(){return o.Option.some("A part of your paper is matching some text from the web. Please make sure that this text is properly referenced.")},function(){return a.map(function(t){return'A part of your document is matching the publication "'+t+'."'})}),u=i.fold(function(){return o.Either.left({title:a,dateAccessed:e.parseDateAccessed(n.details)})},function(){return o.Either.right({mla:r(n,"reference_mla"),apa:r(n,"reference_apa"),chicago:r(n,"reference_chicago")})});return{title:"Unoriginal text: "+s.StringUtils.wordCount(n.text)+" words",description:c,url:r(n,"url").filter(function(t){return t.length>0}),reference:u}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(35),s=n(6);e.parseDateAccessed=function(t){void 0===t&&(t="");var e=t.match(/accessed\s(.*?)\)/);return o.Option.of(e).mapN(function(t){return t[1]})},e.parsePlagiarism=i},471:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(24),i=n(10),o=n(6),s=function(){function t(t,e,n){void 0===e&&(e=1e3),void 0===n&&(n=function(t,e){return t===e}),this._commitLocalChanges=t,this._bufferTimeMsec=e,this._equals=n,this._localChangeSink=new r.Subject,this._localChangeHandleSub=null,this._localChangePending=i.Atom.create(!1),this._unsavedLocalChangeCount=i.Atom.create(0),this._flushSink=new r.Subject,this.hasUnsavedChanges=i.Atom.combine(this._localChangePending,this._unsavedLocalChangeCount,function(t,e){return t||0!==e})}return t.prototype._handleLocalContentChange=function(t){var e=this;return this._unsavedLocalChangeCount.modify(function(t){return t+1}),this._localChangePending.set(!1),this._commitLocalChanges(t).then(function(t){return e._unsavedLocalChangeCount.modify(function(t){return t-1})})},t.prototype._bufferLocalChangesSync=function(){var t=this;return this._localChangeSink.distinctUntilChanged(this._equals).do(function(e){return t._localChangePending.set(!0)}).sample(r.Observable.interval(this._bufferTimeMsec).merge(this._flushSink)).distinctUntilChanged(function(e,n){var r=t._equals(e,n);return r&&t._localChangePending.set(!1),r}).concatMap(function(e){return t._handleLocalContentChange(e)}).subscribe()},t.prototype.setLocalValue=function(t){this._localChangeSink.next(t)},t.prototype.startSyncing=function(){o.invariant(null===this._localChangeHandleSub,"already syncing"),this._localChangeHandleSub=this._bufferLocalChangesSync()},t.prototype.stopSyncing=function(){if(!this._localChangeHandleSub)throw new o.InvariantError("already not syncing");this._localChangeHandleSub.unsubscribe(),this._localChangeHandleSub=null},t.prototype.syncNow=function(){this._flushSink.next(void 0)},t}();e.BufferedRemoteSync=s},472:function(t,e,n){"use strict";function r(t,e,n,r){switch(e.kind){case"common":return new o.CommonCardModelImpl(t,e,n,r);case"plagiarism":return new o.PlagiarismCardModelImpl(t,e,n);case"enhancement":return new o.EnhancementCardModelImpl(t,e,n,r);case"synonym":return new o.SynonymsCardModelImpl(t,e,n);default:var i=e;throw new a.MatchingNotExhaustiveError(i)}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),o=n(232),s=n(403),a=n(6);e.defaultState={cardHeights:{},cardStates:{}};var c=function(){function t(t,e,n){var r=this;this._state=t,this._editor=e,this._features=n,this._cardsHeights=this._state.lens(function(t){return t.cardHeights}),this._cardsState=this._state.lens(function(t){return t.cardStates}),this.positions=i.Atom.combine(this._editor.alerts,this._cardsHeights,function(t,e){return s.getCardsPositions(Object.keys(t).reduce(function(n,r){return n[r]={alert:t[r],cardHeight:e[r]||o.DEFAULT_CARD_HEIGHT},n},{}))}),this.focusedCardHeight=this._editor.focusedAlert.switchMap(function(t){return r._cardsHeights.view(function(e){return t.id?e[t.id]:null})}),this.guideId=i.Atom.combine(this._editor.highlightedAlert,this._editor.focusedAlert,function(t,e){if(!t)return null;var n=e.id&&r._cardsState.get()[e.id];return t===e.id&&!n||n&&n.transientVisualState!==o.VisualState.applied?null:t})}return t.prototype.setCardHeight=function(t,e){this._cardsHeights.modify(function(n){return Object.assign({},n,(r={},r[t]=e,r));var r})},t.prototype.getOrCreateCardModel=function(t){var e=this._editor.alerts.get()[t];a.invariant(null!==e,"expect alert #"+t+" to exist");var n="synonym"===e.alert.kind?o.defaultSynonymState:o.defaultState;return this._cardsState.modify(function(e){return e[t]?e:Object.assign({},e,(r={},r[t]=n,r));var r}),r(this._cardsState.lens(i.Lens.key(t).compose(i.Lens.withDefault(n))),e.alert,this._editor,this._features)},t.prototype.removeCardModelState=function(t){this._cardsState.modify(function(e){return a.ObjectUtils.objectWithoutProperties(e,[t])})},t}();e.CardsModelImpl=c},473:function(t,e,n){"use strict";function r(t,e){if(t<=0)return null;var n=e.filter(function(t){return t.group===s.AlertGroup.plagiarism}).reduce(function(t,e){return t+e.range.end-e.range.start},0);return Math.round(Math.min(100,n/t*100))}function i(t,e){var n=t>0?e.reduce(function(t,e){return t+(a[e.group]||0)},0)/t:null;return null!==n?Math.floor(100*(1-Math.min(1,11*n))):null}function o(t,e,n,o){var s=n.filter(function(t){return"synonym"!==t.kind}),a=n.filter(function(t){return"plagiarism"===t.kind}).length,c=s.filter(function(t){return t.isFree}).length;return{criticalAlerts:c,premiumAlerts:o-a,visiblePremiumAlerts:s.length-c-a,plagiarismPercentage:r(t,s),score:i(e,s)}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(76),a=(c={},c[s.AlertGroup.contextualSpelling]=1.2,c[s.AlertGroup.grammar]=1,c[s.AlertGroup.sentenceStructure]=.9,c[s.AlertGroup.punctuation]=.7,c[s.AlertGroup.style]=.3,c[s.AlertGroup.enhancement]=0,c[s.AlertGroup.plagiarism]=0,c);e.calculateScores=o;var c},474:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(24),o=n(42),s=n(267),a=n(6),c=n(4);!function(t){t[t.documentNotFound=0]="documentNotFound",t[t.unauthorized=1]="unauthorized",t[t.changed=2]="changed",t[t.disconnected=3]="disconnected",t[t.cannotReconnect=4]="cannotReconnect"}(e.DocEventType||(e.DocEventType={})),e.defaultState={session:null};var u=function(){function t(t,e,n,o,s,u){var l=this;this._docId=t,this._state=e,this._doxApi=n,this._doxConnectivity=o,this._networkOnline=s,this._preventSyncWithDox=u,this._sessionState=this._state.lens(function(t){return t.session}),this._session=null,this._remoteChangeSubject=new i.Subject,this._reconnect=function(t){return r.__awaiter(l,void 0,void 0,function(){var e,n;return r.__generator(this,function(r){switch(r.label){case 0:if(!this._session)throw new a.InvariantError("Expect remote session to be established");r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._connectToDox()];case 2:return e=r.sent().remoteDoc,this._session.setRemoteDocumentSession(e),null!==t&&e.setText(t),c.Monitoring.Logging.getLogger("model.editor.document_model").info("Dox connection restored"),[3,4];case 3:return n=r.sent(),this._doxConnectivity.set({type:"error",reason:"session reconnect",error:n}),[3,4];case 4:return[2]}})})}}return t.prototype.startSession=function(){return r.__awaiter(this,void 0,void 0,function(){var t,e,n,i=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._connectToDox()];case 1:return t=r.sent(),e=t.remoteDoc,n=t.doc,this._sessionState.set(s.createInitialState(this._docId,n.title,e.getText(),{source:"init",proofit:n.proofit})),this._session=new s.DocumentSessionImpl(this._sessionState,this._doxApi,e,n,this._remoteChangeSubject,this._doxConnectivity,function(){i._reconnectSubscription&&i._reconnectSubscription.unsubscribe()},this._preventSyncWithDox),[2,{documentSession:this._session,initialGenre:n.genre,initialChecks:n.checks}]}})})},t.prototype._connectToDox=function(){return r.__awaiter(this,void 0,void 0,function(){var t,e,n=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._doxApi.getDocumentById(this._docId)];case 1:return t=r.sent(),[4,this._doxApi.openDocumentById(this._docId,function(t,e){if(!n._session)throw new a.InvariantError("Expect remote session to be established");n._preventSyncWithDox||(n._session.localText.set(e),n._remoteChangeSubject.next(e))},function(t,e){if(!n._session)throw new a.InvariantError("Expect remote session to be established");n._session.proofitState.set({source:"websocket",proofit:e.proofit||null})},function(t,e,r){t.code!==o.DoxErrorCodes.NOT_FOUND&&t.code!==o.DoxErrorCodes.UNAUTHORIZED||n._doxConnectivity.set({type:"error",reason:t.reason,error:new o.WSError({code:t.code,message:t.reason,status:t.reason})}),o.RemoteDocument._defaultReconnect(t,e,r)})];case 2:return e=r.sent(),e.linkToDocument(t),this._scheduleReconnect(e),this._doxConnectivity.set({type:"success"}),[2,{remoteDoc:e,doc:t}]}})})},t.prototype._scheduleReconnect=function(t){var e=this,n=this._networkOnline.partition(Boolean),r=n[0],i=n[1];this._reconnectSubscription&&this._reconnectSubscription.unsubscribe(),this._reconnectSubscription=i.take(1).switchMap(function(){if(!e._session)throw new a.InvariantError("Expect remote session to be established");var n=e._session.localText.get();return t.close(),r.take(1).mapTo(n)}).subscribe(this._reconnect)},t}();e.DocumentModelImpl=u},475:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(10),o=n(42),s=n(4),a=n(126),c=n(6),u=n(474),l=n(268),h=n(168);e.defaultState={session:null,document:u.defaultState};var d=function(){function t(t,e,n,o,a,d,p,f,_,g,m,y){var v=this;this._state=t,this._dialectSettingsModel=e,this._doxApi=n,this._capiWsUrl=o,this._features=a,this._telemetry=d,this._modal=p,this._alertCache=f,this._wsConnectivity=_,this._connectivity=g,this._notifications=m,this._getContainerId=y,this._log=s.Monitoring.Logging.getLogger("model.editor.editor_page"),this._sessionState=this._state.lens(function(t){return t.session}),this.currentSession=i.Atom.create(null),this._doStartSession=function(t){return r.__awaiter(v,void 0,void 0,function(){var e,n,i,o,s,a,c;return r.__generator(this,function(r){switch(r.label){case 0:return e=new u.DocumentModelImpl(t,this._state.lens(function(t){return t.document}),this._doxApi,this._doxConnectivity,this._connectivity.networkOnline,this._features.isUserTesting.get()),[4,e.startSession()];case 1:return n=r.sent(),i=n.documentSession,o=n.initialGenre,s=n.initialChecks,this._sessionState.set(l.createDefaultState(o,s,this._features.defaultAcademicGenre.get().enabled)),a=this._sessionState,c=new l.EditorSessionImpl(a,i,new h.TextStatsModelImpl(a.lens(function(t){return t.textStats})),this._capiWsUrl,this._dialectSettingsModel,this._features,this._telemetry,this._alertCache,this._getContainerId,this._capiConnectivity),this._telemetry.documentShow(t.toString()),[2,c]}})})},this._connectionManager=new c.ConnectionManager(this._doStartSession,function(t){return t.end()},this.currentSession),this._capiConnectivity=i.Atom.create({type:"init"}),this._doxConnectivity=i.Atom.create({type:"init"}),this._subs=[]}return t.prototype.startSession=function(t){var e=this;if(isNaN(Number(t)))throw new Error("Invalid documentId");var n=i.Atom.create(c.Async.defaultValue());this._subs=[c.Async.OperationRetrier.create(function(){return e._connectionManager.terminate(),e._connectionManager.connect(t)},n,c.Async.OperationRetrier.RetryStrategy.conditional(this._retryWhen,c.Async.OperationRetrier.RetryStrategy.linear(5,3e3))),n.filter(function(t){return c.Async.isError(t)&&3===t.attempt||c.Async.isFatal(t)}).subscribe(function(t){e._doxConnectivity.set({type:"error",reason:"session open",error:t.error})}),n.filter(c.Async.isOk).take(1).subscribe(function(){e._doxConnectivity.set({type:"success"})}),this._connectivity.networkOnline.subscribe(function(t){return t?e.listenConnectivity():e.clearConnectivityListener()})]},t.prototype.endSession=function(){this._subs.forEach(function(t){return t.unsubscribe}),this._subs=[],this.clearConnectivityListener(),this._connectionManager.terminate()},t.prototype._doxErrorHandler=function(t){var e=t.reason,n=t.error,r={reason:e};if(n)if(n instanceof o.HTTPError)this._httpErrorHandler(n.code,e,n);else if(n instanceof o.WSError)this._wsErrorHandler(n.code,e,n);else if(n instanceof o.OTRemoveError)this._log.info("DOX connectivity error: reset message",n,r);else if(n instanceof a.FetchError){var i="clientConnectionError";this._log.warn("DOX connectivity error: "+i,n,r),this._connectivity.setState({type:"dox",state:{type:i}})}else{var i="unknownConnectionError";this._log.error("DOX connectivity error: "+i,n,r),this._connectivity.setState({type:"dox",state:{type:i}})}else this._log.error("DOX connectivity error: unknown",r)},t.prototype._httpErrorHandler=function(t,e,n){var r=this,i={code:t,reason:e},s=function(t){r._log.error("DOX connectivity error: "+t,n,i),r._connectivity.setState({type:"dox",state:{type:t}})};switch(t){case o.DoxAjaxErrorCodes.NOT_FOUND:this._log.info("DOX connectivity error",n,i),this._modal.show({type:"documentNotFound"});break;case o.DoxAjaxErrorCodes.UNAUTHORIZED:s("unauthorized");break;case o.DoxAjaxErrorCodes.TOO_MANY_REQUESTS:this._log.warn("Too many requests",n,i),this._notifications.show(this._notifications.create.tooManyRequestsError());break;default:s(c.isServerErrorCode(t)?"serverError":"unknownConnectionError")}},t.prototype._wsErrorHandler=function(t,e,n){var r=this,i={code:t,reason:e},s=function(t){r._log.error("WS DOX connectivity error: "+t,n,i),r._wsConnectivity.setState({type:"wsDox",state:{type:t}})};switch(t){case o.DoxErrorCodes.NOT_FOUND:this._log.info("WS DOX connectivity error",n,i),this._modal.show({type:"documentNotFound"});break;case o.DoxErrorCodes.UNAUTHORIZED:s("unauthorized");break;case o.DoxErrorCodes.BLOCKED_BY_CLIENT:s("blockedByClient");break;default:s([0,-1,1005,1006].indexOf(t)>0?"unknownConnectionError":"serverError")}},t.prototype.listenConnectivity=function(){var t=this;this._connectivitySubs=[this._doxConnectivity.distinctUntilChanged(function(t,e){return t instanceof o.WSError&&e instanceof o.WSError&&t===e}).subscribe(function(e){switch(e.type){case"error":t._doxErrorHandler(e);break;case"success":t._connectivity.setState({type:"dox",state:{type:"online"}}),t._wsConnectivity.setState({type:"wsDox",state:{type:"online"}});break;case"init":break;default:c.assertNever(e)}}),this._capiConnectivity.subscribe(function(e){switch(e.type){case"connected":t._wsConnectivity.setState({type:"wsCapi",state:{type:"online"}});break;case"disconnected":t._log.warn("CAPI disconnected",e.error),t._wsConnectivity.setState({type:"wsCapi",state:{type:"offline"}});break;case"init":break;default:c.assertNever(e)}})]},t.prototype.clearConnectivityListener=function(){this._connectivitySubs&&(this._connectivitySubs.map(function(t){return t.unsubscribe()}),this._connectivitySubs=[]),this._wsConnectivity.setState({type:"wsDox",state:{type:"online"}}),this._wsConnectivity.setState({type:"wsCapi",state:{type:"online"}}),this._doxConnectivity.set({type:"init"}),this._capiConnectivity.set({type:"init"}),this._connectivity.setState({type:"dox",state:{type:"online"}})},t.prototype._retryWhen=function(t){return t instanceof o.HTTPError?c.isServerErrorCode(t.code)||0===t.code:!(t instanceof o.WSError)||t.code<4e3},t}();e.EditorPageModelImpl=d},476:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(475);e.EditorPageModelImpl=r.EditorPageModelImpl,e.editorPageDefaultState=r.defaultState;var i=n(231);e.CheckingStatus=i.CheckingStatus,e.AppliedAlertAction=i.AppliedAlertAction;var o=n(269);e.GrammarlyEditorEngine=o.GrammarlyEditorEngine;var s=n(268);e.EditorSessionImpl=s.EditorSessionImpl,e.editorSessionDefaultState=s.defaultState;var a=n(267);e.DocumentSessionImpl=a.DocumentSessionImpl;var c=n(168);e.TextStatsModelImpl=c.TextStatsModelImpl,e.textStatsModelDefaultState=c.defaultState,e.TextStatsView=c.TextStatsView;var u=n(76);e.AlertGroup=u.AlertGroup;var l=n(469);e.AlertCacheImpl=l.AlertCacheImpl},477:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(53),i=n(242),o=n(10),s=function(){function t(t,e,n){var r=this;this._synonymsModel=t,this._es=e,this._apply=n,this.viewState=o.Atom.create(null),this._synonymsModel.state.subscribe(function(t){i.SynonymsModel.isReady(t)&&void 0!==t.synonyms&&r.viewState.set({synonymsState:t,popupVisible:!1})})}return t.prototype.apply=function(t){var e=this.viewState.get();null!==e&&i.SynonymsModel.isReady(e.synonymsState)&&void 0!==e.synonymsState.synonyms&&this._apply(e.synonymsState.synonyms.alert,e.synonymsState.query,t),this.hide()},t.prototype.showPopup=function(){r.invariant(i.SynonymsModel.isReady(this._synonymsModel.state.get()));var t=this._synonymsModel.state.get().query;this._es().highlightSynonym(t.start,t.word),this.viewState.modify(function(t){return null===t?null:{cursorPosition:t.cursorPosition,wordPosition:t.wordPosition,popupVisible:!0,synonymsState:t.synonymsState}})},t.prototype.hidePopup=function(){this.viewState.modify(function(t){return null===t?null:{cursorPosition:t.cursorPosition,popupVisible:!1,synonymsState:t.synonymsState}})},t.prototype.showButton=function(t){this.hide(),this._synonymsModel.query(t)},t.prototype.hide=function(){this._synonymsModel.abortQuery(),this.viewState.set(null)},t.prototype.move=function(t,e){this.viewState.modify(function(n){return null===n?null:{cursorPosition:t,wordPosition:e,popupVisible:n.popupVisible,synonymsState:n.synonymsState}})},t}();e.SynonymsViewModelImpl=s},478:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(4),o=function(){function t(t,e,n,r,o){this._browser=t,this._chromeUrl=e,this._firefoxUrl=n,this._firefoxIconUrl=r,this._notifications=o,this._log=i.Monitoring.Logging.getLogger("model.extInstall")}return t.prototype._installChromeExtension=function(){var t=this;return new Promise(function(e,n){return window.chrome.webstore.install(t._chromeUrl,function(){return e(!0)},function(t,e){return n({err:t,errorCode:e})})})},t.prototype.install=function(){return r.__awaiter(this,void 0,void 0,function(){var t,e,n,i=this;return r.__generator(this,function(r){switch(r.label){case 0:switch(t=this._browser){case"chrome":return[3,1];case"firefox":return[3,4];case"safari":case"edge":return[3,5]}return[3,6];case 1:return r.trys.push([1,3,,4]),[4,this._installChromeExtension()];case 2:return[2,r.sent()];case 3:return e=r.sent(),"userCancelled"===e.errorCode?this._log.warn("chrome extension install cancelled"):(n=e||new Error("banner: Click on install error is undefined"),this._log.error("chrome extension install failed",{error:n}),this._notifications.show(this._notifications.create.extensionInstallFailed())),[2,!1];case 4:return window.InstallTrigger.install({Grammarly:{URL:this._firefoxUrl,IconURL:this._firefoxIconUrl,toString:function(){return i._firefoxUrl}}}),[2,!0];case 5:return[2,!0];case 6:throw new TypeError("Unexpected input in browser variable: "+this._browser)}})})},t}();e.ExtensionInstallModelImpl=o},479:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.defaultState={visible:!1,opts:{type:null}};var r=function(){function t(t,e,n){this._state=t,this.os=e,this.notifications=n,this.state=this._state.view()}return t.prototype.show=function(t){this._state.set({visible:!0,opts:t})},t.prototype.hide=function(){this._state.set(e.defaultState)},t}();e.ModalDialogModelImpl=r;var i=function(){function t(t){this._state=t,this.state=this._state.view()}return t.prototype.show=function(){this._state.set({visible:!0})},t.prototype.hide=function(){this._state.set({visible:!1})},t}();e.ModalOverlayModelImpl=i},480:function(t,e,n){"use strict";function r(t,e,n,r,s){var a=3,c="windows"===n,u="mac"===n;return r&&!o.isAddinInstalled(t)&&c||a--,r&&!t.has(i.UserGroups.DESKTOP_EDITOR_INSTALLED)&&(c||u)||a--,o.isExtensionInstalled()&&a--,o.isBrowserHasExtension(e)||a--,"edge"===e&&o.isBrowserHasExtension(e)&&!s&&a--,a}Object.defineProperty(e,"__esModule",{value:!0});var i=n(105),o=n(129),s=["chrome","firefox","safari"],a=function(){function t(t,e,n){this.features=t,this._browser=e,this._os=n,this._showDesktopApps=this.features.desktopApps.get().enabled,this._appsSection=this.features.appsSection.get().enabled,this._showEdgeExt=this.features.showEdgeBanner.enabled}return t.prototype.getAppsCount=function(t){return r(t,this._browser,this._os,this._showDesktopApps,this._showEdgeExt)},t.prototype.isAppsVisible=function(){var t=this;return this._appsSection&&(this._showDesktopApps||s.some(function(e){return e===t._browser}))},t}();e.NavigationBarModelImpl=a},481:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(24),o=function(){function t(){this._dismissStream=new i.Subject}return t.prototype.dismiss=function(){this._cancel()},t.prototype.remind=function(){this._cancel()},t.prototype.cancel=function(){this._cancel()},t.prototype._cancel=function(){this._dismissStream.next(!1)},t}();e.ProofitBanner=o;var s=function(t){function e(e,n){var r=t.call(this)||this;return r._proofit=e,r._goToDocument=n,r._proofitStream=r._proofit.do(function(t){var e=t.id;return r._id=e}).map(function(t){return null!==t.id}),r.state=r._dismissStream.merge(r._proofitStream).distinctUntilChanged(),r}return r.__extends(e,t),e.prototype.install=function(){this.cancel(),this._id&&this._goToDocument(this._id)},e}(o);e.CancelledBanner=s;var a=function(t){function e(e){var n=t.call(this)||this;return n._proofitState=e,n.proofit=n._dismissStream.mapTo(null).merge(n._proofitState.map(function(t){return t})).distinctUntilChanged(),n}return r.__extends(e,t),e.prototype.install=function(){this.cancel()},e}(o);e.CompletedBanner=a},482:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(383),i=n(24),o=n(10),s=n(4),a=n(126),c=n(6),u=n(89),l=function(){function t(t,e){var n=this;this._router=t,this._selfUpdate=e,this._logger=s.Monitoring.Logging.getLogger("router"),u.buildInfo.version&&setInterval(function(){return n.handleUpdate(t,u.buildInfo.version)},this._selfUpdate.versionCheckInterval)}return t.prototype.getVersion=function(){var t=this,e=o.Atom.create(c.Async.defaultValue());return c.Async.OperationRetrier.create(function(){return a.RxFetch.request(t._selfUpdate.versionFilePath).then(function(t){return t.json()})},e,c.Async.OperationRetrier.RetryStrategy.linear(this._selfUpdate.retryFailedVersionCheckLimit,this._selfUpdate.retryFailedVersionCheckInterval)),e.filter(c.Async.isTerminated).first().toPromise().then(function(t){if(c.Async.isFatal(t))throw t.error;return t.value}).catch(function(e){return t._logger.warn("forceReload.getVersion failed",e)})},t.prototype.handleUpdate=function(t,e){var n=this;this.getVersion().then(function(o){r.lt(e,o.minimalVersion)?(i.Observable.fromEvent(document,"visibilitychange").switchMap(function(){return"hidden"===document.visibilityState?i.Observable.of(!0).delay(n._selfUpdate.forceUpdateOnHiddenDelay):i.Observable.never()}).first().subscribe(t.forceReload),t.scheduleForceReload()):r.lt(e,o.currentVersion)&&setTimeout(t.scheduleForceReload,n._selfUpdate.latestVersionDelay)}).catch(function(t){return n._logger.warn("forceReload.handleUpdate failed",t)})},t}();e.SelfUpdate=l},483:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(10),o=n(503),s=n(504),a=n(4),c=n(165),u=function(t,e){return new Promise(function(n,r){return t(e,function(t,e){if(t)return r(t);n(e)})})},l="braintree-hosted-fields-invalid",h=function(){function t(t,e,n){var h=this;this._notificationModel=t,this._irbisApi=e,this._updateSubscriptionState=n,this._log=a.Monitoring.Logging.getLogger("model.subscription.braintree"),this._braintreeInitializedInCreditCardForm=i.Atom.create(!1),this._teardownInProgress=!1,this.braintreeInitializedInCreditCardForm=this._braintreeInitializedInCreditCardForm.view(),this.updateCreditCard=function(){return new Promise(function(t,e){h._hostedFields.tokenize(function(n,r){if(n){var i=h._hostedFields.getState().fields;return Object.keys(i).forEach(function(t){i[t].isValid||i[t].container.classList.add(l)}),void e(n)}r||e(n),h._irbisApi.updateCreditCard(r.nonce).then(function(){return Object.keys(h._hostedFields.getState().fields).forEach(function(t){return h._hostedFields.clear(t)}),t()}).then(h._updateSubscriptionState).catch(e)})})},this.getBraintreeClient=function(){return r.__awaiter(h,void 0,void 0,function(){var t,e;return r.__generator(this,function(n){switch(n.label){case 0:return this._braintreeClient?[2,this._braintreeClient]:[4,this._generateCardToken()];case 1:return t=n.sent(),[4,u(o.create,{authorization:t})];case 2:return e=n.sent(),this._braintreeClient=e,[2,e]}})})},this.initInCreditCardForm=function(t){return r.__awaiter(h,void 0,void 0,function(){var e,n,i,o;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),this._notificationModel.clearNotification(),[4,this.getBraintreeClient()];case 1:return e=r.sent(),n={client:e,styles:t.styles,fields:t.fields},[4,u(s.create,n)];case 2:return i=r.sent(),this._hostedFields=i,this._braintreeInitializedInCreditCardForm.set(!0),[3,4];case 3:return(o=r.sent())&&"HOSTED_FIELDS_INVALID_FIELD_SELECTOR"!==o.code?[2]:(this._notificationModel.setNotification(c.SubscriptionNotificationType.unknownError),[3,4]);case 4:return[2]}})})},this.cleanupInCreditCardForm=function(){try{if(h._notificationModel.clearNotification(),h._teardownInProgress)return;return h._teardownInProgress=!0,h._hostedFields&&h._hostedFields.teardown(function(t){h._teardownInProgress=!1,t?h._log.error("Could not tear down Hosted Fields!",t):h._braintreeInitializedInCreditCardForm.set(!1)})}catch(t){h._log.warn("Braintree teardown error",t)}}}return t.prototype._generateCardToken=function(){return r.__awaiter(this,void 0,void 0,function(){var t;return r.__generator(this,function(e){switch(e.label){case 0:return[4,this._irbisApi.generateTokenCreditCard()];case 1:return t=e.sent().requestId,[4,this._irbisApi.getTokenRequest(t)];case 2:return[2,e.sent()]}})})},t}();e.BraintreeModelImpl=h},484:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(4),o=n(6),s=n(165),a=function(){function t(t,e,n){this._notificationModel=t,this._irbisApi=e,this._updateSubscriptionState=n,this._log=i.Monitoring.Logging.getLogger("model.subscription.PayPal")}return t.prototype.initialize=function(t){return r.__awaiter(this,void 0,void 0,function(){var e;return r.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this._initialize(t)];case 1:return n.sent(),[4,this._generateToken()];case 2:return n.sent(),[3,4];case 3:return e=n.sent(),this._log.error("paypal init error",e),this._notificationModel.setNotification(s.SubscriptionNotificationType.paypalError),[3,4];case 4:return[2]}})})},t.prototype.update=function(){return r.__awaiter(this,void 0,void 0,function(){var t,e;return r.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this._token?[3,2]:[4,this._generateToken()];case 1:n.sent(),n.label=2;case 2:return[4,this._irbisApi.getPaypalRedirectPageRequest(this._token)];case 3:if(!(t=n.sent()))throw new Error("Irbis return undefined paypal url");return document.location.href=t,[4,o.delay(5e3)];case 4:return n.sent(),[3,6];case 5:return e=n.sent(),this._log.error("paypal update error",e),this._notificationModel.setNotification(s.SubscriptionNotificationType.paypalError),[3,6];case 6:return[2]}})})},t.prototype._initialize=function(t){var e=t.token,n=t.paypal;return r.__awaiter(this,void 0,void 0,function(){var t=this;return r.__generator(this,function(i){return e.map(function(e){return r.__awaiter(t,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return[4,this._irbisApi.updatePaypal(e)];case 1:return t.sent(),[4,this._updateSubscriptionState()];case 2:return t.sent(),[2]}})})}),n.map(function(t){return"ok"===t.toLowerCase()?s.SubscriptionNotificationType.paypalSuccess:s.SubscriptionNotificationType.paypalError}).map(this._notificationModel.setNotification),[2]})})},t.prototype._generateToken=function(){return r.__awaiter(this,void 0,void 0,function(){var t,e;return r.__generator(this,function(n){switch(n.label){case 0:return t=this._generateLinks(),[4,this._irbisApi.generateTokenPaypal(t)];case 1:return e=n.sent().requestId,this._token=e,[2]}})})},t.prototype._generateLinks=function(){var t=document.location.protocol+"//"+document.location.host+document.location.pathname.replace(/\/$/,"");return{cancelUrl:t+"?paypal=error",returnUrl:t+"?paypal=ok"}},t}();e.PayPalModelImpl=a},485:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(15),o=n(122),s=n(239),a=n(748),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.back=function(){window.history.back()},e.prototype.render=function(){return i.createElement(o.BasePage,{title:"Page not found | Grammarly"},i.createElement("div",null,i.createElement(s.Logo,{mainPageUrl:this.context.appConfig.funnel.mainPage}),i.createElement("div",{className:a.header},i.createElement("div",{className:a.headOne},"Sorry, we couldn’t find that ",this.props.requestedData),i.createElement("div",{className:a.headSub},i.createElement("span",{className:a.sub},"We can’t get you there from here, but here are some options that might help you get back on track:"))),i.createElement("div",{className:a.linkWrapper},i.createElement("span",{className:a.home},"Go to the"," ",i.createElement("a",{"data-name":"linkHomePage",className:a.link,href:this.context.appConfig.funnel.mainPage},"Grammarly Homepage"))),i.createElement("div",{className:a.linkWrapper},i.createElement("span",{className:a.back},"Return to"," ",i.createElement("a",{"data-name":"linkBackPage",className:a.link,onClick:this.back},"Previous Page"))),i.createElement("div",{className:a.linkWrapper},i.createElement("span",{className:a.support},"Contact"," ",i.createElement("a",{"data-name":"linkSupportPage",className:a.link,href:this.context.appConfig.support.mainPage},"Grammarly Support")))))},e}(o.BaseComponent);e.Error404Page=c},486:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(502),n(1126),n(750);var r=n(248);try{"edge"===r().browser&&(window.fetch=null)}catch(t){}n(317)},487:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),i=n(491);e.errorSource={client:"client",server:"server"},e.accountType={free:"free",premium:"premium"};var o=function(){function t(t){this._gnar=t,this._eventLogger=r.Monitoring.Logging.getLogger("events.tracking"),this._exceptionLogger=r.Monitoring.Logging.getLogger("exceptions"),this._unhandledLogger=this._exceptionLogger.getLogger("unhandled"),this._tsRoot=r.Monitoring.TimeSeries.root,this._failedToFetch="Failed to fetch",this._rejections=new Map,r.Monitoring.Logging.root.debug("Starting telemetry"),window.addEventListener("error",this._unhandledError.bind(this)),window.addEventListener("unhandledrejection",this._unhandledRejection.bind(this)),window.addEventListener("rejectionhandled",this._rejectionHandled.bind(this)),document.addEventListener("visibilitychange",this._visibilityChanged.bind(this)),this._visibilityChanged(),window.screen&&r.Monitoring.Logging.getLogger("userStats").info("Screen",{size:window.screen.width+"x"+window.screen.height})}return t.prototype.setUser=function(t,e){r.Monitoring.Logging.root.context.add({user:{id:t}}),this._gnar.setUser(t,e),this._logEvent("setUser"),this._tsRoot.getCounter("userChanged").increment()},t.prototype.documentListOpened=function(){this._logEvent("myGrammarly-page-show"),this._gnar.track("myGrammarly-page-show")},t.prototype.deleteDocument=function(t){this._logEvent("deleteDocument-button-click",{docId:t}),this._gnar.track("deleteDocument-button-click")},t.prototype.uploadDocument=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n=""),this._logEvent("uploadDocument-form-submit",{isSuccess:t,errorSource:e,errorMessage:n}),this._gnar.track("uploadDocument-form-submit",{isSuccess:t,errorSource:e,errorMessage:n})},t.prototype.downloadDocument=function(t){this._logEvent("downloadDocument-button-click",{docId:t}),this._gnar.track("downloadDocument-button-click")},t.prototype.copyDocument=function(t){this._logEvent("copyDocument-button-click",{docId:t}),this._gnar.track("copyDocument-button-click")},t.prototype.newDocument=function(){this._logEvent("newDocument-button-click"),this._gnar.track("newDocument-button-click")},t.prototype.documentShow=function(t){this._logEvent("document-page-show",{docId:t}),this._gnar.track("document-page-show"),this._tsRoot.getCounter("documentPageShow").increment()},t.prototype.reportOpened=function(t){this._logEvent("detailedReport-page-show",{score:t}),this._gnar.track("detailedReport-page-show")},t.prototype.reportDownload=function(t){this._logEvent("detailedReportDownload-button-click",{score:t}),this._gnar.track("detailedReportDownload-button-click")},t.prototype.settingsToggled=function(t,e){this._logEvent("setting-toggle-click",{isEnabled:t,settingName:e}),this._gnar.track("setting-toggle-click",{isEnabled:t,settingName:e})},t.prototype.documentGenreSelected=function(t){this._logEvent("documentGenre-button-click",{documentGenre:t}),this._gnar.track("documentGenre-button-click",{documentGenre:t})},t.prototype.profileOpened=function(){this._logEvent("profile-page-show"),this._gnar.track("profile-page-show")},t.prototype.accountOpened=function(){this._logEvent("account-page-show"),this._gnar.track("account-page-show")},t.prototype.supportClicked=function(){this._logEvent("support-link-click"),this._gnar.track("support-link-click")},t.prototype.deleteAccountButtonClicked=function(t){this._logEvent("deleteAccount-button-click",{accountType:t}),this._gnar.track("deleteAccount-button-click",{accountType:t})},t.prototype.keepAccountButtonClicked=function(t){this._logEvent("keepAccount-button-click",{accountType:t}),this._gnar.track("keepAccount-button-click",{accountType:t})},t.prototype.deleteAccountFormSubmit=function(t,e,n,r){void 0===n&&(n=""),void 0===r&&(r=""),this._logEvent("deleteAccount-form-submit",{isSuccess:t,accountType:e,errorSource:n,errorMessage:r}),this._gnar.track("deleteAccount-form-submit",{isSuccess:t,accountType:e,errorSource:n,errorMessage:r})},t.prototype.cancelFutureBillingClicked=function(){this._logEvent("cancelFutureBilling-button-click"),this._gnar.track("cancelFutureBilling-button-click")},t.prototype.confirmSubscriptionCancelClicked=function(){this._logEvent("confirmSubscriptionCancel-button-click"),this._gnar.track("confirmSubscriptionCancel-button-click")},t.prototype.continueUsingGrammarlyClicked=function(){this._logEvent("continueUsingGrammarly-button-click"),this._gnar.track("continueUsingGrammarly-button-click")},t.prototype.reactivateSubscriptionClicked=function(){this._logEvent("reactivateSubscription-button-click"),this._gnar.track("reactivateSubscription-button-click")},t.prototype.downloadReceiptButtonClicked=function(){this._logEvent("downloadReceipt-form-submit"),this._gnar.track("downloadReceipt-form-submit",{isSuccess:!0})},t.prototype.downloadReceiptError=function(t){this._exceptionLogger.error("downloadReceipt-form-error",t),this._gnar.track("downloadReceipt-form-submit",{isSuccess:!1,errorSource:e.errorSource.client,errorMessage:t.message})},t.prototype.appsPageShown=function(){this._logEvent("apps-page-show"),this._gnar.track("apps-page-show")},t.prototype.installAppClicked=function(t){this._logEvent("installApp-button-click",{app:t}),this._gnar.track("installApp-button-click",{app:t})},t.prototype.learnMoreClicked=function(t){this._logEvent("learnMoreAboutApp-button-click",{app:t}),this._gnar.track("learnMoreAboutApp-button-click",{app:t})},t.prototype.bannerActionClicked=function(t,e){this._logEvent("bannerMainAction-button-click",{bannerType:t,cta:e}),this._gnar.track("bannerMainAction-button-click",{bannerType:t,cta:e})},t.prototype.bannerCloseClicked=function(t){this._logEvent("bannerClose-button-click",{bannerType:t}),this._gnar.track("bannerClose-button-click",{bannerType:t})},t.prototype.bannerDismissClicked=function(t){this._logEvent("bannerDismiss-button-click",{bannerType:t}),this._gnar.track("bannerDismiss-button-click",{bannerType:t})},t.prototype.bannerLaterClicked=function(t){this._logEvent("bannerRemindLater-button-click",{bannerType:t}),this._gnar.track("bannerRemindLater-button-click",{bannerType:t})},t.prototype.bannerNotificationShow=function(t){this._logEvent("banner-notification-show",{bannerType:t}),this._gnar.track("banner-notification-show",{bannerType:t})},t.prototype.dictionaryOpened=function(){this._logEvent("dictionary-page-show"),this._gnar.track("dictionary-page-show")},t.prototype.addToDictionary=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n=""),this._logEvent("addToDictionary-button-click",{isSuccess:t,errorSource:e,errorMessage:n}),this._gnar.track("addToDictionary-button-click")},t.prototype.removeFromDictionary=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n=""),this._logEvent("removeFromDictionary-button-click",{isSuccess:t,errorSource:e,errorMessage:n}),this._gnar.track("removeFromDictionary-button-click")},t.prototype.languageOpened=function(){this._logEvent("language-page-show"),this._gnar.track("language-page-show")},t.prototype.selectLanguage=function(t){var e="string"==typeof t?{language:t}:t;this._logEvent("selectLanguage-button-click",e),this._gnar.track("selectLanguage-button-click",{language:t})},t.prototype.showTour=function(t){this._logEvent("tour-popup-show",{theme:t}),this._gnar.track("tour-popup-show",{theme:t})},t.prototype.closeTour=function(t){this._logEvent("tour-popup-close",{theme:t}),this._gnar.track("tour-popup-close",{theme:t})},t.prototype.showTutorial=function(){this._logEvent("tutorial-popup-show"),this._gnar.track("tutorial-popup-show")},t.prototype.closeTutorial=function(){this._logEvent("tutorial-popup-close"),this._gnar.track("tutorial-popup-close")},t.prototype._getExtraProps=function(t){return t.reason||r.EventProps.fromAny(t)},t.prototype._logUnhandledPromiseRejection=function(t,e,n){var r=this._exceptionLogger.getLogger("unhandled.promiseRejection");("error"===t?r.error:r.warn).bind(r)("Unhandled rejection at promise: "+e,this._getExtraProps(n))},t.prototype._unhandledError=function(t){var e=t.error?t.error.message:t.message,n=i.isExternalException(t),o=n?r.Logging.LogLevel.INFO:r.Logging.LogLevel.ERROR,s=n?"unknownUnhandledError":"unhandledError";this._tsRoot.getCounter(s).increment();var a=t.reason;this._unhandledLogger.log(o,"Unhandled exception at "+t.filename+":"+t.lineno+":"+t.colno+" \n"+e,t.error,a&&{reason:a})},t.prototype._isEventSimulated=function(t){return!1===t.isTrusted},t.prototype._isExternalPromiseRejection=function(t,e){return i.isExternalException(t)||i.isExternalExceptionMessage(e)||this._isEventSimulated(t)},t.prototype._unhandledRejection=function(t){this._rejections.set(t.promise,Date.now());var e=t.reason?t.reason.message:t.message;this._isExternalPromiseRejection(t,e)?this._tsRoot.getCounter("unknownUnhandledPromise").increment():e===this._failedToFetch?this._logUnhandledPromiseRejection(t.reason&&t.reason.isRxFetch?"error":"warn",e,t):(this._logUnhandledPromiseRejection("error",e,t),this._tsRoot.getCounter("unhandledPromise").increment())},t.prototype._rejectionHandled=function(t){var e=this._rejections.get(t.promise);this._rejections.delete(t.promise);var n=t.reason?t.reason.message:t.message;this._exceptionLogger.getLogger("handled.promiseRejection").error("Rejection handled at promise: "+n+" in "+(e?Date.now()-e:NaN)+" ms",t.reason)},t.prototype._visibilityChanged=function(){r.Monitoring.Logging.root.context.add({visibilityState:document.visibilityState})},t.prototype._logEvent=function(t,e){void 0===e&&(e={}),this._eventLogger.info(t,e)},t}();e.EditorTelemetry=o},488:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(272),i=function(){function t(){}return t.prototype.track=function(t,e){var n=r.ls.getItem("trackingGnar")||"";try{r.ls.setItem("trackingGnar",(n?n+"_&&_":"")+t+(JSON.stringify(e)?":"+JSON.stringify(e):""))}catch(t){}return Promise.resolve()},t.prototype.pingMaybe=function(){},t.prototype.page=function(t,e){},t.prototype.setUser=function(t,e){},t.prototype.getContainerId=function(){return Promise.resolve("dummy_container_id")},t}();e.DummyGnarClient=i},489:function(t,e,n){"use strict";function r(t){if(t<0)throw new TypeError("Length should not be negative: "+t);return Array.from({length:t},function(){return d.charAt(Math.random()*d.length)}).join("")}function i(){try{var t=localStorage.getItem("pageReloadReason");if(!t)return;localStorage.removeItem("pageReloadReason");var e=JSON.parse(t);(function(t,e){return window.location.href===t&&Date.now()-e<g})(e.location,e.timestamp)&&s.Monitoring.Logging.root.info("Page was reloaded",e)}catch(t){}}function o(){var t=s.TimeSeriesImpl.MetricsStorage.createRoot(a.appConfig.env+"."+a.appConfig.app.name,a.appConfig.api.felogUrl,c.RxFetch.nativeFetch.bind(window));s.TimeSeriesImpl.MetricsConfig.configure(t);var e=function(){function t(t){var e=this;this._sink=t,this._counters=new Map;var n=s.Monitoring.TimeSeries.root.getMetric("logging.levels");Object.keys(s.Logging.LogLevel).map(function(t){return s.Logging.LogLevel[t]}).filter(function(t){return"number"==typeof t}).forEach(function(t){return e._counters.set(t,n.getCounter(s.Logging.LogLevel[t]))})}return t.prototype.append=function(t){var e=this._counters.get(t.level);return e&&e.increment(),this._sink.append(t)},t}(),n=function(){function t(t){this._sink=t,this._shortRateReporter={name:"short",indicator:new u.RateLimitIndicator(new u.RateLimiter(30,2e3),1e4),counter:s.Monitoring.TimeSeries.root.getCounter("logRates.short")},this._longRateReporter={name:"long",indicator:new u.RateLimitIndicator(new u.RateLimiter(120,24e4),3e4),counter:s.Monitoring.TimeSeries.root.getCounter("logRates.long")},this._counting=s.Monitoring.TimeSeries.root.getCounter("logRates.either"),this._countingStarted=0,this._droppingLimiter=new u.RateLimiter(2,6e4),this._dropped=0}return t.prototype.append=function(e){var n=this._shortRateReporter.indicator.hit(),r=this._longRateReporter.indicator.hit();if((n.wasTriggered||r.wasTriggered)&&(n.wasTriggered&&n.aboveThreshold&&this._shortRateReporter.counter.increment(),r.wasTriggered&&r.aboveThreshold&&this._longRateReporter.counter.increment(),n.aboveThreshold||r.aboveThreshold?this._counts||(this._counting.increment(),this._counts=new l.LRUCache(50),this._countingStarted=Date.now(),this._sink.append(this._createTriggeredEvent(e,"Logging rate is above threshold",{short:n,long:r})).catch(console.warn)):(this._counts=void 0,this._sink.append(this._createTriggeredEvent(e,"Logging rate is back to normal",{dropped:this._dropped})).catch(console.warn))),this._counts){var i=this._eventToString(e),o=this._counts.set(i,function(t){return(t||0)+1})||0;return o/((Date.now()-this._countingStarted)/1e3)>t.DROP_RATE&&o>t.DROP_COUNT&&!this._droppingLimiter.hit()?(this._drop(),Promise.reject("Log message discarded due to rate limiting: "+e.message)):this._sink.append(e)}return this._sink.append(e)},t.prototype._drop=function(){++this._dropped},t.prototype._createTriggeredEvent=function(t,e,n){return new s.LoggingImpl.LogEvent(s.Logging.LogLevel.ERROR,e,"editor.logging.rate",Date.now(),void 0,n,t.context)},t.prototype._eventToString=function(t){return t.level+t.logger+t.message},t.DROP_RATE=.5,t.DROP_COUNT=15,t}(),o=function(t){return new s.LoggingImpl.PostFelogClient(t,a.appConfig.app.name,a.buildInfo.version,a.appConfig.env,c.RxFetch.withTargetTag(c.RxFetch.request,"logs"))},d=s.Logging.LogLevel.fromString(a.appConfig.logLevel),g="dev"===a.appConfig.env?{append:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.resolve()}}:new n(new e(new s.LoggingImpl.LogQueue(o(a.appConfig.api.felogUrl+"/log"),f,_))),m=a.appConfig.collectCrashLogs?o(a.appConfig.api.felogUrl+"/crash"):void 0;s.LoggingImpl.LoggingConfig.configure(s.LoggingImpl.DefaultLogAppender.createRootLogger(a.appConfig.app.name,d,g,m,a.appConfig.copyLogsToConsole));var y=r(p);s.Monitoring.Logging.root.context.add({sessionId:y}),s.Monitoring.TimeSeries.root.getCounter("sessions").increment(),i(),s.Monitoring.Logging.root.info("Application starting. HTTP referrer: "+document.referrer),h.registerDebugHelper("kibana",function(){var t=encodeURIComponent("http://kibana.grammarly.io/app/kibana#/discover?_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-30m,mode:quick,to:now))&_a=(columns:!(_source),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'f-log-editor-*',key:context.sessionId,negate:!f,value:'"+y+"'),query:(match:(context.sessionId:(query:'"+y+"',type:phrase))))),index:'f-log-editor-*',interval:auto,query:(query_string:(analyze_wildcard:!t,lowercase_expanded_terms:!f,query:'*')),sort:!('@timestamp',desc))");fetch("https://private.gram.ly/shorten?url="+t).then(function(t){return t.text()}).then(function(t){return s.Monitoring.Logging.root.info("Kibana URL for this session: ",t)})})}Object.defineProperty(e,"__esModule",{value:!0});var s=n(4),a=n(89),c=n(126),u=n(500),l=n(245),h=n(6),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",p=14,f=100,_=1e4,g=3e5;e.initializeMonitoring=o},490:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),i=function(){function t(t,e){this._profile=t,this._subscription=e,this._log=r.Monitoring.Logging.getLogger("pixels"),this._counter=r.Monitoring.TimeSeries.root.getCounter("pixels")}return t.doTracking=function(e,n,r){n&&n.isPremiumConversion&&new t(e,n)._doTracking(r)},t.prototype._doTracking=function(t){var e=this;this._log.info("Forcing premium conversion tracking"),this._counter.increment(),t.ackPremiumConversion().then(function(){e._try(function(){return e._googleAdwordsPixel()},"googleAdwordsPixel"),e._try(function(){return e._universalTracking()},"universalTracking")}).catch(function(t){return e._log.error("ackPremiumConversion failed",t)})},t.prototype._try=function(t,e){try{t()}catch(t){this._log.error("Error while calling tracking pixel "+e,t)}},t.prototype._googleAdwordsPixel=function(){var t,e=this._subscription.currentPlan.periodMonths;switch(e){case 1:t="DWnkCMbLrwkQ4ozj9gM";break;case 3:t="lqBBCL7MrwkQ4ozj9gM";break;case 12:t="w4TvCLbNrwkQ4ozj9gM";break;default:t="-eBYCKTnylgQ4ozj9gM",this._log.error("Unexpected periodMonths "+e)}new Image(1,1).src="https://www.googleadservices.com/pagead/conversion/1054393954/?label="+t+"&guid=ON&script=0"},t.prototype._universalTracking=function(){var t=this._subscription.currentPlan,e=window.ga||this._initUniversalTracking();e("send","pageview","/thankyou"),e("ecommerce:addTransaction",{id:this._profile.email,affiliation:"",revenue:t.price+"",shipping:"",tax:""}),e("ecommerce:addItem",{id:this._profile.email,sku:t.periodMonths+"M",name:t.title+"",category:"Grammarly Subscription",price:t.price+"",quantity:"1"}),e("ecommerce:send")},t.prototype._initUniversalTracking=function(){var t=new Date,e={},n={};!function(e,n,r,i,o,s,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*t,s=n.createElement(r),a=n.getElementsByTagName(r)[0],s.async=1,s.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(s,a)}(window,document,"script",0,"ga",e,n);var r=window.ga;return r("create","UA-6331378-16","auto"),r("require","displayfeatures"),r("require","ecommerce"),r},t}();e.PixelTracking=i},491:function(t,e,n){"use strict";function r(t){return/Unhandled exception at https?:\/\//.test(t)&&!/grammarly|cloudfront/.test(t)}function i(t){return u.test(t)}function o(t){return r(t)||c.test(t)}function s(t){var e=t.error&&t.error.stack;if(e&&-1!==e.indexOf("denali"))return!1;if(!t.filename||/^javascript:/.test(t.filename))return!0;if(e&&i(e))return!0;try{return o(t.error?t.error.message:t.message||JSON.stringify(t.reason||a.EventProps.fromAny(t)))}catch(t){return!1}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(4),c=new RegExp(["^(Script error.?|Javascript error: Script error.? on line 0)$","(.*__gCrWeb.autofill.extractForms'\\))","(.*safari-extension.*)|(.*chrome-extension.*)|(.*moz-extension.*)",'Permission denied to access property "'].join("|"),"m"),u=new RegExp(["(.*safari-extension.*)|(.*chrome-extension.*)|(.*moz-extension.*)","<anonymous>"].join("|"),"m");e.containsExternalUrl=r,e.isExternalExceptionStack=i,e.isExternalExceptionMessage=o,e.isExternalException=s},492:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(24);!function(t){function e(e,i,o){return r.Observable.merge(n(e,i,o).takeUntil(t.hiddenObservable),t.hiddenObservable.mapTo(i).first())}function n(t,e,n){return r.Observable.create(function(r){function i(a){o||(o=a);var c=a-o;c<n?(r.next(Math.round(t+c/n*(e-t))),s=window.requestAnimationFrame(i)):(r.next(e),r.complete())}var o,s=window.requestAnimationFrame(i);return function(){return window.cancelAnimationFrame(s)}}).distinctUntilChanged()}function i(t){var e=new r.Subject;return{state:t.switchMap(function(t){return t?r.Observable.of("inProgress"):r.Observable.merge(r.Observable.of("fadeOut"),e.mapTo("end"))}),complete:function(){return e.next(!0)}}}function o(t){return r.Observable.create(function(e){var n=requestAnimationFrame(function(){return e.next(t)});return function(){return cancelAnimationFrame(n)}})}t.hiddenObservable=r.Observable.fromEvent(document,"visibilitychange").map(function(){return document.hidden}).startWith(document.hidden).filter(Boolean).repeat(1),t.createAnimationObservable=e,t.fadeOutState=i,t.rafScheduler=o}(e.Animation||(e.Animation={}))},493:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(24),o=n(6);!function(t){function e(){return{status:E.idle}}function n(t){return{status:E.ok,value:t}}function s(t){return t.status===E.idle}function a(t){return t.status===E.inProgress}function c(t){return t.status===E.ok}function u(t){return t.status===E.error}function l(t){return t.status===E.fatal}function h(t){return c(t)||l(t)}function d(t){return h(t)||u(t)}function p(t,e){return c(t)?e(t.value):t}function f(t,e){return c(t)?n(e(t.value)):t}function _(t){return o.invariant(!a(t),"Can't enter begin state - unexpected status '"+E[t.status]+"'"),{status:E.inProgress}}function g(t,e){return function(n){o.invariant(!h(n),"Can't enter error state - unexpected status '"+E[n.status]+"'");var r=E.error;return e?{status:r,error:t,attempt:e}:{status:r,error:t}}}function m(t){return function(e){return o.invariant(u(e)||a(e),"Can't enter fatal state - unexpected status '"+E[e.status]+"'"),{status:E.fatal,error:t}}}function y(t){return function(e){return o.invariant(!c(e),"Can't enter ok state - unexpected status '"+E[e.status]+"'"),n(t)}}function v(e,n,r,o){return void 0===r&&(r=t.DEFAULT_TIMEOUT_MS),void 0===o&&(o=function(t){return t}),new Promise(function(t,s){n.modify(_);var a=!1;i.Observable.defer(e).last().timeout(r).subscribe(function(e){n.modify(y(o(e))),a=!0,t(e)},function(t){n.modify(g(t)),a=!0,s(t)},function(){if(!a){var t=void 0;n.modify(function(e){return e.status!==E.ok&&e.status!==E.error?g(t=new S)(e):e}),t&&s(t)}})})}function b(t,e,n){var r=t.get();return n().then(function(n){return new Promise(function(n){t.modify(e),n()})}).catch(function(e){return t.set(r),Promise.reject(e)})}function w(t,e,n,r){void 0===r&&(r=!0);var i=t.get();return t.modify(e),n().catch(function(e){return r&&t.set(i),Promise.reject(e)})}var E;!function(t){t[t.idle=0]="idle",t[t.inProgress=1]="inProgress",t[t.ok=2]="ok",t[t.error=3]="error",t[t.fatal=4]="fatal"}(E=t.Status||(t.Status={})),t.defaultValue=e,t.ok=n,t.isIdle=s,t.isInProgress=a,t.isOk=c,t.isError=u,t.isFatal=l,t.isTerminated=h,t.isSomething=d,t.flatMap=p,t.map=f,t.begin=_,t.error=g,t.fatal=m,t.success=y,t.DEFAULT_TIMEOUT_MS=1e4;var S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e}(o.CustomError);t.NoValueReturnedError=S,t.runWithTimeout=v,t.promiseWithTimeout=function(t,e){return i.Observable.from(t).timeout(e).toPromise()},t.modifyRemoteState=b,t.modifyRemoteStateOptimistic=w;!function(e){function n(e,n,s){void 0===s&&(s=r.noRetry);var a=0;n.modify(_);var c=i.Observable.defer(e).catch(function(t){throw n.modify(g(t,++a)),t}).retryWhen(s).catch(function(t){return n.modify(m(t)),i.Observable.never()}).map(y).do(n.modify.bind(n)).first().subscribe(o.noop);return{unsubscribe:function(){t.isTerminated(n.get())||(o.invariant(!c.closed,"cannot abort completed operation"),c.unsubscribe())}}}var r;!function(t){t.noRetry=function(t){return t.switchMap(function(t){return i.Observable.throw(t)}).first()},t.linear=function(t,e){return void 0===e&&(e=1e3),function(n){return n.switchMap(function(n,r){if(r>=t)throw n;return i.Observable.timer(r*e)})}},t.conditional=function(t,e){return function(n){return i.Observable.merge(e(n.takeWhile(t)),n.skipWhile(t).map(function(t){throw t}))}}}(r=e.RetryStrategy||(e.RetryStrategy={})),e.create=n}(t.OperationRetrier||(t.OperationRetrier={}))}(e.Async||(e.Async={}))},494:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(24),i=n(10),o=n(43);r.Observable.fromEvent(window,"click").first().subscribe(function(){document.queryCommandSupported("copy")||s.copyApiAvailable.set(!1)});var s=function(){function t(){}return t.copy=function(t){this._clearSelection();var e=this._createHiddenSpan(t);return this.select(e),this._copy(t).then(function(){e.parentElement.removeChild(e)}).catch(function(t){throw e.parentElement.removeChild(e),t})},t.select=function(t){if(window.getSelection&&document.createRange){var e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),e.removeAllRanges(),e.addRange(n)}else if("selection"in document&&"createTextRange"in document.body){var n=document.body.createTextRange();n.moveToElementText(this),n.select()}},t._clearSelection=function(){var t=window.getSelection?window.getSelection():document.selection;"removeAllRanges"in t?t.removeAllRanges():"empty"in t&&t.empty()},t._createHiddenSpan=function(t){var e=document.createElement("span");return e.setAttribute("style",["all: unset","position: fixed","top -999px","left -999px","opacity: 0","background transparent","white-space: pre","-webkit-user-select: text","-moz-user-select: text","-ms-user-select: text","user-select: text"].join(";")),e.textContent=t,document.body.appendChild(e),e},t._copy=function(t){var e=this;return new Promise(function(n,r){try{("msie"===e._browser?window.clipboardData.setData("text",t):document.execCommand("copy"))?n():r(new Error("Copy API doesn't work"))}catch(t){r(t)}})},t._browser=o.getBrowserInfo().browser,t.copyApiAvailable=i.Atom.create(!0),t}();e.Clipboard=s},495:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=n(3),o=n(10),s=n(127);!function(t){t[t.IDLE=0]="IDLE",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.TERMINATING=3]="TERMINATING"}(r||(r={}));var a;!function(t){t[t.CONNECT=0]="CONNECT",t[t.CONNECTED=1]="CONNECTED",t[t.TERMINATE=2]="TERMINATE",t[t.TERMINATED=3]="TERMINATED"}(a||(a={}));var c=function(){function t(t,e,n){void 0===n&&(n=o.Atom.create(null));var c=this;this._connector=t,this._terminator=e,this._currentConnection=n,this._create=function(){return i.__awaiter(c,void 0,void 0,function(){var t,e,n;return i.__generator(this,function(r){switch(r.label){case 0:return t=this._connectionParams,[4,this._connector(t)];case 1:return e=r.sent(),n=t===this._connectionParams,n?[4,this._fsm.event(a.CONNECTED,e)]:[3,3];case 2:n=r.sent(),r.label=3;case 3:return n?(this._currentConnection.set(e),[3,6]):[3,4];case 4:return[4,this._terminator(e)];case 5:r.sent(),r.label=6;case 6:return[2]}})})},this._remove=function(){return i.__awaiter(c,void 0,void 0,function(){var t;return i.__generator(this,function(e){switch(e.label){case 0:return t=this._currentConnection.get(),this._currentConnection.set(null),[4,this._terminator(t)];case 1:return e.sent(),[4,this._fsm.event(a.TERMINATED,"removed")];case 2:return e.sent(),[2]}})})},this._processQueue=function(){return c._connectionParams?c._fsm.event(a.CONNECT,c._connectionParams):Promise.resolve(!0)},this._fsm=new s.StateMachine(r.IDLE).from(r.CONNECTED).to(r.TERMINATING).on(a.CONNECT,a.TERMINATE).from(r.IDLE,r.CONNECTING,r.TERMINATING).to(r.CONNECTING).on(a.CONNECT).from(r.CONNECTING).to(r.CONNECTED).on(a.CONNECTED).from(r.TERMINATING).to(r.IDLE).on(a.TERMINATED).on(r.CONNECTING,this._create).on(r.TERMINATING,this._remove).on(r.IDLE,this._processQueue)}return t.prototype.connect=function(t){return void 0===t&&(t="connection"),i.__awaiter(this,void 0,void 0,function(){var e;return i.__generator(this,function(n){switch(n.label){case 0:return(e=t===this._connectionParams&&(this._fsm.current===r.CONNECTED||this._fsm.current===r.CONNECTING))?[3,2]:(this._connectionParams=t,[4,this._fsm.event(a.CONNECT,t)]);case 1:n.sent(),n.label=2;case 2:return[2]}})})},t.prototype.terminate=function(){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(t){switch(t.label){case 0:return this._connectionParams=null,[4,this._fsm.event(a.TERMINATE)];case 1:return t.sent(),[2]}})})},t}();e.ConnectionManager=c},496:function(t,e,n){"use strict";function r(t){return i.default(t)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(247);e.getCookie=r},497:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.userTestingDemoTitle="Buying a car",e.userTestingDemoText="\nFor years I have been driving an old used car with a lot of mileage, and I hate it. It gets me where I need to go, but I’m tired of fixing leaks and broken parts all the time. Its annoying that I have to take it to mechanic every times. Even when they take care of everything, I know in a week I’ll just end up going back there.\n\nI have finally decided that I am not going to do it anymore. I have decided to buy a new car! Unfortunately, I have a problem. I have no idea what car to get. Do I want something fast? Do I want something big? Do I want something stylish? Something economical? I have so many choices that I don’t even know where to begin. I am not sure if I will be able to make the decision on my own. I don't have a lot of money either, so I probably don't have many option.\n\nAfter I did some research, I knew that I would need some expert advice. Eventually, I went to a local dealership to check out some new models. I talked to the saleswoman and listened at she carefully. Her honesty and professionalism were really impressive. She had a lot of vary helpful suggestions and showed myself some safe affordable choices. After a long discussion I finally decided which one I wanted. She not only helped me with the paperwork and finished the sale, but also the insurance. I was expecting this purchase to be a serious hassle, but the experience was almost painless. Everything went smoothly, and now I have a brand new car!\n\nI was so excited when I pulled out of the lot that the first thing I did was change lanes right in front of other car. “That wasn't very nice,” I thought to myself. I needed to relax. I didn’t realize what a serious mistake I had made however. I hadn’t just cut off any other car, I had cut off a police car! It took a few seconds to realize what was happening when I saw the flashing lights in my rearview mirror. By the time I had managed to pull over, my heart was racing. I gathered all the paperwork as he approached my window.\n\n“You forgot to signal back there” said Officer Johnson, according to his nametag.\n\n“Yes, well, it’s a new car so I guess I was a bit unfamiliar with the controls,” I stammered.\n\nHe looked at me skeptically.\n\n“I’m pretty sure the controls for the turn signal are in the same place on every car.”\n\nWhat could I say? He was right.\n\n“I’m sorry,” I ventured.\n\nHe looked over my paper work and noticed that the car was new.\n\n“It would be unfortunate to get a ticket on your first day in a new vehicle,” he said, smiling. “Try not to cut in front of anyone on your way home.”\n\nI had never felt so relieved in my life.\n\n“Thank you, officer!”\n\nAs he made his way back to his car I let out a huge sigh. I took a few seconds to compose myself before shifting into gear and driving away from the side of the rode. Now I have a brand new car and a story to tell!\n"},498:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){function e(t){return{kind:"left",value:t}}function n(t){return{kind:"right",value:t}}function r(t){return"left"===t.kind}function i(t){return"right"===t.kind}function o(t,e){return r(t)?t:e(t.value)}function s(e){return e.then(function(e){return t.right(e)}).catch(function(e){return t.left(e)})}t.left=e,t.right=n,t.isLeft=r,t.isRight=i,t.flatMap=o,t.fromPromise=s}(e.Either||(e.Either={}))},499:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(35),i=n(164);!function(t){function e(t){return r.Option.of(t).filter(i.notEmpty)}function n(t){return r.Option.of(t).map(function(t){return t.filter(Boolean)}).filter(i.notEmpty)}t.string=e,t.array=n}(e.NotEmpty||(e.NotEmpty={}))},500:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(271),i=function(){function t(t,e){if(this.messageCount=t,this.timeframe=e,t<1)throw new r.IllegalArgumentError("messagesCount should be > 1");if(e<=0)throw new r.IllegalArgumentError("timeframe should be > 0");this._allowance=t,this._lastChecked=Date.now()}return t.prototype.hit=function(){var t=Date.now(),e=t-this._lastChecked;return this._lastChecked=t,this._allowance+=e*(this.messageCount/this.timeframe),this._allowance>this.messageCount&&(this._allowance=this.messageCount),!(this._allowance<1)&&(this._allowance-=1,!0)},t.prototype.toString=function(){return"[ messageCount: "+this.messageCount+", timeframe: "+this.timeframe+", allowance: "+Math.trunc(1e3*this._allowance)/1e3+", _lastCheck: "+this._lastChecked+"]"},t}();e.RateLimiter=i;var o=function(){function t(t,e){if(this._limiter=t,this._cooldownTime=e,this._lastLimiting=0,this._aboveThreshold=!1,e<0)throw new r.IllegalArgumentError("cooldownTime should be non-negative")}return t.prototype.hit=function(){var t=this._limiter.hit(),e=!1;return t?this._aboveThreshold&&Date.now()-this._cooldownTime>this._lastLimiting&&(this._aboveThreshold=!1,e=!0):(this._lastLimiting=Date.now(),this._aboveThreshold||(this._aboveThreshold=!0,e=!0)),{allow:t,aboveThreshold:this._aboveThreshold,wasTriggered:e}},t}();e.RateLimitIndicator=o},501:function(t,e,n){"use strict";function r(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function i(t){return void 0===t&&(t=[]),t.filter(function(t){return!t.isFree}).reduce(function(t,e){var n=e.group,r=e.category,i=n+":"+r.replace("_","");return void 0===t[i]&&(t[i]=0),t[i]+=1,t},{})}function o(t){return a.isDesktopEditor(a.getBrowserInfo().browser)?"Desktop"+c.camelize(t):t}function s(t,e,n){var s=e?{page:"free",utm_medium:u,utm_source:l,utm_campaign:o(e)}:{page:"free"},a=i(n),c={app_type:"app",return_url:document.location.href};return t+"?"+r(Object.assign({},a,c,s))}Object.defineProperty(e,"__esModule",{value:!0});var a=n(43),c=n(123),u="internal",l="upHook";e.getUpgradeUrl=s},53:function(t,e,n){"use strict";function r(t,e){if(!t)throw new Error("Invariant condition failed: "+(e?"string"==typeof e?e:e():"(unnamed)"))}function i(t){var e=new Date(t);return isNaN(e.getTime())?null:e}function o(t){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(e){return[2,new Promise(function(e){return setTimeout(e,t)})]})})}function s(t,e,n){return void 0===e&&(e=10),void 0===n&&(n=1e3),a.__awaiter(this,void 0,void 0,function(){var r;return a.__generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,4]),[4,t()];case 1:return[2,i.sent()];case 2:if(r=i.sent(),e<=1||!(r instanceof h))throw r;return c.Monitoring.Logging.root.isEnabled(c.Logging.LogLevel.TRACE)&&c.Monitoring.Logging.root.getLogger("coreclients.utils").trace("retryWithDelay: count "+e+", timeout: "+n,r),[4,o(n)];case 3:return i.sent(),[2,s(t,e-1,1.3*n)];case 4:return[2]}})})}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),c=n(4),u=n(35);e.invariant=r;var l=function(){function t(t){var e=new Error(t);this.message=e.message,this.stack=e.stack}return t}();e.CustomError=l;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="RetryError",e}return a.__extends(e,t),e}(l);e.RetryError=h,e.stringToDate=i,e.delay=o,e.retryWithDelay=s;var d=function(){function t(t,e,n,r){void 0===e&&(e=5e3),void 0===n&&(n=""),void 0===r&&(r=new Error("Timeout")),this._doRequest=t,this._timeout=e,this._timeoutError=r,this._requests=new Map,this._log=c.Monitoring.Logging.getLogger("ValueRequester"+(n.length>0?"."+n:""))}return t.prototype.request=function(t){return this._startRequest(t).promise},t.prototype.onValue=function(t,e){this._stopRequest(t,u.Right(e))},t.prototype.onError=function(t,e){this._stopRequest(t,u.Left(e))},t.prototype._startRequest=function(t){var e=this,n=this._doRequest(t),r={};return r.promise=new Promise(function(t,e){r.resolve=t,r.reject=e}),r.timer=setTimeout(function(){return e._stopRequest(n,u.Left(e._timeoutError))},this._timeout),this._requests.set(n,r),r},t.prototype._stopRequest=function(t,e){var n=this,r=this._requests.get(t);void 0===r?this._log.error("Got unrequested result or request has already expired."):(clearTimeout(r.timer),e.fold(function(t){n._log.warn("Failing request",t),r.reject(t)},function(t){return r.resolve(t)}),this._requests.delete(t))},t}();e.ValueRequester=d},6:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3);r.__exportStar(n(271),e),r.__exportStar(n(164),e);var i=n(493);e.Async=i.Async;var o=n(492);e.Animation=o.Animation;var s=n(495);e.ConnectionManager=s.ConnectionManager;var a=n(494);e.Clipboard=a.Clipboard;var c=n(498);e.Either=c.Either;var u=n(230);e.DOM=u;var l=n(123);e.StringUtils=l;var h=n(396);e.ReactUtils=h;var d=n(236);e.DateUtils=d;var p=n(272);e.LocalStorage=p;var f=n(496);e.Cookie=f;var _=n(129);e.Extension=_;var g=n(43);e.BrowserInfo=g;var m=n(237);e.ObjectUtils=m;var y=n(398);e.ArrayUtils=y;var v=n(499);e.NotEmpty=v.NotEmpty},68:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(53),o="application/json",s="application/x-www-form-urlencoded";e.HTTPMethods=["get","post","put","options","head","trace","delete","connect"];var a=function(){function t(){}return t.factory=function(e,n,r){return void 0===n&&(n="unknown"),void 0===r&&(r=t.mapToHTTPError),function(i,o,s){var a=i.url,c=i.body,u=i.method,l=i.headers;void 0===o&&(o=t.parseJSON),void 0===s&&(s=r);var h=(d={body:c,method:u,headers:l,mode:"cors",credentials:"include"},d.grammarly_target=n,d);return e(a,h).then(t._checkStatus(s)).then(o);var d}},t._checkStatus=function(t){var e=this;return function(n){return r.__awaiter(e,void 0,void 0,function(){return r.__generator(this,function(e){switch(e.label){case 0:return n.ok?[2,n]:[3,1];case 1:return[4,t(n)];case 2:return[2,e.sent()]}})})}},t.mapToHTTPError=function(t){return r.__awaiter(this,void 0,void 0,function(){var e;return r.__generator(this,function(n){switch(n.label){case 0:return[4,t.text()];case 1:throw e=n.sent(),new c({code:t.status,status:t.statusText,url:t.url,body:e})}})})},t.assertMimeType=function(t){return function(e){var n=e.headers.get("Content-Type")||e.headers.get("content-type");if(!n)throw new Error("get empty Content-Type, but expected: "+t);if(-1===n.indexOf(t))throw new Error("get Content-Type: "+n+", but expected: "+t)}},t.parseJSON=function(e){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(n){return t.assertMimeType("application/json")(e),[2,e.json()]})})},t.parseText=function(t){return t.text()},t.toVoid=function(){},t}();e.Ajax=a;var c=function(t){function e(e){var n=e.code,r=e.status,i=e.url,o=e.message,s=e.body,a=t.call(this,o||r||s||"HTTPError")||this;return a.name="HTTPError",a.url=i,a.code=n,a.body=s,a.status=r,a}return r.__extends(e,t),e}(i.CustomError);e.HTTPError=c;var u=function(){function t(t,e,n,r,i){this._url=t,this._method=e,this._headers=n,this._mime=r,this._body=i}return t.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l.get.apply(l,t).build()},t.post=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l.post.apply(l,t).build()},t.put=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l.put.apply(l,t).build()},t.del=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l.del.apply(l,t).build()},t.head=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l.head.apply(l,t).build()},Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"method",{get:function(){return this._method},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headers",{get:function(){return this._headers},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mime",{get:function(){return this._mime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"body",{get:function(){return this._body},enumerable:!0,configurable:!0}),t}();e.Request=u;var l=function(){function t(t,e,n,r,i,o,s,a){void 0===t&&(t=""),void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i={}),this._url=t,this._queryParams=e,this._formParams=n,this._cookies=r,this._headers=i,this._method=o,this._mime=s,this._body=a}return t.join=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=[].slice.call(e.filter(function(t){return t.length>0}),0).join("/");return t._normalize(r)},t._normalize=function(t){return t=t.replace(/:\//g,"://"),t=t.replace(/([^:\s])\/+/g,"$1/"),t=t.replace(/\/(\?|#)/g,"$1")},t.get=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.url.apply(t,e).method("get")},t.post=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.url.apply(t,e).method("post")},t.put=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.url.apply(t,e).method("put")},t.del=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.url.apply(t,e).method("delete")},t.head=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.url.apply(t,e).method("head")},t.url=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return new t(t.join.apply(t,e))},t.prototype.url=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(""!==this._url)throw new Error("URL already set to "+this._url+", use join(string) to add additional parts to it");return this.join(t.join.apply(t,e))},t.create=function(){return new t},t.prototype.method=function(t){if(-1===e.HTTPMethods.indexOf(t.toLowerCase()))throw new Error("unknown method was passed as an argument: "+t);if(this._method&&this._method!==t)throw new Error("Method already set to "+this._method+", but was overwritten by "+t);return this._method=t,this},t.prototype.join=function(e){return this._url=t.join(this._url,e),this},t.prototype.pathParam=function(e){return this._url=t.join(this._url,encodeURIComponent(e)),this},t.prototype.body=function(t){if(this._body)throw new Error("Body already set to "+this._body+", but was overwritten by "+t);return this._body=t,this},t.prototype.isBodyPresent=function(){return this._body},t.prototype.formParam=function(t,e){return this._formParams.push(this._encodeParam(t,e)),this},t.prototype.header=function(t,e){return this._headers[t]=e,this},t.prototype.queryParam=function(t,e){return this._queryParams.push(this._encodeParam(t,e)),this},t.prototype.cookie=function(t,e){return this._cookies.push(t+"="+e),this},t.prototype.mime=function(t){if(this._mime&&this._mime!==t)throw new Error("MIME already set to "+this._mime+", but was overwritten by "+t);return this._mime=t,this},t.prototype.json=function(t){return t?this.body(t).mime(o):this.mime(o)},t.prototype.build=function(){if(!this._url||0===this._url.length)throw new Error("URL cannot be empty");if(this._url=this._url.replace(/\/$/,""),this._queryParams.length>0&&(this._url+="?"+this._queryParams.join("&")),this._body&&this._formParams.length>0)throw new Error("User formParam() OR body() methods to specify request content, not both");if(this._formParams.length>0){if(this._mime&&this._mime!==s)throw new Error("Only application/x-www-form-urlencoded can be used for form requests, don't specify it mandatory in mime() method");this._mime=s,this._body=this._formParams.join("&")}if(this._mime===o&&this._body&&(this._body=JSON.stringify(this._body)),!this._method)throw new Error("HTTP method was not set");if(this._method=this._method.toLocaleLowerCase(),("get"===this._method||"delete"===this._method)&&this._body)throw new Error("Body is not supported for GET, DELETE requests");if(this._mime&&(this._headers["Content-Type"]=this._mime),this._cookies.length>0){this._headers.Cookie=this._cookies.join("; ")}return new u(this._url,this._method,this._headers,this._mime||null,this._body)},t.prototype._encodeParam=function(t,e){return encodeURIComponent(t)+"="+encodeURIComponent(e)},t}();e.RequestBuilder=l},689:function(t,e){t.exports={spinner:"_052b8d00-spinner-spinner",item:"_6f2b1cc8-spinner-item",spinner_bouncedelay:"_7de85e44-spinner-spinner_bouncedelay"}},690:function(t,e){},691:function(t,e){},692:function(t,e){},693:function(t,e){},706:function(t,e,n){t.exports=n.p+"files/997ea3a3690bda688b2a6d7407bb5eb9/logo.svg"},707:function(t,e,n){t.exports=n.p+"files/791af15b554bcd8bf942ef130faffe1f/robot@2x.gif"},747:function(t,e,n){n(691),t.exports=n(1131)},748:function(t,e,n){n(692),t.exports=n(1132)},749:function(t,e,n){n(693),t.exports=n(1133)},76:function(t,e,n){"use strict";function r(t){var e=c[t];if(void 0===e)throw new TypeError("Unknown alert group "+t);return e}Object.defineProperty(e,"__esModule",{value:!0});var i=n(391);e.createReplacement=i.createReplacement,e.createSimpleReplacement=i.createSimpleReplacement;var o=n(235);e.parseExamples=o.parseExamples;var s=n(470);e.parsePlagiarism=s.parsePlagiarism;var a;!function(t){t[t.contextualSpelling=0]="contextualSpelling",t[t.grammar=1]="grammar",t[t.sentenceStructure=2]="sentenceStructure",t[t.punctuation=3]="punctuation",t[t.style=4]="style",t[t.enhancement=5]="enhancement",t[t.plagiarism=6]="plagiarism",t[t.synonym=7]="synonym"}(a=e.AlertGroup||(e.AlertGroup={}));var c={Spelling:a.contextualSpelling,ContextualSpelling:a.contextualSpelling,Grammar:a.grammar,SentenceStructure:a.sentenceStructure,Punctuation:a.punctuation,Style:a.style,Enhancement:a.enhancement,Plagiarism:a.plagiarism};e.alertGroupFromString=r},89:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=window.Grammarly,i=r&&r.denali,o=i&&i.appConfig||n(400).appConfig,s=i&&i.buildInfo;e.appConfig=o||{},e.buildInfo=s||{}}},[1134]);